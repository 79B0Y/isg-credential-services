<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Gemini API æ–‡æ¡£</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #f8f9fa;
            --text-color: #333;
            --border-color: #e5e5e5;
            --success-color: #34a853;
            --error-color: #ea4335;
            --warning-color: #fbbc04;
            --info-color: #4285f4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #3367d6);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav ul {
            list-style: none;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .nav a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav a:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }

        .api-section {
            background: white;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .api-section h2 {
            background: var(--secondary-color);
            padding: 1.5rem;
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
        }

        .api-section h3 {
            padding: 1rem 1.5rem 0.5rem;
            color: var(--text-color);
            font-size: 1.2rem;
        }

        .api-endpoint {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .method {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
        }

        .method.get {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .method.post {
            background-color: #dcfce7;
            color: #166534;
        }

        .url {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: var(--secondary-color);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            flex: 1;
            min-width: 200px;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3367d6;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .endpoint-description {
            color: #666;
            margin-bottom: 1rem;
        }

        .endpoint-example {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .endpoint-example pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            overflow-x: auto;
        }

        .endpoint-input {
            margin: 1rem 0;
        }

        .endpoint-input label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .endpoint-input input, .endpoint-input textarea, .endpoint-input select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .endpoint-input input:focus, .endpoint-input textarea:focus, .endpoint-input select:focus {
            outline: 0;
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .endpoint-input textarea {
            min-height: 100px;
            resize: vertical;
        }

        .test-result-container {
            margin-top: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .test-result-header {
            background-color: var(--secondary-color);
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .test-result-header:hover {
            background-color: #e9ecef;
        }

        .test-result-toggle {
            transition: transform 0.2s;
        }

        .test-result-toggle.expanded {
            transform: rotate(90deg);
        }

        .test-result-content {
            padding: 1rem;
            display: none;
        }

        .test-result-content.expanded {
            display: block;
        }

        .test-result {
            padding: 1rem;
            border-radius: 6px;
            margin: 0.5rem 0;
        }

        .test-result.success {
            background-color: #d1fae5;
            border: 1px solid #10a37f;
            color: #065f46;
        }

        .test-result.error {
            background-color: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }

        .test-result.info {
            background-color: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .chat-response {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            white-space: pre-wrap;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
        }

        .usage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .usage-stat {
            background-color: var(--secondary-color);
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
        }

        .usage-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .usage-stat-label {
            font-size: 0.875rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            border-top: 1px solid var(--border-color);
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Google Gemini API æ–‡æ¡£</h1>
            <p>å®Œæ•´çš„Google Gemini APIæ¥å£æ–‡æ¡£ï¼Œæ”¯æŒèŠå¤©å¯¹è¯ã€æ¨¡å‹æŸ¥è¯¢ç­‰åŠŸèƒ½</p>
        </div>

        <nav class="nav">
            <ul>
                <li><a href="#overview">æ¦‚è¿°</a></li>
                <li><a href="#authentication">è®¤è¯</a></li>
                <li><a href="#models">æ¨¡å‹ç®¡ç†</a></li>
                <li><a href="#chat">èŠå¤©å¯¹è¯</a></li>
                <li><a href="#simple-chat">ç®€å•èŠå¤©</a></li>
                <li><a href="#testing">APIæµ‹è¯•</a></li>
            </ul>
        </nav>

        <!-- æ¦‚è¿° -->
        <div class="api-section" id="overview">
            <h2>ğŸ“‹ æ¦‚è¿°</h2>
            <div class="api-endpoint">
                <p>Google Gemini APIæä¾›äº†å¼ºå¤§çš„AIèŠå¤©åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ¨¡å‹å’Œå‚æ•°é…ç½®ã€‚æœ¬æœåŠ¡é›†æˆäº†Google Geminiçš„å®˜æ–¹APIï¼Œæä¾›ç®€å•æ˜“ç”¨çš„æ¥å£ã€‚</p>
                
                <h3>ğŸ”‘ ä¸»è¦åŠŸèƒ½</h3>
                <ul>
                    <li><strong>æ¨¡å‹ç®¡ç†</strong>: æŸ¥è¯¢å¯ç”¨çš„Geminiæ¨¡å‹åˆ—è¡¨</li>
                    <li><strong>èŠå¤©å¯¹è¯</strong>: æ”¯æŒå¤šè½®å¯¹è¯å’Œå¤æ‚æ¶ˆæ¯ç»“æ„</li>
                    <li><strong>ç®€å•èŠå¤©</strong>: ç³»ç»Ÿæç¤ºè¯ + ç”¨æˆ·æç¤ºè¯çš„ç®€åŒ–æ¥å£</li>
                    <li><strong>å‚æ•°é…ç½®</strong>: æ”¯æŒæ¸©åº¦ã€æœ€å¤§ä»¤ç‰Œæ•°ç­‰å‚æ•°è°ƒæ•´</li>
                    <li><strong>å®‰å…¨è®¾ç½®</strong>: å†…ç½®å®‰å…¨è¿‡æ»¤å’Œå†…å®¹å®¡æ ¸</li>
                    <li><strong>ä½¿ç”¨ç»Ÿè®¡</strong>: æ˜¾ç¤ºTokenä½¿ç”¨æƒ…å†µå’Œæˆæœ¬ä¿¡æ¯</li>
                </ul>

                <h3>ğŸ“Š æ”¯æŒçš„æ¨¡å‹</h3>
                <ul>
                    <li><strong>Gemini 2.5 Pro</strong>: æœ€å¼ºå¤§çš„æ¨¡å‹ï¼Œæ“…é•¿æ¨ç†ã€å¤šæ¨¡æ€ç†è§£ã€é«˜çº§ç¼–ç¨‹ç­‰å¤æ‚ä»»åŠ¡</li>
                    <li><strong>Gemini 2.5 Flash</strong>: å¿«é€Ÿä¸”æˆæœ¬æ•ˆç›Šé«˜ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿå“åº”å’Œé«˜ååé‡çš„ä»»åŠ¡ï¼ˆæ¨èï¼‰</li>
                    <li><strong>Gemini 2.5 Flash-Lite</strong>: æœ€ç»æµå®æƒ çš„ä»·æ ¼ï¼Œé€‚åˆç®€å•ä»»åŠ¡çš„é«˜ååé‡</li>
                    <li><strong>Gemini 2.0 Flash</strong>: å¿«é€Ÿå“åº”çš„æ¨¡å‹</li>
                    <li><strong>Gemini 1.5 Pro</strong>: å¼ºå¤§çš„ä¸“ä¸šæ¨¡å‹</li>
                    <li><strong>Gemini 1.5 Flash</strong>: å¿«é€Ÿå“åº”çš„è½»é‡çº§æ¨¡å‹</li>
                    <li><strong>Gemini Pro</strong>: ç»å…¸çš„æ–‡æœ¬ç”Ÿæˆæ¨¡å‹</li>
                    <li><strong>Gemini Pro Vision</strong>: æ”¯æŒå›¾åƒç†è§£çš„æ¨¡å‹</li>
                </ul>
            </div>
        </div>

        <!-- è®¤è¯ -->
        <div class="api-section" id="authentication">
            <h2>ğŸ” è®¤è¯</h2>
            <div class="api-endpoint">
                <p>ä½¿ç”¨Gemini APIéœ€è¦æœ‰æ•ˆçš„API Keyã€‚è¯·ç¡®ä¿åœ¨å‡­æ®ç®¡ç†ä¸­æ­£ç¡®é…ç½®äº†API Keyã€‚</p>
                
                <div class="endpoint-example">
                    <pre><code># API Keyè®¤è¯
https://generativelanguage.googleapis.com/v1beta/models?key=YOUR_API_KEY</code></pre>
                </div>
            </div>
        </div>

        <!-- æ¨¡å‹ç®¡ç† -->
        <div class="api-section" id="models">
            <h2>ğŸ¤– æ¨¡å‹ç®¡ç†</h2>
            
            <div class="api-endpoint">
                <div class="endpoint-header">
                    <span class="method get">GET</span>
                    <span class="url">/api/gemini/gemini/models</span>
                    <button class="btn btn-primary" onclick="testApi('GET', '/api/gemini/gemini/models', null, 'models-test')">æµ‹è¯•</button>
                </div>
                <div class="endpoint-description">è·å–å¯ç”¨çš„Geminiæ¨¡å‹åˆ—è¡¨</div>
                <div class="endpoint-example">
                    <pre><code>curl -X GET http://localhost:3000/api/gemini/gemini/models</code></pre>
                </div>
                <div id="models-test" class="test-result-container"></div>
            </div>
        </div>

        <!-- èŠå¤©å¯¹è¯ -->
        <div class="api-section" id="chat">
            <h2>ğŸ’¬ èŠå¤©å¯¹è¯</h2>
            
            <div class="api-endpoint">
                <div class="endpoint-header">
                    <span class="method post">POST</span>
                    <span class="url">/api/gemini/gemini/chat</span>
                    <button class="btn btn-primary" onclick="testChatAPI()">æµ‹è¯•</button>
                </div>
                <div class="endpoint-description">å‘é€èŠå¤©æ¶ˆæ¯åˆ°Geminiï¼Œæ”¯æŒå¤šè½®å¯¹è¯</div>
                <div class="endpoint-example">
                    <pre><code>curl -X POST http://localhost:3000/api/gemini/gemini/chat \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"}
    ],
    "options": {
      "model": "gemini-2.5-flash",
      "temperature": 0.7,
      "max_tokens": 1000
    }
  }'</code></pre>
                </div>

                <h3>ğŸ“‹ è¯·æ±‚å‚æ•°</h3>
                <div class="endpoint-example">
                    <pre><code>{
  "messages": [
    {
      "role": "user",       // ç”¨æˆ·è§’è‰²
      "content": "ç”¨æˆ·æ¶ˆæ¯"
    },
    {
      "role": "model",      // æ¨¡å‹è§’è‰²
      "content": "æ¨¡å‹å›å¤"
    }
  ],
  "options": {
    "model": "gemini-pro",              // æ¨¡å‹åç§°
    "temperature": 0.7,                 // æ¸©åº¦ (0-2)
    "max_tokens": 1000,                 // æœ€å¤§ä»¤ç‰Œæ•°
    "top_p": 1,                         // Top-pé‡‡æ ·
    "top_k": 40,                        // Top-ké‡‡æ ·
    "safety_settings": true             // å®‰å…¨è®¾ç½®
  }
}</code></pre>
                </div>

                <h3>ğŸ”§ èŠå¤©å‚æ•°è¾“å…¥</h3>
                <div class="endpoint-input">
                    <label for="chat-system-prompt">ç³»ç»Ÿæç¤ºè¯:</label>
                    <textarea id="chat-system-prompt" placeholder="ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ï¼Œè¯·ç”¨ä¸­æ–‡å›ç­”é—®é¢˜ã€‚"></textarea>
                </div>
                <div class="endpoint-input">
                    <label for="chat-user-prompt">ç”¨æˆ·æç¤ºè¯:</label>
                    <textarea id="chat-user-prompt" placeholder="è¯·ä»‹ç»ä¸€ä¸‹Google Geminiçš„ä¸»è¦ç‰¹ç‚¹ã€‚"></textarea>
                </div>
                <div class="endpoint-input">
                    <label for="chat-model">æ¨¡å‹:</label>
                    <select id="chat-model">
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (æœ€å¼ºå¤§)</option>
                        <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash (æ¨è)</option>
                        <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite (æœ€ç»æµ)</option>
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="gemini-pro">Gemini Pro</option>
                        <option value="gemini-pro-vision">Gemini Pro Vision</option>
                    </select>
                </div>
                <div class="endpoint-input">
                    <label for="chat-temperature">æ¸©åº¦ (0-2):</label>
                    <input type="number" id="chat-temperature" min="0" max="2" step="0.1" value="0.7">
                </div>
                <div class="endpoint-input">
                    <label for="chat-max-tokens">æœ€å¤§ä»¤ç‰Œæ•°:</label>
                    <input type="number" id="chat-max-tokens" min="1" max="8192" value="1000">
                </div>
                <div class="endpoint-input">
                    <button class="btn btn-primary" onclick="testChatAPI()">ğŸ’¬ å‘é€èŠå¤©</button>
                    <button class="btn btn-secondary" onclick="clearChatInputs()">ğŸ—‘ï¸ æ¸…ç©ºè¾“å…¥</button>
                </div>
                <div id="chat-test" class="test-result-container"></div>
            </div>
        </div>

        <!-- ç®€å•èŠå¤© -->
        <div class="api-section" id="simple-chat">
            <h2>ğŸ’­ ç®€å•èŠå¤©</h2>
            
            <div class="api-endpoint">
                <div class="endpoint-header">
                    <span class="method post">POST</span>
                    <span class="url">/api/gemini/gemini/simple-chat</span>
                    <button class="btn btn-primary" onclick="testSimpleChatAPI()">æµ‹è¯•</button>
                </div>
                <div class="endpoint-description">ç®€åŒ–çš„èŠå¤©æ¥å£ï¼Œæ”¯æŒç³»ç»Ÿæç¤ºè¯å’Œç”¨æˆ·æç¤ºè¯</div>
                <div class="endpoint-example">
                    <pre><code>curl -X POST http://localhost:3000/api/gemini/gemini/simple-chat \
  -H "Content-Type: application/json" \
  -d '{
    "system_prompt": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹",
    "user_prompt": "è¯·ä»‹ç»ä¸€ä¸‹Google Gemini",
    "options": {
      "model": "gemini-2.5-flash",
      "temperature": 0.7,
      "max_tokens": 1000
    }
  }'</code></pre>
                </div>

                <h3>ğŸ“‹ è¯·æ±‚å‚æ•°</h3>
                <div class="endpoint-example">
                    <pre><code>{
  "system_prompt": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹",  // ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯é€‰ï¼‰
  "user_prompt": "è¯·ä»‹ç»ä¸€ä¸‹Google Gemini", // ç”¨æˆ·æç¤ºè¯ï¼ˆå¯é€‰ï¼‰
  "options": {
    "model": "gemini-pro",              // æ¨¡å‹åç§°
    "temperature": 0.7,                 // æ¸©åº¦
    "max_tokens": 1000                  // æœ€å¤§ä»¤ç‰Œæ•°
  }
}</code></pre>
                </div>

                <h3>ğŸ”§ ç®€å•èŠå¤©å‚æ•°è¾“å…¥</h3>
                <div class="endpoint-input">
                    <label for="simple-system-prompt">ç³»ç»Ÿæç¤ºè¯:</label>
                    <textarea id="simple-system-prompt" placeholder="ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ï¼Œè¯·ç”¨ä¸­æ–‡å›ç­”é—®é¢˜ã€‚"></textarea>
                </div>
                <div class="endpoint-input">
                    <label for="simple-user-prompt">ç”¨æˆ·æç¤ºè¯:</label>
                    <textarea id="simple-user-prompt" placeholder="è¯·ä»‹ç»ä¸€ä¸‹Google Geminiçš„ä¸»è¦ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ã€‚"></textarea>
                </div>
                <div class="endpoint-input">
                    <label for="simple-model">æ¨¡å‹:</label>
                    <select id="simple-model">
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (æœ€å¼ºå¤§)</option>
                        <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash (æ¨è)</option>
                        <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite (æœ€ç»æµ)</option>
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="gemini-pro">Gemini Pro</option>
                        <option value="gemini-pro-vision">Gemini Pro Vision</option>
                    </select>
                </div>
                <div class="endpoint-input">
                    <label for="simple-temperature">æ¸©åº¦ (0-2):</label>
                    <input type="number" id="simple-temperature" min="0" max="2" step="0.1" value="0.7">
                </div>
                <div class="endpoint-input">
                    <label for="simple-max-tokens">æœ€å¤§ä»¤ç‰Œæ•°:</label>
                    <input type="number" id="simple-max-tokens" min="1" max="8192" value="1000">
                </div>
                <div class="endpoint-input">
                    <button class="btn btn-primary" onclick="testSimpleChatAPI()">ğŸ’­ å‘é€ç®€å•èŠå¤©</button>
                    <button class="btn btn-secondary" onclick="clearSimpleChatInputs()">ğŸ—‘ï¸ æ¸…ç©ºè¾“å…¥</button>
                </div>
                <div id="simple-chat-test" class="test-result-container"></div>
            </div>
        </div>

        <!-- APIæµ‹è¯• -->
        <div class="api-section" id="testing">
            <h2>ğŸ§ª APIæµ‹è¯•</h2>
            <div class="api-endpoint">
                <p>ä½¿ç”¨ä¸‹é¢çš„å·¥å…·æµ‹è¯•Gemini APIçš„å„ç§åŠŸèƒ½ã€‚</p>
                
                <div class="endpoint-input">
                    <button class="btn btn-primary" onclick="testAllAPIs()">ğŸš€ æµ‹è¯•æ‰€æœ‰API</button>
                    <button class="btn btn-secondary" onclick="clearAllTests()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æµ‹è¯•</button>
                </div>
                
                <div id="all-tests" class="test-result-container"></div>
            </div>
        </div>

        <div class="footer">
            <p>Google Gemini API æ–‡æ¡£ | ç”± Credential Service æä¾›æ”¯æŒ</p>
        </div>
    </div>

    <script>
        // é€šç”¨APIæµ‹è¯•å‡½æ•°
        async function testApi(method, url, data = null, containerId = null) {
            const resultsContainer = containerId ? document.getElementById(containerId) : document.getElementById('all-tests');
            const timestamp = new Date().toLocaleTimeString();
            
            const testId = `test-${Date.now()}`;
            resultsContainer.innerHTML = `
                <div class="test-result-container" id="${testId}">
                    <div class="test-result-header" onclick="toggleTestResult('${testId}')">
                        <span>ğŸ§ª æµ‹è¯• ${method} ${url}</span>
                        <span class="test-result-toggle">â–¶</span>
                    </div>
                    <div class="test-result-content">
                        <div class="test-result info">
                            <div>æ—¶é—´: ${timestamp}</div>
                            <div>çŠ¶æ€: æ­£åœ¨æµ‹è¯•...</div>
                        </div>
                    </div>
                </div>
            `;
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data && (method === 'POST' || method === 'PUT')) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(url, options);
                const responseData = await response.text();
                
                let parsedData;
                try {
                    parsedData = JSON.parse(responseData);
                } catch (e) {
                    parsedData = responseData;
                }
                
                const resultClass = response.ok ? 'success' : 'error';
                const statusText = response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
                
                let resultsHtml = `
                    <div class="test-result ${resultClass}">
                        <div><strong>APIæµ‹è¯•ç»“æœ</strong></div>
                        <div>çŠ¶æ€: ${statusText}</div>
                        <div>HTTPçŠ¶æ€: ${response.status}</div>
                        <div>å“åº”æ—¶é—´: ${response.headers.get('X-Response-Time') || 'N/A'}</div>
                `;
                
                if (response.ok && parsedData.success) {
                    if (parsedData.data && parsedData.data.response_text) {
                        resultsHtml += `
                            <div><strong>AIå›å¤:</strong></div>
                            <div class="chat-response">${parsedData.data.response_text}</div>
                        `;
                    }
                    
                    if (parsedData.data && parsedData.data.usage) {
                        resultsHtml += `
                            <div><strong>ä½¿ç”¨ç»Ÿè®¡:</strong></div>
                            <div class="usage-stats">
                                <div class="usage-stat">
                                    <div class="usage-stat-value">${parsedData.data.usage.total_tokens || 0}</div>
                                    <div class="usage-stat-label">æ€»ä»¤ç‰Œæ•°</div>
                                </div>
                                <div class="usage-stat">
                                    <div class="usage-stat-value">${parsedData.data.usage.prompt_tokens || 0}</div>
                                    <div class="usage-stat-label">æç¤ºä»¤ç‰Œ</div>
                                </div>
                                <div class="usage-stat">
                                    <div class="usage-stat-value">${parsedData.data.usage.completion_tokens || 0}</div>
                                    <div class="usage-stat-label">å®Œæˆä»¤ç‰Œ</div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                resultsHtml += `
                        <details>
                            <summary>æŸ¥çœ‹å®Œæ•´å“åº”</summary>
                            <pre>${JSON.stringify(parsedData, null, 2)}</pre>
                        </details>
                    </div>
                `;
                
                const contentElement = document.getElementById(testId).querySelector('.test-result-content');
                contentElement.innerHTML = resultsHtml;
                
            } catch (error) {
                const contentElement = document.getElementById(testId).querySelector('.test-result-content');
                contentElement.innerHTML = `
                    <div class="test-result error">
                        <div>âŒ æµ‹è¯•å¤±è´¥</div>
                        <div>é”™è¯¯: ${error.message}</div>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢æµ‹è¯•ç»“æœæ˜¾ç¤º
        function toggleTestResult(testId) {
            const testResultElement = document.getElementById(testId);
            const contentElement = testResultElement.querySelector('.test-result-content');
            const toggleElement = testResultElement.querySelector('.test-result-toggle');
            
            if (contentElement.classList.contains('expanded')) {
                contentElement.classList.remove('expanded');
                toggleElement.classList.remove('expanded');
            } else {
                contentElement.classList.add('expanded');
                toggleElement.classList.add('expanded');
            }
        }

        // æµ‹è¯•èŠå¤©API
        async function testChatAPI() {
            const container = document.getElementById('chat-test');
            const timestamp = new Date().toLocaleTimeString();
            
            // æ”¶é›†è¾“å…¥å‚æ•°
            const systemPrompt = document.getElementById('chat-system-prompt').value.trim();
            const userPrompt = document.getElementById('chat-user-prompt').value.trim();
            const model = document.getElementById('chat-model').value;
            const temperature = parseFloat(document.getElementById('chat-temperature').value);
            const maxTokens = parseInt(document.getElementById('chat-max-tokens').value);
            
            if (!systemPrompt && !userPrompt) {
                alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæç¤ºè¯ï¼ˆç³»ç»Ÿæç¤ºè¯æˆ–ç”¨æˆ·æç¤ºè¯ï¼‰');
                return;
            }
            
            // æ„å»ºæ¶ˆæ¯æ•°ç»„
            const messages = [];
            if (systemPrompt) {
                messages.push({
                    role: 'user',
                    content: `${systemPrompt}\n\n${userPrompt || 'è¯·å›ç­”æˆ‘çš„é—®é¢˜ã€‚'}`
                });
            } else if (userPrompt) {
                messages.push({
                    role: 'user',
                    content: userPrompt
                });
            }
            
            const options = {
                model: model,
                temperature: temperature,
                max_tokens: maxTokens
            };
            
            const testId = `chat-test-${Date.now()}`;
            container.innerHTML = `
                <div class="test-result-container" id="${testId}">
                    <div class="test-result-header" onclick="toggleTestResult('${testId}')">
                        <span>ğŸ’¬ æµ‹è¯•èŠå¤©API</span>
                        <span class="test-result-toggle">â–¶</span>
                    </div>
                    <div class="test-result-content">
                        <div class="test-result info">
                            <div>æ—¶é—´: ${timestamp}</div>
                            <div>çŠ¶æ€: æ­£åœ¨æµ‹è¯•...</div>
                            <div>æ¨¡å‹: ${model}</div>
                        </div>
                    </div>
                </div>
            `;
            
            try {
                const response = await fetch('/api/gemini/gemini/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ messages, options })
                });
                
                const data = await response.json();
                const resultClass = response.ok ? 'success' : 'error';
                const statusText = response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
                
                let resultsHtml = `
                    <div class="test-result ${resultClass}">
                        <div><strong>èŠå¤©APIæµ‹è¯•ç»“æœ</strong></div>
                        <div>çŠ¶æ€: ${statusText}</div>
                        <div>æ¨¡å‹: ${data.data?.model || 'N/A'}</div>
                        <div>å®ŒæˆåŸå› : ${data.data?.finish_reason || 'N/A'}</div>
                `;
                
                if (data.success && data.data?.response_text) {
                    resultsHtml += `
                        <div><strong>AIå›å¤:</strong></div>
                        <div class="chat-response">${data.data.response_text}</div>
                    `;
                }
                
                if (data.data?.usage) {
                    resultsHtml += `
                        <div><strong>ä½¿ç”¨ç»Ÿè®¡:</strong></div>
                        <div class="usage-stats">
                            <div class="usage-stat">
                                <div class="usage-stat-value">${data.data.usage.total_tokens || 0}</div>
                                <div class="usage-stat-label">æ€»ä»¤ç‰Œæ•°</div>
                            </div>
                            <div class="usage-stat">
                                <div class="usage-stat-value">${data.data.usage.prompt_tokens || 0}</div>
                                <div class="usage-stat-label">æç¤ºä»¤ç‰Œ</div>
                            </div>
                            <div class="usage-stat">
                                <div class="usage-stat-value">${data.data.usage.completion_tokens || 0}</div>
                                <div class="usage-stat-label">å®Œæˆä»¤ç‰Œ</div>
                            </div>
                        </div>
                    `;
                }
                
                resultsHtml += `
                        <details>
                            <summary>æŸ¥çœ‹å®Œæ•´å“åº”</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
                
                const contentElement = document.getElementById(testId).querySelector('.test-result-content');
                contentElement.innerHTML = resultsHtml;
                
            } catch (error) {
                const contentElement = document.getElementById(testId).querySelector('.test-result-content');
                contentElement.innerHTML = `
                    <div class="test-result error">
                        <div>âŒ æµ‹è¯•å¤±è´¥</div>
                        <div>é”™è¯¯: ${error.message}</div>
                    </div>
                `;
            }
        }

        // æµ‹è¯•ç®€å•èŠå¤©API
        async function testSimpleChatAPI() {
            const container = document.getElementById('simple-chat-test');
            const timestamp = new Date().toLocaleTimeString();
            
            // æ”¶é›†è¾“å…¥å‚æ•°
            const systemPrompt = document.getElementById('simple-system-prompt').value.trim();
            const userPrompt = document.getElementById('simple-user-prompt').value.trim();
            const model = document.getElementById('simple-model').value;
            const temperature = parseFloat(document.getElementById('simple-temperature').value);
            const maxTokens = parseInt(document.getElementById('simple-max-tokens').value);
            
            if (!systemPrompt && !userPrompt) {
                alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæç¤ºè¯ï¼ˆç³»ç»Ÿæç¤ºè¯æˆ–ç”¨æˆ·æç¤ºè¯ï¼‰');
                return;
            }
            
            const options = {
                model: model,
                temperature: temperature,
                max_tokens: maxTokens
            };
            
            const testId = `simple-chat-test-${Date.now()}`;
            container.innerHTML = `
                <div class="test-result-container" id="${testId}">
                    <div class="test-result-header" onclick="toggleTestResult('${testId}')">
                        <span>ğŸ’­ æµ‹è¯•ç®€å•èŠå¤©API</span>
                        <span class="test-result-toggle">â–¶</span>
                    </div>
                    <div class="test-result-content">
                        <div class="test-result info">
                            <div>æ—¶é—´: ${timestamp}</div>
                            <div>çŠ¶æ€: æ­£åœ¨æµ‹è¯•...</div>
                            <div>æ¨¡å‹: ${model}</div>
                        </div>
                    </div>
                </div>
            `;
            
            try {
                const response = await fetch('/api/gemini/gemini/simple-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        system_prompt: systemPrompt, 
                        user_prompt: userPrompt, 
                        options 
                    })
                });
                
                const data = await response.json();
                const resultClass = response.ok ? 'success' : 'error';
                const statusText = response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
                
                let resultsHtml = `
                    <div class="test-result ${resultClass}">
                        <div><strong>ç®€å•èŠå¤©APIæµ‹è¯•ç»“æœ</strong></div>
                        <div>çŠ¶æ€: ${statusText}</div>
                        <div>æ¨¡å‹: ${data.data?.model || 'N/A'}</div>
                        <div>å®ŒæˆåŸå› : ${data.data?.finish_reason || 'N/A'}</div>
                `;
                
                if (data.success && data.data?.response_text) {
                    resultsHtml += `
                        <div><strong>AIå›å¤:</strong></div>
                        <div class="chat-response">${data.data.response_text}</div>
                    `;
                }
                
                if (data.data?.usage) {
                    resultsHtml += `
                        <div><strong>ä½¿ç”¨ç»Ÿè®¡:</strong></div>
                        <div class="usage-stats">
                            <div class="usage-stat">
                                <div class="usage-stat-value">${data.data.usage.total_tokens || 0}</div>
                                <div class="usage-stat-label">æ€»ä»¤ç‰Œæ•°</div>
                            </div>
                            <div class="usage-stat">
                                <div class="usage-stat-value">${data.data.usage.prompt_tokens || 0}</div>
                                <div class="usage-stat-label">æç¤ºä»¤ç‰Œ</div>
                            </div>
                            <div class="usage-stat">
                                <div class="usage-stat-value">${data.data.usage.completion_tokens || 0}</div>
                                <div class="usage-stat-label">å®Œæˆä»¤ç‰Œ</div>
                            </div>
                        </div>
                    `;
                }
                
                resultsHtml += `
                        <details>
                            <summary>æŸ¥çœ‹å®Œæ•´å“åº”</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
                
                const contentElement = document.getElementById(testId).querySelector('.test-result-content');
                contentElement.innerHTML = resultsHtml;
                
            } catch (error) {
                const contentElement = document.getElementById(testId).querySelector('.test-result-content');
                contentElement.innerHTML = `
                    <div class="test-result error">
                        <div>âŒ æµ‹è¯•å¤±è´¥</div>
                        <div>é”™è¯¯: ${error.message}</div>
                    </div>
                `;
            }
        }

        // æ¸…ç©ºèŠå¤©è¾“å…¥
        function clearChatInputs() {
            document.getElementById('chat-system-prompt').value = '';
            document.getElementById('chat-user-prompt').value = '';
            document.getElementById('chat-model').value = 'gemini-2.5-flash';
            document.getElementById('chat-temperature').value = '0.7';
            document.getElementById('chat-max-tokens').value = '1000';
        }

        // æ¸…ç©ºç®€å•èŠå¤©è¾“å…¥
        function clearSimpleChatInputs() {
            document.getElementById('simple-system-prompt').value = '';
            document.getElementById('simple-user-prompt').value = '';
            document.getElementById('simple-model').value = 'gemini-2.5-flash';
            document.getElementById('simple-temperature').value = '0.7';
            document.getElementById('simple-max-tokens').value = '1000';
        }

        // æµ‹è¯•æ‰€æœ‰API
        async function testAllAPIs() {
            const container = document.getElementById('all-tests');
            container.innerHTML = '<div class="test-result info">æ­£åœ¨æµ‹è¯•æ‰€æœ‰API...</div>';
            
            // æµ‹è¯•æ¨¡å‹åˆ—è¡¨
            await testApi('GET', '/api/gemini/gemini/models', null, 'all-tests');
            
            // æµ‹è¯•è¿æ¥
            await testApi('POST', '/api/gemini/gemini/test-connection', {}, 'all-tests');
            
            // æµ‹è¯•ç®€å•èŠå¤©
            await testApi('POST', '/api/gemini/gemini/simple-chat', {
                system_prompt: 'ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹',
                user_prompt: 'è¯·ç®€å•ä»‹ç»ä¸€ä¸‹Google Gemini',
                options: {
                    model: 'gemini-2.5-flash',
                    temperature: 0.7,
                    max_tokens: 500
                }
            }, 'all-tests');
        }

        // æ¸…ç©ºæ‰€æœ‰æµ‹è¯•
        function clearAllTests() {
            document.getElementById('all-tests').innerHTML = '';
        }
    </script>
</body>
</html>
