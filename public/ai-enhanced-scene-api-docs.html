<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ AI Enhanced Scene API æµ‹è¯•æ–‡æ¡£</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --light: #f5f5f5;
            --dark: #1f2937;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .panel {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-success {
            background: var(--success);
            color: white;
        }

        .status-error {
            background: var(--danger);
            color: white;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #0891b2;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #2563eb;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }

        .result-box {
            background: var(--dark);
            color: #00ff00;
            padding: 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--light);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
            opacity: 0.6;
            transition: all 0.3s;
        }

        .tab:hover {
            opacity: 0.8;
        }

        .tab.active {
            opacity: 1;
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .info-box {
            background: #f0f9ff;
            border-left: 4px solid var(--info);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .warning-box {
            background: #fffbeb;
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .prompt-view {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .prompt-title {
            font-weight: 600;
            color: var(--dark);
        }

        .prompt-content {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 1rem;
            border-radius: 0.25rem;
        }

        .prompt-textarea {
            width: 100%;
            min-height: 400px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            padding: 1rem;
            border: 2px solid var(--primary);
            border-radius: 0.25rem;
            resize: vertical;
        }

        .prompt-textarea:focus {
            outline: none;
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .edit-mode {
            display: none;
        }

        .view-mode {
            display: block;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .home-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
            transition: all 0.3s;
        }

        .home-btn:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ AI Enhanced Scene API</h1>
            <p>æ™ºèƒ½åœºæ™¯ç®¡ç† - æ‰§è¡Œã€åˆ›å»ºã€åˆ é™¤åœºæ™¯</p>
        </div>

        <!-- Prompts Management Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    ğŸ“ AI æç¤ºè¯ç®¡ç†
                </div>
                <button class="btn btn-secondary" onclick="loadPrompts()">ğŸ”„ åˆ·æ–°æç¤ºè¯</button>
            </div>

            <div class="info-box">
                <strong>æç¤ºè¯è¯´æ˜ï¼š</strong> ç³»ç»Ÿä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„ AI æç¤ºè¯æ¥å¤„ç†ä¸åŒçš„åœºæ™¯æ“ä½œï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å’Œä¿®æ”¹è¿™äº›æç¤ºè¯ã€‚
            </div>

            <div id="promptsContainer"></div>
        </div>

        <!-- Test Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    ğŸ§ª API æµ‹è¯•
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('list')">ğŸ“‹ æŸ¥çœ‹åœºæ™¯åˆ—è¡¨</button>
                <button class="tab" onclick="switchTab('execute')">ğŸ¬ æ‰§è¡Œåœºæ™¯</button>
                <button class="tab" onclick="switchTab('create')">â• åˆ›å»ºåœºæ™¯</button>
                <button class="tab" onclick="switchTab('delete')">ğŸ—‘ï¸ åˆ é™¤åœºæ™¯</button>
            </div>

            <!-- List Scenes Tab -->
            <div id="list-tab" class="tab-content active">
                <div class="form-group">
                    <label class="form-label">è¾“å…¥æ•°æ®ï¼ˆæ¥è‡ª Intention æ¨¡å—ï¼‰</label>
                    <textarea id="listInput" class="form-control" placeholder="ç²˜è´´æ¥è‡ª Intention æ¨¡å—çš„ JSON æ•°æ®...">{"success":true,"data":{"intent":"Set Scene","user_input":"ç³»ç»Ÿæœ‰å¤šå°‘ä¸ªåœºæ™¯","actions":[],"matched_devices":[],"scene":{"scene_name":"","scene_name_en":"","operation":"list","operation_type":"query","description":"æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰å·²ä¿å­˜çš„åœºæ™¯"},"automation":{}}}</textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-info" onclick="listScenes()">
                        <span id="listLoading" class="loading hidden"></span>
                        ğŸ“‹ æŸ¥çœ‹åœºæ™¯åˆ—è¡¨
                    </button>
                    <button class="btn btn-secondary" onclick="clearResult('listResult')">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
                </div>
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">åœºæ™¯åˆ—è¡¨ç»“æœ</label>
                    <div id="listResult" class="result-box">ç­‰å¾…æŸ¥è¯¢...</div>
                </div>
            </div>

            <!-- Execute Scene Tab -->
            <div id="execute-tab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">è¾“å…¥æ•°æ®ï¼ˆæ¥è‡ª Intention æ¨¡å—ï¼‰</label>
                    <textarea id="executeInput" class="form-control" placeholder="ç²˜è´´æ¥è‡ª Intention æ¨¡å—çš„ JSON æ•°æ®...">{"success":true,"data":{"intent":"Control Scene","user_input":"æˆ‘å›æ¥äº†","actions":[],"matched_devices":[],"scene":{"scene_name":"å›å®¶æ¨¡å¼","scene_name_en":"arrival_home","operation":"execute","operation_type":"control","description":"å¯åŠ¨å›å®¶æ¨¡å¼åœºæ™¯"},"automation":{}}}</textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="executeScene()">
                        <span id="executeLoading" class="loading hidden"></span>
                        ğŸ¬ æ‰§è¡Œåœºæ™¯
                    </button>
                    <button class="btn btn-secondary" onclick="clearResult('executeResult')">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
                </div>
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">æ‰§è¡Œç»“æœ</label>
                    <div id="executeResult" class="result-box">ç­‰å¾…æ‰§è¡Œ...</div>
                </div>
            </div>

            <!-- Create Scene Tab -->
            <div id="create-tab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">è¾“å…¥æ•°æ®ï¼ˆæ¥è‡ª Intention æ¨¡å—ï¼‰</label>
                    <textarea id="createInput" class="form-control" placeholder="ç²˜è´´æ¥è‡ª Intention æ¨¡å—çš„ JSON æ•°æ®...">{"success":true,"data":{"intent":"Set Scene","user_input":"è¯»å–å®¢å…æ‰€æœ‰è®¾å¤‡å½“å‰çŠ¶æ€åˆ›å»ºæˆ‘å›å®¶äº†çš„åœºæ™¯","actions":[{"request":{"floor":null,"room":"living_room","device_name":null,"device_type":"light","service":"light.state","service_data":{}},"targets":[{"entity_id":"light.light_test_001","device_type":"light","device_name":"Floor light","floor":"First Floor","room":"Living Room","score":0.677}]}],"matched_devices":[{"entity_id":"light.light_test_001","service":"light.state","service_data":{}}],"scene":{"scene_name":"æˆ‘å›å®¶äº†","scene_name_en":"arrival_home","operation":"add","operation_type":"setup","description":"è¯»å–å®¢å…æ‰€æœ‰è®¾å¤‡å½“å‰çŠ¶æ€åˆ›å»ºå›å®¶åœºæ™¯"},"automation":{}}}</textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="createScene()">
                        <span id="createLoading" class="loading hidden"></span>
                        â• åˆ›å»ºåœºæ™¯
                    </button>
                    <button class="btn btn-secondary" onclick="clearResult('createResult')">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
                </div>
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">åˆ›å»ºç»“æœ</label>
                    <div id="createResult" class="result-box">ç­‰å¾…åˆ›å»º...</div>
                </div>
            </div>

            <!-- Delete Scene Tab -->
            <div id="delete-tab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">è¾“å…¥æ•°æ®ï¼ˆæ¥è‡ª Intention æ¨¡å—ï¼‰</label>
                    <textarea id="deleteInput" class="form-control" placeholder="ç²˜è´´æ¥è‡ª Intention æ¨¡å—çš„ JSON æ•°æ®...">{"success":true,"data":{"intent":"Set Scene","user_input":"åˆ é™¤æˆ‘å›å®¶åœºæ™¯","actions":[],"matched_devices":[],"scene":{"scene_name":"æˆ‘å›å®¶åœºæ™¯","scene_name_en":"arrival_home","operation":"delete","operation_type":"setup","description":"åˆ é™¤å›å®¶åœºæ™¯"},"automation":{}}}</textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="deleteScene()">
                        <span id="deleteLoading" class="loading hidden"></span>
                        ğŸ—‘ï¸ åˆ é™¤åœºæ™¯
                    </button>
                    <button class="btn btn-secondary" onclick="clearResult('deleteResult')">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
                </div>
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">åˆ é™¤ç»“æœ</label>
                    <div id="deleteResult" class="result-box">ç­‰å¾…åˆ é™¤...</div>
                </div>
            </div>
        </div>

        <!-- API Documentation Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    ğŸ“– API æ¥å£æ–‡æ¡£
                </div>
            </div>

            <div class="info-box">
                <strong>âš ï¸ é‡è¦ï¼šAPI åŸºç¡€ä¿¡æ¯</strong>
                <ul style="margin: 0.5rem 0 0 1.5rem;">
                    <li>æ‰€æœ‰ API æ¥å£ä½¿ç”¨ <code>/api/ai_enhanced_scene/:module</code> ä½œä¸ºè·¯å¾„æ¨¡æ¿</li>
                    <li><code>:module</code> å‚æ•°å¿…é¡»æ›¿æ¢ä¸º <code>ai_enhanced_scene</code></li>
                    <li><strong>æ­£ç¡®çš„åŸºç¡€è·¯å¾„ï¼š</strong> <code style="background: #e0f2fe; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">/api/ai_enhanced_scene/ai_enhanced_scene</code></li>
                </ul>
            </div>

            <div class="api-section" style="margin-bottom: 2rem;">
                <h3 style="color: var(--info); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“‹</span>
                    <span>1. æŸ¥çœ‹åœºæ™¯åˆ—è¡¨ (List Scenes)</span>
                </h3>
                
                <div style="margin-bottom: 1rem;">
                    <strong>ç«¯ç‚¹ (Endpoint):</strong>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace;">
                        POST /api/ai_enhanced_scene/:module/list
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace; font-weight: 600;">
                        POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/list
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>æè¿°:</strong>
                    <p>è·å–æ‰€æœ‰å¯ç”¨åœºæ™¯åˆ—è¡¨ã€‚ç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥çš„è¯­è¨€ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰è¿”å›å¯¹åº”è¯­è¨€çš„æ¶ˆæ¯ã€‚æ”¯æŒè¯­è¨€è‡ªåŠ¨æ£€æµ‹ã€‚<br>
                    <strong>è¾“å…¥æ¥æºï¼š</strong>é€šå¸¸æ¥è‡ª Intention æ¨¡å—çš„è¾“å‡ºï¼Œå…¶ä¸­ <code>scene.operation</code> ä¸º <code>"list"</code>ã€‚</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>è¯·æ±‚æ ¼å¼ (Request):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
// æ¥è‡ª Intention æ¨¡å—çš„å®Œæ•´æ ¼å¼ï¼ˆæ¨èï¼‰
{
    "success": true,
    "data": {
        "intent": "Set Scene",
        "user_input": "ç³»ç»Ÿæœ‰å¤šå°‘ä¸ªåœºæ™¯",
        "actions": [],
        "matched_devices": [],
        "scene": {
            "scene_name": "",
            "scene_name_en": "",
            "operation": "list",
            "operation_type": "query",
            "description": "æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰å·²ä¿å­˜çš„åœºæ™¯"
        },
        "automation": {}
    }
}

// æˆ–è‹±æ–‡è¾“å…¥
{
    "success": true,
    "data": {
        "intent": "Set Scene",
        "user_input": "how many scenes in the system",
        "scene": {
            "operation": "list"
        }
    }
}

// ç®€åŒ–æ ¼å¼ï¼ˆä¹Ÿæ”¯æŒï¼‰
{
    "data": {
        "user_input": "æ˜¾ç¤ºæ‰€æœ‰åœºæ™¯"
    }
}</pre>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>å“åº”æ ¼å¼ (Response):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "scenes": [
            {
                "scene_id": "scene.arrival_home",
                "scene_name": "arrival_home",
                "friendly_name": "å›å®¶æ¨¡å¼",
                "entity_id": "scene.arrival_home"
            },
            {
                "scene_id": "scene.movie_mode",
                "scene_name": "movie_mode",
                "friendly_name": "è§‚å½±æ¨¡å¼",
                "entity_id": "scene.movie_mode"
            }
        ],
        "total": 2,
        "message": {
            "type": "notification",
            "content": "æ‰¾åˆ° 2 ä¸ªå¯ç”¨åœºæ™¯ï¼šå›å®¶æ¨¡å¼ã€è§‚å½±æ¨¡å¼",
            "source": "external_system"
        },
        "language": "zh",
        "processing_time_ms": 125
    }
}

// è‹±æ–‡è¾“å…¥çš„å“åº”
{
    "success": true,
    "data": {
        "scenes": [...],
        "total": 2,
        "message": {
            "type": "notification",
            "content": "Found 2 available scenes: Home Mode, Movie Mode",
            "source": "external_system"
        },
        "language": "en",
        "processing_time_ms": 125
    }
}

// é”™è¯¯å“åº”
{
    "success": false,
    "error": "è·å–åœºæ™¯åˆ—è¡¨å¤±è´¥",
    "details": "...",
    "message": {
        "type": "notification",
        "content": "è·å–åœºæ™¯åˆ—è¡¨å¤±è´¥",
        "source": "external_system"
    }
}</pre>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>ç‰¹æ€§:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        <li>âœ… è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¾“å…¥è¯­è¨€ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰</li>
                        <li>âœ… æ ¹æ®æ£€æµ‹çš„è¯­è¨€è¿”å›å¯¹åº”çš„æ¶ˆæ¯å†…å®¹</li>
                        <li>âœ… <strong>æ¶ˆæ¯ä¸­åˆ—å‡ºæ‰€æœ‰åœºæ™¯åç§°</strong></li>
                        <li>âœ… ä¸­æ–‡ä½¿ç”¨é¡¿å·åˆ†éš”ï¼ˆã€ï¼‰ï¼Œè‹±æ–‡ä½¿ç”¨é€—å·åˆ†éš”ï¼ˆ, ï¼‰</li>
                        <li>âœ… ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼ï¼š<code>{"type": "notification", "content": "...", "source": "external_system"}</code></li>
                        <li>âœ… æ”¯æŒ Intention æ¨¡å—çš„å®Œæ•´è¾“å‡ºæ ¼å¼</li>
                        <li>âœ… è¿”å›åœºæ™¯æ€»æ•°å’Œè¯¦ç»†åˆ—è¡¨</li>
                        <li>âœ… åŒ…å«å¤„ç†æ—¶é—´ç»Ÿè®¡</li>
                    </ul>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>è¯†åˆ«æ ‡å¿—:</strong>
                    <p style="margin: 0.5rem 0;">å½“ Intention æ¨¡å—è¯†åˆ«åˆ°æŸ¥è¯¢åœºæ™¯çš„æ„å›¾æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹ç‰¹å¾ï¼š</p>
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        <li><code>intent</code>: "Set Scene"</li>
                        <li><code>scene.operation</code>: "list"</li>
                        <li><code>scene.operation_type</code>: "query"</li>
                        <li><code>user_input</code>: åŒ…å«æŸ¥è¯¢å…³é”®è¯ï¼ˆå¦‚"å¤šå°‘ä¸ªåœºæ™¯"ã€"æœ‰å“ªäº›åœºæ™¯"ã€"list scenes"ç­‰ï¼‰</li>
                    </ul>
                </div>
            </div>

            <!-- Execute Scene API -->
            <div class="api-section" style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ¬</span>
                    <span>2. æ‰§è¡Œåœºæ™¯ (Execute Scene)</span>
                </h3>
                
                <div style="margin-bottom: 1rem;">
                    <strong>ç«¯ç‚¹ (Endpoint):</strong>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace;">
                        POST /api/ai_enhanced_scene/:module/execute
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace; font-weight: 600;">
                        POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/execute
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>æè¿°:</strong>
                    <p>æ ¹æ®ç”¨æˆ·æ„å›¾æ‰§è¡Œå·²å­˜åœ¨çš„åœºæ™¯ã€‚ç³»ç»Ÿä¼šä½¿ç”¨ AI åˆ†æç”¨æˆ·è¾“å…¥ï¼Œæ‰¾åˆ°åŒ¹é…çš„åœºæ™¯å¹¶æ‰§è¡Œã€‚</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>è¯·æ±‚æ ¼å¼ (Request):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "intent": "Control Scene",
        "user_input": "æˆ‘å›æ¥äº†",
        "actions": [],
        "matched_devices": [],
        "scene": {
            "scene_name": "å›å®¶æ¨¡å¼",
            "scene_name_en": "arrival_home",
            "operation": "execute",
            "operation_type": "control",
            "description": "å¯åŠ¨å›å®¶æ¨¡å¼åœºæ™¯"
        },
        "automation": {}
    }
}</pre>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>å“åº”æ ¼å¼ (Response):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "message": "åœºæ™¯æ‰§è¡ŒæˆåŠŸ",
        "scene_name": "arrival_home",
        "scene_id": "scene.arrival_home",
        "execution_result": {...}
    }
}

// é”™è¯¯å“åº”
{
    "success": false,
    "error": "åœºæ™¯ä¸å­˜åœ¨æˆ–æ‰§è¡Œå¤±è´¥",
    "details": "..."
}</pre>
                </div>
            </div>

            <!-- Create Scene API -->
            <div class="api-section" style="margin-bottom: 2rem;">
                <h3 style="color: var(--success); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>â•</span>
                    <span>3. åˆ›å»ºåœºæ™¯ (Create Scene)</span>
                </h3>
                
                <div style="margin-bottom: 1rem;">
                    <strong>ç«¯ç‚¹ (Endpoint):</strong>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace;">
                        POST /api/ai_enhanced_scene/:module/create
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace; font-weight: 600;">
                        POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/create
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>æè¿°:</strong>
                    <p>æ ¹æ®ç”¨æˆ·æ„å›¾å’Œè®¾å¤‡çŠ¶æ€åˆ›å»ºæ–°åœºæ™¯ã€‚ç³»ç»Ÿä¼šä½¿ç”¨ AI åˆ†æç”¨æˆ·è¾“å…¥ï¼Œè¯»å–ç›¸å…³è®¾å¤‡çš„å½“å‰çŠ¶æ€ï¼Œå¹¶åˆ›å»ºåœºæ™¯ã€‚</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>è¯·æ±‚æ ¼å¼ (Request):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "intent": "Set Scene",
        "user_input": "è¯»å–å®¢å…æ‰€æœ‰è®¾å¤‡å½“å‰çŠ¶æ€åˆ›å»ºæˆ‘å›å®¶äº†çš„åœºæ™¯",
        "actions": [
            {
                "request": {
                    "floor": null,
                    "room": "living_room",
                    "device_name": null,
                    "device_type": "light",
                    "service": "light.state",
                    "service_data": {}
                },
                "targets": [
                    {
                        "entity_id": "light.light_test_001",
                        "device_type": "light",
                        "device_name": "Floor light",
                        "floor": "First Floor",
                        "room": "Living Room",
                        "score": 0.677
                    }
                ]
            }
        ],
        "matched_devices": [
            {
                "entity_id": "light.light_test_001",
                "service": "light.state",
                "service_data": {}
            }
        ],
        "scene": {
            "scene_name": "æˆ‘å›å®¶äº†",
            "scene_name_en": "arrival_home",
            "operation": "add",
            "operation_type": "setup",
            "description": "è¯»å–å®¢å…æ‰€æœ‰è®¾å¤‡å½“å‰çŠ¶æ€åˆ›å»ºå›å®¶åœºæ™¯"
        },
        "automation": {}
    }
}</pre>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>å“åº”æ ¼å¼ (Response):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "message": "åœºæ™¯åˆ›å»ºæˆåŠŸ",
        "scene_name": "arrival_home",
        "scene_id": "scene.arrival_home",
        "entities": {
            "light.light_test_001": {
                "state": "on",
                "brightness": 255
            }
        }
    }
}

// é”™è¯¯å“åº”
{
    "success": false,
    "error": "åœºæ™¯åˆ›å»ºå¤±è´¥",
    "details": "..."
}</pre>
                </div>
            </div>

            <!-- Delete Scene API -->
            <div class="api-section" style="margin-bottom: 2rem;">
                <h3 style="color: var(--danger); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ—‘ï¸</span>
                    <span>4. åˆ é™¤åœºæ™¯ (Delete Scene)</span>
                </h3>
                
                <div style="margin-bottom: 1rem;">
                    <strong>ç«¯ç‚¹ (Endpoint):</strong>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace;">
                        POST /api/ai_enhanced_scene/:module/delete
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-family: monospace; font-weight: 600;">
                        POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/delete
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>æè¿°:</strong>
                    <p>æ ¹æ®ç”¨æˆ·æ„å›¾åˆ é™¤å·²å­˜åœ¨çš„åœºæ™¯ã€‚ç³»ç»Ÿä¼šä½¿ç”¨ AI åˆ†æç”¨æˆ·è¾“å…¥ï¼Œæ‰¾åˆ°åŒ¹é…çš„åœºæ™¯å¹¶åˆ é™¤ã€‚</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>è¯·æ±‚æ ¼å¼ (Request):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "intent": "Set Scene",
        "user_input": "åˆ é™¤æˆ‘å›å®¶åœºæ™¯",
        "actions": [],
        "matched_devices": [],
        "scene": {
            "scene_name": "æˆ‘å›å®¶åœºæ™¯",
            "scene_name_en": "arrival_home",
            "operation": "delete",
            "operation_type": "setup",
            "description": "åˆ é™¤å›å®¶åœºæ™¯"
        },
        "automation": {}
    }
}</pre>
                </div>

                <div style="margin-bottom: 1rem;">
                    <strong>å“åº”æ ¼å¼ (Response):</strong>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem;">
{
    "success": true,
    "data": {
        "message": "åœºæ™¯åˆ é™¤æˆåŠŸ",
        "scene_name": "arrival_home",
        "scene_id": "scene.arrival_home"
    }
}

// é”™è¯¯å“åº”
{
    "success": false,
    "error": "åœºæ™¯ä¸å­˜åœ¨æˆ–åˆ é™¤å¤±è´¥",
    "details": "..."
}</pre>
                </div>
            </div>

            <!-- Additional APIs -->
            <div class="api-section" style="margin-bottom: 2rem;">
                <h3 style="color: var(--info); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“</span>
                    <span>5. å…¶ä»–ç®¡ç†æ¥å£</span>
                </h3>

                <!-- Get Prompts -->
                <div style="margin-bottom: 1.5rem; padding-left: 1rem; border-left: 3px solid var(--info);">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">è·å– AI æç¤ºè¯</h4>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; margin: 0.5rem 0;">
                        GET /api/ai_enhanced_scene/:module/prompts
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; font-weight: 600; margin: 0.5rem 0;">
                        GET http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/prompts
                    </div>
                    <p style="font-size: 0.9rem; color: #666;">è·å–æ‰€æœ‰ AI æç¤ºè¯é…ç½®ï¼ˆæ‰§è¡Œã€åˆ›å»ºã€åˆ é™¤åœºæ™¯çš„æç¤ºè¯ï¼‰</p>
                </div>

                <!-- Update Prompt -->
                <div style="margin-bottom: 1.5rem; padding-left: 1rem; border-left: 3px solid var(--info);">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">æ›´æ–° AI æç¤ºè¯</h4>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; margin: 0.5rem 0;">
                        PUT /api/ai_enhanced_scene/:module/prompt/:type
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; font-weight: 600; margin: 0.5rem 0;">
                        PUT http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/prompt/:type
                    </div>
                    <p style="font-size: 0.9rem; color: #666;">æ›´æ–°æŒ‡å®šç±»å‹çš„ AI æç¤ºè¯ï¼ˆtype å¯ä»¥æ˜¯: execute, create, deleteï¼‰</p>
                    <pre style="background: #1f2937; color: #10b981; padding: 0.75rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5rem; font-size: 0.8rem;">
{
    "prompt": "ä½ çš„æ–°æç¤ºè¯å†…å®¹..."
}</pre>
                </div>

                <!-- Get Module Info -->
                <div style="margin-bottom: 1.5rem; padding-left: 1rem; border-left: 3px solid var(--info);">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">è·å–æ¨¡å—ä¿¡æ¯</h4>
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; margin: 0.5rem 0;">
                        GET /api/ai_enhanced_scene/:module/info
                    </div>
                    <div style="background: #e0f2fe; padding: 0.75rem; border-radius: 0.5rem; font-family: monospace; font-weight: 600; margin: 0.5rem 0;">
                        GET http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/info
                    </div>
                    <p style="font-size: 0.9rem; color: #666;">è·å–æ¨¡å—çš„åŸºæœ¬ä¿¡æ¯å’Œé…ç½®</p>
                </div>
            </div>

            <div class="warning-box">
                <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong>
                <ul style="margin: 0.5rem 0 0 1.5rem;">
                    <li>æ‰€æœ‰ POST è¯·æ±‚éƒ½éœ€è¦åœ¨ headers ä¸­è®¾ç½® <code>Content-Type: application/json</code></li>
                    <li>è¯·æ±‚æ•°æ®é€šå¸¸æ¥è‡ª Intention æ¨¡å—çš„è¾“å‡º</li>
                    <li><code>:module</code> å‚æ•°å¿…é¡»ä½¿ç”¨ <code>ai_enhanced_scene</code></li>
                    <li>åœºæ™¯åç§°ä¼šè‡ªåŠ¨å¤„ç†ä¸­è‹±æ–‡è½¬æ¢</li>
                    <li>åˆ›å»ºåœºæ™¯æ—¶ä¼šè‡ªåŠ¨è¯»å–è®¾å¤‡çš„å½“å‰çŠ¶æ€</li>
                </ul>
            </div>

            <!-- Usage Examples -->
            <div class="api-section" style="margin-top: 2rem;">
                <h3 style="color: var(--secondary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ’¡</span>
                    <span>6. ä½¿ç”¨ç¤ºä¾‹ (cURL)</span>
                </h3>

                <!-- List Scenes Example -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">æŸ¥çœ‹åœºæ™¯åˆ—è¡¨ç¤ºä¾‹</h4>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.85rem;">
# ä¸­æ–‡è¾“å…¥ï¼ˆIntention æ¨¡å—æ ¼å¼ï¼‰
curl -X POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/list \
  -H "Content-Type: application/json" \
  -d '{
    "success": true,
    "data": {
      "intent": "Set Scene",
      "user_input": "ç³»ç»Ÿæœ‰å¤šå°‘ä¸ªåœºæ™¯",
      "scene": {
        "operation": "list",
        "operation_type": "query"
      }
    }
  }'

# è‹±æ–‡è¾“å…¥ï¼ˆIntention æ¨¡å—æ ¼å¼ï¼‰
curl -X POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/list \
  -H "Content-Type: application/json" \
  -d '{
    "success": true,
    "data": {
      "intent": "Set Scene",
      "user_input": "how many scenes in the system",
      "scene": {
        "operation": "list"
      }
    }
  }'

# ç®€åŒ–æ ¼å¼
curl -X POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/list \
  -H "Content-Type: application/json" \
  -d '{
    "data": {
      "user_input": "æ˜¾ç¤ºæ‰€æœ‰åœºæ™¯"
    }
  }'</pre>
                </div>

                <!-- Execute Example -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">æ‰§è¡Œåœºæ™¯ç¤ºä¾‹</h4>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.85rem;">
curl -X POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/execute \
  -H "Content-Type: application/json" \
  -d '{
    "success": true,
    "data": {
      "intent": "Control Scene",
      "user_input": "æˆ‘å›æ¥äº†",
      "scene": {
        "scene_name": "å›å®¶æ¨¡å¼",
        "scene_name_en": "arrival_home",
        "operation": "execute"
      }
    }
  }'</pre>
                </div>

                <!-- Create Example -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">åˆ›å»ºåœºæ™¯ç¤ºä¾‹</h4>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.85rem;">
curl -X POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/create \
  -H "Content-Type: application/json" \
  -d '{
    "success": true,
    "data": {
      "intent": "Set Scene",
      "user_input": "å°†ç”µè§†æˆ¿è®¾å¤‡å½“å‰çŠ¶æ€è®¾ç½®ä¸ºè§‚å½±æ¨¡å¼",
      "matched_devices": [
        {
          "entity_id": "light.color_light_3",
          "service": "light.state"
        },
        {
          "entity_id": "climate.ac_01",
          "service": "climate.state"
        }
      ],
      "scene": {
        "scene_name": "è§‚å½±æ¨¡å¼",
        "scene_name_en": "movie_mode",
        "operation": "add"
      }
    }
  }'</pre>
                </div>

                <!-- Delete Example -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--dark); margin-bottom: 0.5rem;">åˆ é™¤åœºæ™¯ç¤ºä¾‹</h4>
                    <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.85rem;">
curl -X POST http://localhost:3000/api/ai_enhanced_scene/ai_enhanced_scene/delete \
  -H "Content-Type: application/json" \
  -d '{
    "success": true,
    "data": {
      "intent": "Set Scene",
      "user_input": "åˆ é™¤è§‚å½±æ¨¡å¼åœºæ™¯",
      "scene": {
        "scene_name": "è§‚å½±æ¨¡å¼",
        "scene_name_en": "movie_mode",
        "operation": "delete"
      }
    }
  }'</pre>
                </div>
            </div>
        </div>

        <!-- Module Info Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    â„¹ï¸ æ¨¡å—ä¿¡æ¯
                </div>
                <button class="btn btn-info" onclick="loadModuleInfo()">ğŸ”„ åˆ·æ–°</button>
            </div>
            <div id="moduleInfo" class="result-box">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <a href="/" class="home-btn" title="è¿”å›é¦–é¡µ">ğŸ </a>

    <script>
        const API_BASE = window.location.origin;
        const MODULE_NAME = 'ai_enhanced_scene';

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Load prompts
        async function loadPrompts() {
            const container = document.getElementById('promptsContainer');
            container.innerHTML = '<div class="info-box">æ­£åœ¨åŠ è½½æç¤ºè¯...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/prompts`);
                const result = await response.json();

                if (result.success) {
                    const prompts = result.data;
                    let html = '';

                    // Execute Prompt
                    html += createPromptView('execute', 'æ‰§è¡Œåœºæ™¯æç¤ºè¯', prompts.execute_prompt);
                    // Create Prompt
                    html += createPromptView('create', 'åˆ›å»ºåœºæ™¯æç¤ºè¯', prompts.create_prompt);
                    // Delete Prompt
                    html += createPromptView('delete', 'åˆ é™¤åœºæ™¯æç¤ºè¯', prompts.delete_prompt);

                    container.innerHTML = html;
                } else {
                    container.innerHTML = `<div class="warning-box">âŒ åŠ è½½å¤±è´¥: ${result.error}</div>`;
                }
            } catch (error) {
                container.innerHTML = `<div class="warning-box">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function createPromptView(type, title, content) {
            return `
                <div class="prompt-view" id="${type}PromptView">
                    <div class="prompt-header">
                        <div class="prompt-title">${title}</div>
                        <div class="btn-group">
                            <button class="btn btn-secondary view-mode" id="${type}EditBtn" style="padding: 0.5rem 1rem;" onclick="enterEditMode('${type}')">âœï¸ ç¼–è¾‘</button>
                            <button class="btn btn-success edit-mode" id="${type}SaveBtn" style="padding: 0.5rem 1rem;" onclick="savePrompt('${type}')">ğŸ’¾ ä¿å­˜</button>
                            <button class="btn btn-secondary edit-mode" id="${type}CancelBtn" style="padding: 0.5rem 1rem;" onclick="cancelEdit('${type}')">âŒ å–æ¶ˆ</button>
                        </div>
                    </div>
                    <div class="view-mode" id="${type}ViewMode">
                        <div class="prompt-content">${escapeHtml(content)}</div>
                    </div>
                    <div class="edit-mode" id="${type}EditMode">
                        <textarea class="prompt-textarea" id="${type}PromptTextarea">${escapeHtml(content)}</textarea>
                    </div>
                </div>
            `;
        }

        function enterEditMode(type) {
            // Hide view mode, show edit mode
            document.getElementById(`${type}ViewMode`).style.display = 'none';
            document.getElementById(`${type}EditMode`).style.display = 'block';
            
            // Hide edit button, show save/cancel buttons
            document.getElementById(`${type}EditBtn`).style.display = 'none';
            document.getElementById(`${type}SaveBtn`).style.display = 'inline-flex';
            document.getElementById(`${type}CancelBtn`).style.display = 'inline-flex';
            
            // Focus on textarea
            document.getElementById(`${type}PromptTextarea`).focus();
        }

        function cancelEdit(type) {
            // Show view mode, hide edit mode
            document.getElementById(`${type}ViewMode`).style.display = 'block';
            document.getElementById(`${type}EditMode`).style.display = 'none';
            
            // Show edit button, hide save/cancel buttons
            document.getElementById(`${type}EditBtn`).style.display = 'inline-flex';
            document.getElementById(`${type}SaveBtn`).style.display = 'none';
            document.getElementById(`${type}CancelBtn`).style.display = 'none';
            
            // Reload prompts to restore original content
            loadPrompts();
        }

        async function savePrompt(type) {
            const textarea = document.getElementById(`${type}PromptTextarea`);
            const newContent = textarea.value;
            
            if (!newContent.trim()) {
                alert('âŒ æç¤ºè¯ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/prompt/${type}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: newContent })
                });
                const result = await response.json();

                if (result.success) {
                    alert('âœ… æç¤ºè¯æ›´æ–°æˆåŠŸï¼');
                    loadPrompts();
                } else {
                    alert(`âŒ æ›´æ–°å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                alert(`âŒ é”™è¯¯: ${error.message}`);
            }
        }

        // Execute scene
        async function executeScene() {
            const inputEl = document.getElementById('executeInput');
            const resultEl = document.getElementById('executeResult');
            const loadingEl = document.getElementById('executeLoading');

            try {
                const inputData = JSON.parse(inputEl.value);
                
                loadingEl.classList.remove('hidden');
                resultEl.textContent = 'æ­£åœ¨æ‰§è¡Œåœºæ™¯...';

                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputData)
                });

                const result = await response.json();
                resultEl.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        // Create scene
        async function createScene() {
            const inputEl = document.getElementById('createInput');
            const resultEl = document.getElementById('createResult');
            const loadingEl = document.getElementById('createLoading');

            try {
                const inputData = JSON.parse(inputEl.value);
                
                loadingEl.classList.remove('hidden');
                resultEl.textContent = 'æ­£åœ¨åˆ›å»ºåœºæ™¯...';

                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputData)
                });

                const result = await response.json();
                resultEl.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        // Delete scene
        async function deleteScene() {
            const inputEl = document.getElementById('deleteInput');
            const resultEl = document.getElementById('deleteResult');
            const loadingEl = document.getElementById('deleteLoading');

            try {
                const inputData = JSON.parse(inputEl.value);
                
                loadingEl.classList.remove('hidden');
                resultEl.textContent = 'æ­£åœ¨åˆ é™¤åœºæ™¯...';

                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputData)
                });

                const result = await response.json();
                resultEl.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        // Load module info
        async function loadModuleInfo() {
            const resultEl = document.getElementById('moduleInfo');
            resultEl.textContent = 'åŠ è½½ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/info`);
                const result = await response.json();
                resultEl.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            }
        }

        // List scenes
        async function listScenes() {
            const inputEl = document.getElementById('listInput');
            const resultEl = document.getElementById('listResult');
            const loadingEl = document.getElementById('listLoading');

            try {
                const inputData = JSON.parse(inputEl.value);
                
                loadingEl.classList.remove('hidden');
                resultEl.textContent = 'æ­£åœ¨æŸ¥è¯¢åœºæ™¯åˆ—è¡¨...';

                const response = await fetch(`${API_BASE}/api/ai_enhanced_scene/${MODULE_NAME}/list`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputData)
                });

                const result = await response.json();
                resultEl.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultEl.textContent = `é”™è¯¯: ${error.message}`;
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        // Clear result
        function clearResult(elementId) {
            document.getElementById(elementId).textContent = 'å·²æ¸…ç©º';
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadPrompts();
            loadModuleInfo();
        });
    </script>
</body>
</html>

