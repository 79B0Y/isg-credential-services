<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Home Assistant API ÂÆåÊï¥ÊµãËØïÊñáÊ°£</title>
    <style>
        :root {
            --primary: #41b883;
            --primary-dark: #369970;
            --secondary: #3273dc;
            --success: #48c78e;
            --danger: #f14668;
            --warning: #ffe08a;
            --info: #3e8ed0;
            --light: #f5f5f5;
            --dark: #363636;
            --white: #ffffff;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-500: #9e9e9e;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        /* Credentials Panel */
        .credentials-panel {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .credentials-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .credentials-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-success {
            background: var(--success);
            color: white;
        }

        .status-error {
            background: var(--danger);
            color: white;
        }

        .status-loading {
            background: var(--warning);
            color: var(--dark);
        }

        .credentials-info {
            background: var(--gray-50);
            border: 2px solid var(--success);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .credential-item {
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }

        .credential-label {
            font-weight: 600;
            color: var(--gray-700);
        }

        .credential-value {
            color: var(--gray-600);
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--white);
            border-radius: 1rem 1rem 0 0;
            overflow-x: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: var(--gray-100);
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--gray-50);
        }

        /* Content Area */
        .content-area {
            background: var(--white);
            border-radius: 0 0 1rem 1rem;
            min-height: 60vh;
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        /* API Section */
        .api-section {
            margin-bottom: 3rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--gray-800);
        }

        .section-count {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* API Endpoint Card */
        .endpoint-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.2s;
        }

        .endpoint-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .endpoint-header {
            background: var(--white);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .endpoint-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .method-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .method-get {
            background: var(--success);
            color: white;
        }

        .method-post {
            background: var(--secondary);
            color: white;
        }

        .method-put {
            background: var(--warning);
            color: var(--dark);
        }

        .method-delete {
            background: var(--danger);
            color: white;
        }

        .endpoint-path {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
            color: var(--gray-700);
            background: var(--gray-100);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .endpoint-description {
            color: var(--gray-600);
            flex: 1;
        }

        .expand-icon {
            transition: transform 0.2s;
        }

        .endpoint-card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .endpoint-content {
            display: none;
            padding: 1.5rem;
        }

        .endpoint-card.expanded .endpoint-content {
            display: block;
        }

        .endpoint-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .endpoint-details {
                grid-template-columns: 1fr;
            }
        }

        .detail-section h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }

        .param-list {
            list-style: none;
        }

        .param-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .param-name {
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 600;
            color: var(--secondary);
        }

        .param-required {
            background: var(--danger);
            color: white;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.625rem;
            margin-left: 0.5rem;
        }

        .param-optional {
            background: var(--gray-400);
            color: white;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.625rem;
            margin-left: 0.5rem;
        }

        .param-type {
            font-style: italic;
            color: var(--gray-600);
        }

        .param-description {
            color: var(--gray-700);
            margin-top: 0.25rem;
        }

        /* Test Panel */
        .test-panel {
            background: var(--white);
            border: 2px solid var(--primary);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .test-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 1rem;
        }

        .test-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(65, 184, 131, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
        }

        .input-group .form-input {
            flex: 1;
        }

        /* Response Panel */
        .response-panel {
            background: var(--gray-900);
            color: var(--white);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
        }

        .response-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-600);
        }

        .response-title {
            font-weight: 600;
            color: var(--primary);
        }

        .response-actions {
            display: flex;
            gap: 0.5rem;
        }

        .response-body {
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Quick Actions */
        .quick-actions {
            background: var(--gray-50);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .quick-actions h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-card:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .action-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .action-description {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        /* Log Panel */
        .log-panel {
            background: var(--gray-900);
            color: var(--gray-300);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .log-timestamp {
            color: var(--gray-500);
            margin-right: 0.5rem;
        }

        .log-level-info {
            color: var(--info);
        }

        .log-level-success {
            color: var(--success);
        }

        .log-level-error {
            color: var(--danger);
        }

        .log-level-warn {
            color: var(--warning);
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 1rem;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè† Home Assistant API ÂÆåÊï¥ÊµãËØïÊñáÊ°£</h1>
            <p>Ê®°ÂùóÂåñÊû∂ÊûÑ ¬∑ ÂÆûÊó∂ÁºìÂ≠ò ¬∑ ÂÆåÊï¥ÊµãËØïË¶ÜÁõñ</p>

            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number">7</span>
                    <span class="stat-label">APIÁ´ØÁÇπ</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">1</span>
                    <span class="stat-label">ÂäüËÉΩÊ®°Âùó</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">100%</span>
                    <span class="stat-label">ÊµãËØïË¶ÜÁõñ</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">1ÂàÜÈíü</span>
                    <span class="stat-label">ÁºìÂ≠òÂà∑Êñ∞</span>
                </div>
            </div>
        </div>

        <!-- Credentials Panel -->
        <div class="credentials-panel">
            <div class="credentials-header">
                <div class="credentials-title">
                    üîê Âá≠ÊçÆÁÆ°ÁêÜ
                    <span id="credentials-status" class="status-badge status-loading">Ê£ÄÊü•‰∏≠...</span>
                </div>
            </div>

            <div id="credentials-info" class="credentials-info hidden">
                <div class="credential-item">
                    <span class="credential-label">Base URL:</span>
                    <span class="credential-value" id="stored-base-url">-</span>
                </div>
                <div class="credential-item">
                    <span class="credential-label">Access Token:</span>
                    <span class="credential-value" id="stored-token-preview">-</span>
                </div>
                <div class="credential-item">
                    <span class="credential-label">ÊúÄÂêéÊõ¥Êñ∞:</span>
                    <span class="credential-value" id="stored-config-time">-</span>
                </div>
            </div>

            <div class="controls">
                <button id="refresh-credentials" class="btn btn-primary">üîÑ Âà∑Êñ∞Âá≠ÊçÆ</button>
                <button id="test-connection" class="btn btn-info">üîó ÊµãËØïËøûÊé•</button>
                <button id="view-logs" class="btn btn-secondary">üìã Êü•ÁúãÊó•Âøó</button>
                <button id="clear-logs" class="btn btn-secondary">üóëÔ∏è Ê∏ÖÈô§Êó•Âøó</button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('quick-test')">‚ö° Âø´ÈÄüÊµãËØï</button>
            <button class="nav-tab" onclick="showTab('information')">üìã APIÊé•Âè£</button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Quick Test Tab -->
            <div id="quick-test" class="tab-content active">
                <div class="quick-actions">
                    <h3>üöÄ Âø´ÈÄüÊìç‰Ωú</h3>
                    <div class="action-grid">
                        <div class="action-card" onclick="quickTest('entity-registry')">
                            <div class="action-icon">üìã</div>
                            <div class="action-title">ÂÆû‰ΩìÊ≥®ÂÜåË°®</div>
                            <div class="action-description">Ëé∑ÂèñÂÆåÊï¥ÁöÑÂÆû‰ΩìÊ≥®ÂÜåË°®‰ø°ÊÅØ</div>
                        </div>
                        <div class="action-card" onclick="quickTest('states')">
                            <div class="action-icon">üè†</div>
                            <div class="action-title">ÊâÄÊúâÂÆû‰ΩìÁä∂ÊÄÅ</div>
                            <div class="action-description">Ëé∑ÂèñÊâÄÊúâÂÆû‰ΩìÁöÑÂΩìÂâçÁä∂ÊÄÅ</div>
                        </div>
                        <div class="action-card" onclick="quickTest('spaces')">
                            <div class="action-icon">üè¢</div>
                            <div class="action-title">Á©∫Èó¥ÂàóË°®</div>
                            <div class="action-description">Êü•ÁúãÊ•ºÂ±ÇÂíåÊàøÈó¥ÂàóË°®</div>
                        </div>
                        <div class="action-card" onclick="quickTest('enhanced-entities')">
                            <div class="action-icon">‚≠ê</div>
                            <div class="action-title">Â¢ûÂº∫ÂÆû‰Ωì‰ø°ÊÅØ</div>
                            <div class="action-description">ÂÆû‰Ωì‰ø°ÊÅØ+ÊàøÈó¥Ê•ºÂ±Ç‰ø°ÊÅØ</div>
                        </div>
                        <div class="action-card" onclick="quickTest('device-registry')">
                            <div class="action-icon">üì±</div>
                            <div class="action-title">ËÆæÂ§áÊ≥®ÂÜåË°®</div>
                            <div class="action-description">Ëé∑ÂèñÂÆåÊï¥ÁöÑËÆæÂ§áÊ≥®ÂÜåË°®‰ø°ÊÅØ</div>
                        </div>
                        <div class="action-card" onclick="quickTest('batch-control')">
                            <div class="action-icon">üéÆ</div>
                            <div class="action-title">ÊâπÈáèÊéßÂà∂ËÆæÂ§á</div>
                            <div class="action-description">ÊâπÈáèÊâßË°åËÆæÂ§áÊéßÂà∂ÂëΩ‰ª§</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Response Panel -->
                <div id="quick-response" class="response-panel hidden">
                    <div class="response-header">
                        <span class="response-title">‚ö° Âø´ÈÄüÊµãËØïÁªìÊûú</span>
                        <div class="response-actions">
                            <button class="btn btn-secondary" onclick="copyQuickResponse()">üìã Â§çÂà∂</button>
                            <button class="btn btn-secondary" onclick="closeQuickResponse()">‚úñÔ∏è ÂÖ≥Èó≠</button>
                        </div>
                    </div>
                    <div id="quick-response-body" class="response-body"></div>
                </div>
            </div>

            <!-- Information Tab -->
            <div id="information" class="tab-content">
                <div class="api-section">
                    <div class="section-header">
                        <h2 class="section-title">üìã Home Assistant APIÊé•Âè£</h2>
                        <span class="section-count">5‰∏™Êé•Âè£</span>
                    </div>
                    <!-- API endpoints will be generated here -->
                </div>
            </div>
        </div>

        <!-- Log Panel -->
        <div id="log-panel" class="log-panel hidden">
            <div class="response-header">
                <span class="response-title">üìã Êìç‰ΩúÊó•Âøó</span>
                <div class="response-actions">
                    <button class="btn btn-secondary" onclick="clearLogs()">üóëÔ∏è Ê∏ÖÈô§</button>
                    <button class="btn btn-secondary" onclick="toggleLogPanel()">‚úñÔ∏è ÂÖ≥Èó≠</button>
                </div>
            </div>
            <div id="log-content"></div>
        </div>
    </div>

    <script>
        // Global variables
        let credentials = {};
        let logs = [];

        // API definitions organized by category
        const API_DEFINITIONS = {
            information: [
                {
                    method: 'GET',
                    path: '/api/home_assistant/home_assistant/entity-registry',
                    title: 'ÂÆû‰ΩìÊ≥®ÂÜåË°®',
                    description: 'Ëé∑ÂèñÂÆåÊï¥ÁöÑÂÆû‰ΩìÊ≥®ÂÜåË°®‰ø°ÊÅØ',
                    parameters: [],
                    testFunction: 'testEntityRegistry'
                },
                {
                    method: 'GET',
                    path: '/api/home_assistant/home_assistant/states',
                    title: 'ÊâÄÊúâÂÆû‰ΩìÁä∂ÊÄÅ',
                    description: 'Ëé∑ÂèñÊâÄÊúâÂÆû‰ΩìÁöÑÂΩìÂâçÁä∂ÊÄÅ',
                    parameters: [],
                    testFunction: 'testStates'
                },
                {
                    method: 'GET',
                    path: '/api/home_assistant/home_assistant/spaces',
                    title: 'Á©∫Èó¥ÂàóË°®ÔºàÊ•ºÂ±Ç+ÊàøÈó¥Ôºâ',
                    description: 'Â∞ÜÊ•ºÂ±ÇÂàóË°®ÂíåÊàøÈó¥ÂàóË°®ÁªÑÂêàÊàêÁ©∫Èó¥ÂàóË°®ÔºåÊîØÊåÅÈÄöËøáopÊéßÂà∂ËæìÂá∫Ê†ºÂºèÔºàÂΩìÂâçÊîØÊåÅÔºöfloorsÔºâ',
                    parameters: [
                        { name: 'op', type: 'string', required: false, description: 'ËæìÂá∫Ê†ºÂºèÔºåÈªòËÆ§‰∏∫floorsÔºàÊåâÊ•ºÂ±ÇÂµåÂ•óÊàøÈó¥Ôºâ' }
                    ],
                    testFunction: 'testSpaces'
                },
                {
                    method: 'GET',
                    path: '/api/home_assistant/home_assistant/device-registry',
                    title: 'ËÆæÂ§áÊ≥®ÂÜåË°®',
                    description: 'Ëé∑ÂèñÂÆåÊï¥ÁöÑËÆæÂ§áÊ≥®ÂÜåË°®‰ø°ÊÅØÔºåÂåÖÊã¨ËÆæÂ§áID„ÄÅÂêçÁß∞„ÄÅÂå∫ÂüüÂàÜÈÖçÁ≠â‰ø°ÊÅØ',
                    parameters: [],
                    testFunction: 'testDeviceRegistry'
                },
                {
                    method: 'GET',
                    path: '/api/home_assistant/home_assistant/enhanced-entities',
                    title: 'Â¢ûÂº∫ÂÆû‰Ωì‰ø°ÊÅØ',
                    description: 'Ëé∑ÂèñÂåÖÂê´ÊàøÈó¥ID„ÄÅÊàøÈó¥ÂêçÁß∞„ÄÅÊ•ºÂ±ÇID„ÄÅÊ•ºÂ±ÇÂêçÁß∞ÁöÑÂÆåÊï¥ÂÆû‰Ωì‰ø°ÊÅØ„ÄÇÊï¥ÂêàÂÆû‰ΩìÊ≥®ÂÜåË°®„ÄÅÁ©∫Èó¥ÂàóË°®ÂíåÂÆû‰ΩìÁä∂ÊÄÅ‰∏â‰∏™APIÁöÑÊï∞ÊçÆ',
                    parameters: [],
                    testFunction: 'testEnhancedEntities'
                },
                {
                    method: 'POST',
                    path: '/api/home_assistant/home_assistant/batch-control',
                    title: 'ÊâπÈáèÊéßÂà∂ËÆæÂ§á',
                    description: 'ÊâπÈáèÊâßË°åËÆæÂ§áÊéßÂà∂ÂëΩ‰ª§„ÄÇÊé•Êî∂ÂåÖÂê´entity_id„ÄÅserviceÂíåservice_dataÁöÑJSONÊï∞ÁªÑÔºåÊâπÈáèÊéßÂà∂Â§ö‰∏™ËÆæÂ§á',
                    parameters: [
                        { name: 'commands', type: 'json-array', required: true, description: 'ÊâπÈáèÊéßÂà∂ÂëΩ‰ª§JSONÊï∞ÁªÑÔºåÊØè‰∏™ÂëΩ‰ª§ÂåÖÂê´entity_id„ÄÅserviceÂíåservice_data„ÄÇ‰æãÂ¶ÇÔºö[{"entity_id":"light.light_test_001","service":"light.turn_on","service_data":{"color_name":"blue"}}]' }
                    ],
                    testFunction: 'testBatchControl'
                },
                {
                    method: 'POST',
                    path: '/api/home_assistant/home_assistant/batch-states',
                    title: 'ÊâπÈáèËé∑ÂèñÂÆû‰ΩìÁä∂ÊÄÅ',
                    description: 'ÊâπÈáèËé∑ÂèñÊåáÂÆöÂÆû‰ΩìÁöÑÂΩìÂâçÁä∂ÊÄÅ„ÄÇËøîÂõûÊ∏ÖÊ¥óÂêéÁöÑÊï∞ÊçÆÔºåÂè™ÂåÖÂê´ÊúâÁî®‰ø°ÊÅØÔºàÁÅØÂÖâÔºö‰∫ÆÂ∫¶/È¢úËâ≤ÔºåÁ©∫Ë∞ÉÔºöÊ∏©Â∫¶/Ê®°ÂºèÔºå‰º†ÊÑüÂô®ÔºöÁä∂ÊÄÅÂÄºÔºâ',
                    parameters: [
                        { name: 'entities', type: 'json-array', required: true, description: 'ÂÆû‰ΩìIDÂàóË°®JSONÊï∞ÁªÑ„ÄÇ‰æãÂ¶ÇÔºö[{"entity_id":"climate.text_ac_01"},{"entity_id":"light.light_test_001"}]' }
                    ],
                    testFunction: 'testBatchStates'
                }
            ]
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadCredentials();
            generateAPIDocumentation();
        });

        // Initialize page components
        function initializePage() {
            // Setup event listeners
            document.getElementById('refresh-credentials').addEventListener('click', loadCredentials);
            document.getElementById('test-connection').addEventListener('click', testCredentials);
            document.getElementById('view-logs').addEventListener('click', toggleLogPanel);
            document.getElementById('clear-logs').addEventListener('click', clearLogs);
        }

        // Load credentials from service
        async function loadCredentials() {
            const statusEl = document.getElementById('credentials-status');
            const infoEl = document.getElementById('credentials-info');

            statusEl.textContent = 'Ê£ÄÊü•‰∏≠...';
            statusEl.className = 'status-badge status-loading';

            try {
                const response = await fetch('/api/credentials/home_assistant');
                const result = await response.json();

                if (result.success && result.data) {
                    credentials = {
                        access_token: result.data.access_token,
                        base_url: result.data.base_url
                    };

                    document.getElementById('stored-base-url').textContent = credentials.base_url;
                    document.getElementById('stored-token-preview').textContent =
                        credentials.access_token.substring(0, 20) + '...';
                    document.getElementById('stored-config-time').textContent =
                        new Date().toLocaleString();

                    statusEl.textContent = 'Â∑≤ËøûÊé•';
                    statusEl.className = 'status-badge status-success';
                    infoEl.classList.remove('hidden');

                    addLog('Âá≠ÊçÆÂä†ËΩΩÊàêÂäü ‚úÖ', 'success');
                } else {
                    statusEl.textContent = 'Êú™ÈÖçÁΩÆ';
                    statusEl.className = 'status-badge status-error';
                    infoEl.classList.add('hidden');
                    addLog('Êú™ÊâæÂà∞ÊúâÊïàÂá≠ÊçÆÔºåËØ∑ÂÖàÈÖçÁΩÆHome AssistantÂá≠ÊçÆ', 'error');
                }
            } catch (error) {
                statusEl.textContent = 'ËøûÊé•Â§±Ë¥•';
                statusEl.className = 'status-badge status-error';
                infoEl.classList.add('hidden');
                addLog('Âá≠ÊçÆÊúçÂä°ËøûÊé•Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Test credentials
        async function testCredentials() {
            if (!credentials.access_token || !credentials.base_url) {
                addLog('ËØ∑ÂÖàÂä†ËΩΩÊúâÊïàÂá≠ÊçÆ', 'error');
                return;
            }

            try {
                const response = await makeAPICall('POST', '/api/home_assistant/home_assistant/test-connection');
                if (response.success) {
                    addLog('ËøûÊé•ÊµãËØïÊàêÂäü ‚úÖ', 'success');
                } else {
                    addLog('ËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + response.error, 'error');
                }
            } catch (error) {
                addLog('ËøûÊé•ÊµãËØïÈîôËØØ: ' + error.message, 'error');
            }
        }

        // Make API call
        async function makeAPICall(method, endpoint, data = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (data && (method === 'POST' || method === 'PUT')) {
                options.body = JSON.stringify(data);
            } else if (data && method === 'GET') {
                // For GET requests, add data as query parameters
                const url = new URL(endpoint, window.location.origin);
                Object.keys(data).forEach(key => {
                    if (data[key] !== null && data[key] !== undefined && data[key] !== '') {
                        if (Array.isArray(data[key])) {
                            // For arrays, pass as JSON string (backend expects JSON format)
                            url.searchParams.append(key, JSON.stringify(data[key]));
                        } else {
                            url.searchParams.append(key, data[key]);
                        }
                    }
                });
                endpoint = url.pathname + url.search;
            }

            const response = await fetch(endpoint, options);
            return await response.json();
        }

        // Quick test functions
        async function quickTest(testType) {
            const responseEl = document.getElementById('quick-response');
            const bodyEl = document.getElementById('quick-response-body');

            responseEl.classList.remove('hidden');
            bodyEl.textContent = 'Loading...';

            try {
                let endpoint;
                switch (testType) {
                    case 'entity-registry':
                        endpoint = '/api/home_assistant/home_assistant/entity-registry';
                        break;
                    case 'states':
                        endpoint = '/api/home_assistant/home_assistant/states';
                        break;
                    case 'spaces':
                        endpoint = '/api/home_assistant/home_assistant/spaces';
                        break;
                    case 'device-registry':
                        endpoint = '/api/home_assistant/home_assistant/device-registry';
                        break;
                    case 'enhanced-entities':
                        endpoint = '/api/home_assistant/home_assistant/enhanced-entities';
                        break;
                    case 'batch-control':
                        endpoint = '/api/home_assistant/home_assistant/batch-control';
                        // Á§∫‰æãÊâπÈáèÊéßÂà∂Êï∞ÊçÆ
                        const batchData = [
                            {
                                "entity_id": "light.light_test_001",
                                "service": "light.turn_on",
                                "service_data": {
                                    "color_name": "blue",
                                    "brightness": 255
                                }
                            }
                        ];
                        const response = await makeAPICall('POST', endpoint, batchData);
                        bodyEl.textContent = JSON.stringify(response, null, 2);
                        addLog(`Âø´ÈÄüÊµãËØï ${testType} ${response.success ? 'ÊàêÂäü' : 'Â§±Ë¥•'}`,
                              response.success ? 'success' : 'error');
                        return;
                }

                const response = await makeAPICall('GET', endpoint);
                bodyEl.textContent = JSON.stringify(response, null, 2);

                addLog(`Âø´ÈÄüÊµãËØï ${testType} ${response.success ? 'ÊàêÂäü' : 'Â§±Ë¥•'}`,
                      response.success ? 'success' : 'error');
            } catch (error) {
                bodyEl.textContent = JSON.stringify({ error: error.message }, null, 2);
                addLog(`Âø´ÈÄüÊµãËØï ${testType} ÈîôËØØ: ${error.message}`, 'error');
            }
        }


        // Tab navigation
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Generate API documentation
        function generateAPIDocumentation() {
            Object.keys(API_DEFINITIONS).forEach(category => {
                const container = document.querySelector(`#${category} .api-section`);
                if (container) {
                    API_DEFINITIONS[category].forEach(api => {
                        container.appendChild(createEndpointCard(api));
                    });
                }
            });
        }

        // Create endpoint card
        function createEndpointCard(api) {
            const card = document.createElement('div');
            card.className = 'endpoint-card';
            card.dataset.endpoint = api.testFunction;

            card.innerHTML = `
                <div class="endpoint-header" onclick="toggleEndpoint(this)">
                    <div class="endpoint-info">
                        <span class="method-badge method-${api.method.toLowerCase()}">${api.method}</span>
                        <span class="endpoint-path">${api.path}</span>
                        <span class="endpoint-description">${api.title}</span>
                    </div>
                    <span class="expand-icon">‚ñº</span>
                </div>
                <div class="endpoint-content">
                    <div class="endpoint-details">
                        <div class="detail-section">
                            <h4>üìù Êé•Âè£ËØ¥Êòé</h4>
                            <p>${api.description}</p>

                            <h4>üìã ËØ∑Ê±ÇÂèÇÊï∞</h4>
                            <ul class="param-list">
                                ${api.parameters.map(param => `
                                    <li class="param-item">
                                        <span class="param-name">${param.name}</span>
                                        <span class="param-${param.required ? 'required' : 'optional'}">
                                            ${param.required ? 'REQUIRED' : 'OPTIONAL'}
                                        </span>
                                        <span class="param-type">${param.type}</span>
                                        <div class="param-description">${param.description}</div>
                                    </li>
                                `).join('')}
                                ${api.parameters.length === 0 ? '<li class="param-item">Êó†ÂèÇÊï∞</li>' : ''}
                            </ul>
                        </div>
                        <div class="detail-section">
                            <div class="test-panel">
                                <div class="test-header">
                                    <h4 class="test-title">üß™ Êé•Âè£ÊµãËØï</h4>
                                </div>
                                ${generateTestForm(api)}
                                <div class="controls mt-2">
                                    <button class="btn btn-primary" onclick="${api.testFunction}()">
                                        <span class="loading-spinner hidden" id="${api.testFunction}-spinner"></span>
                                        üöÄ ÊâßË°åÊµãËØï
                                    </button>
                                    <button class="btn btn-info" onclick="fillExampleData('${api.testFunction}')">
                                        üìù Â°´ÂÖÖÁ§∫‰æã
                                    </button>
                                    ${api.testFunction === 'testBatchControl' ? `
                                        <button class="btn btn-secondary" onclick="formatBatchControlJSON()">
                                            ‚ú® Ê†ºÂºèÂåñJSON
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="${api.testFunction}-response" class="response-panel hidden">
                        <div class="response-header">
                            <span class="response-title">üì§ ÂìçÂ∫îÁªìÊûú</span>
                            <div class="response-actions">
                                <button class="btn btn-secondary" onclick="copyResponse('${api.testFunction}-body')">üìã Â§çÂà∂</button>
                            </div>
                        </div>
                        <div id="${api.testFunction}-body" class="response-body"></div>
                    </div>
                </div>
            `;

            return card;
        }

        // Generate test form based on parameters
        function generateTestForm(api) {
            if (api.parameters.length === 0) {
                return '<p>Ê≠§Êé•Âè£‰∏çÈúÄË¶ÅÂèÇÊï∞ÔºåÁõ¥Êé•ÊâßË°åÊµãËØïÂç≥ÂèØ„ÄÇ</p>';
            }

            return api.parameters.map(param => {
                if (param.type === 'array' || param.type === 'json-array') {
                    return `
                        <div class="form-group">
                            <label class="form-label">${param.name} ${param.required ? '(ÂøÖÂ°´)' : '(ÂèØÈÄâ)'}</label>
                            <textarea id="${api.testFunction}-${param.name}"
                                     class="form-textarea"
                                     rows="10"
                                     placeholder="ËØ∑ËæìÂÖ•JSONÊï∞ÁªÑÊ†ºÂºè"></textarea>
                            <small>${param.description}</small>
                        </div>
                    `;
                } else if (param.type === 'object') {
                    return `
                        <div class="form-group">
                            <label class="form-label">${param.name} ${param.required ? '(ÂøÖÂ°´)' : '(ÂèØÈÄâ)'}</label>
                            <textarea id="${api.testFunction}-${param.name}"
                                     class="form-textarea"
                                     rows="6"
                                     placeholder="ËØ∑ËæìÂÖ•JSONÂØπË±°Ê†ºÂºè"></textarea>
                            <small>${param.description}</small>
                        </div>
                    `;
                } else {
                    return `
                        <div class="form-group">
                            <label class="form-label">${param.name} ${param.required ? '(ÂøÖÂ°´)' : '(ÂèØÈÄâ)'}</label>
                            <input id="${api.testFunction}-${param.name}"
                                   class="form-input"
                                   type="text"
                                   placeholder="${param.description}">
                        </div>
                    `;
                }
            }).join('');
        }

        // Toggle endpoint card
        function toggleEndpoint(header) {
            const card = header.closest('.endpoint-card');
            card.classList.toggle('expanded');
        }

        // Generic test function
        async function executeAPITest(testFunction, method, endpoint, paramNamesOrData = []) {
            const spinner = document.getElementById(`${testFunction}-spinner`);
            const responseEl = document.getElementById(`${testFunction}-response`);
            const bodyEl = document.getElementById(`${testFunction}-body`);

            if (spinner) spinner.classList.remove('hidden');
            responseEl.classList.remove('hidden');
            bodyEl.textContent = 'Loading...';

            try {
                let data = null;
                let finalEndpoint = endpoint;

                // Check if paramNamesOrData is actual data (array or non-array object) or param names
                if (Array.isArray(paramNamesOrData)) {
                    // If it's an array, check if it contains strings (param names) or objects (actual data)
                    if (paramNamesOrData.length > 0) {
                        if (typeof paramNamesOrData[0] === 'string') {
                            // It's param names array
                            data = {};
                            paramNamesOrData.forEach(param => {
                                const element = document.getElementById(`${testFunction}-${param}`);
                                if (element && element.value) {
                                    try {
                                        if (element.classList.contains('form-textarea')) {
                                            data[param] = JSON.parse(element.value);
                                        } else {
                                            data[param] = element.value;
                                        }
                                    } catch (e) {
                                        data[param] = element.value;
                                    }
                                }
                            });

                            // Handle path parameters
                            if (endpoint.includes('{')) {
                                Object.keys(data).forEach(key => {
                                    if (endpoint.includes(`{${key}}`)) {
                                        finalEndpoint = endpoint.replace(`{${key}}`, data[key]);
                                        delete data[key];
                                    }
                                });
                            }

                            // Special handling for match-devices endpoint
                            if (endpoint.includes('match-devices') && data.device_commands) {
                                data = data.device_commands; // Send array directly
                            }

                            // Clean empty data
                            if (Object.keys(data).length === 0) {
                                data = null;
                            }
                        } else {
                            // It's actual data array (like batch control commands)
                            data = paramNamesOrData;
                            addLog(`ÂèëÈÄÅÊâπÈáèÊï∞ÊçÆ: ${data.length} ‰∏™ÂëΩ‰ª§`, 'info');
                        }
                    }
                } else if (paramNamesOrData && typeof paramNamesOrData === 'object') {
                    // It's an object with actual data
                    data = paramNamesOrData;
                }

                const response = await makeAPICall(method, finalEndpoint, data);
                bodyEl.textContent = JSON.stringify(response, null, 2);

                addLog(`APIÊµãËØï ${testFunction} ${response.success ? 'ÊàêÂäü' : 'Â§±Ë¥•'}`,
                      response.success ? 'success' : 'error');
            } catch (error) {
                bodyEl.textContent = JSON.stringify({ error: error.message }, null, 2);
                addLog(`APIÊµãËØï ${testFunction} ÈîôËØØ: ${error.message}`, 'error');
            } finally {
                if (spinner) spinner.classList.add('hidden');
            }
        }

        // Individual test functions
        function testEntityRegistry() {
            executeAPITest('testEntityRegistry', 'GET', '/api/home_assistant/home_assistant/entity-registry');
        }

        function testStates() {
            executeAPITest('testStates', 'GET', '/api/home_assistant/home_assistant/states');
        }

        function testSpaces() {
            executeAPITest('testSpaces', 'GET', '/api/home_assistant/home_assistant/spaces', ['op']);
        }

        function testDeviceRegistry() {
            executeAPITest('testDeviceRegistry', 'GET', '/api/home_assistant/home_assistant/device-registry');
        }

        function testEnhancedEntities() {
            executeAPITest('testEnhancedEntities', 'GET', '/api/home_assistant/home_assistant/enhanced-entities');
        }

        function testBatchStates() {
            try {
                // ‰ªétextareaËØªÂèñJSONÊï∞ÊçÆ
                const entitiesInput = document.getElementById('testBatchStates-entities');
                if (!entitiesInput || !entitiesInput.value.trim()) {
                    addLog('ËØ∑ËæìÂÖ•ÂÆû‰ΩìIDÂàóË°®JSONÊï∞ÊçÆ', 'error');
                    return;
                }
                
                // Ëé∑ÂèñËæìÂÖ•ÂÄºÂπ∂Ê∏ÖÁêÜÂèØËÉΩÁöÑÁâπÊÆäÂ≠óÁ¨¶
                let inputValue = entitiesInput.value.trim();
                
                // Â∞ùËØïËß£ÊûêJSON
                let entitiesData;
                try {
                    entitiesData = JSON.parse(inputValue);
                } catch (parseError) {
                    addLog('JSONÊ†ºÂºèÈîôËØØ: ' + parseError.message, 'error');
                    addLog('ÊèêÁ§∫: ËØ∑Ê£ÄÊü•JSONÊ†ºÂºèÊòØÂê¶Ê≠£Á°ÆÔºåÂèØ‰ª•‰ΩøÁî®"üìù Â°´ÂÖÖÁ§∫‰æã"ÊåâÈíÆÊü•ÁúãÊ≠£Á°ÆÊ†ºÂºè', 'info');
                    return;
                }
                
                // È™åËØÅÊòØÂê¶‰∏∫Êï∞ÁªÑ
                if (!Array.isArray(entitiesData)) {
                    addLog('ÂÆû‰ΩìÂàóË°®ÂøÖÈ°ªÊòØJSONÊï∞ÁªÑÊ†ºÂºè', 'error');
                    return;
                }
                
                // È™åËØÅÊï∞ÁªÑ‰∏ç‰∏∫Á©∫
                if (entitiesData.length === 0) {
                    addLog('ÂÆû‰ΩìÂàóË°®Êï∞ÁªÑ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
                
                // È™åËØÅÊØè‰∏™ÂØπË±°ÁöÑÂøÖÂ°´Â≠óÊÆµ
                for (let i = 0; i < entitiesData.length; i++) {
                    const entity = entitiesData[i];
                    if (!entity.entity_id) {
                        addLog(`ÂÆû‰Ωì ${i + 1} Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ entity_id`, 'error');
                        return;
                    }
                }
                
                addLog(`ÂáÜÂ§áËé∑Âèñ ${entitiesData.length} ‰∏™ÂÆû‰ΩìÁöÑÁä∂ÊÄÅ`, 'info');
                
                // ÊâßË°åÊµãËØï
                executeAPITest('testBatchStates', 'POST', '/api/home_assistant/home_assistant/batch-states', entitiesData);
            } catch (error) {
                addLog('ÊâßË°åÈîôËØØ: ' + error.message, 'error');
                console.error('Batch states error:', error);
            }
        }

        function testBatchControl() {
            try {
                // ‰ªétextareaËØªÂèñJSONÊï∞ÊçÆ
                const commandsInput = document.getElementById('testBatchControl-commands');
                if (!commandsInput || !commandsInput.value.trim()) {
                    addLog('ËØ∑ËæìÂÖ•ÊâπÈáèÊéßÂà∂ÂëΩ‰ª§JSONÊï∞ÊçÆ', 'error');
                    return;
                }
                
                // Ëé∑ÂèñËæìÂÖ•ÂÄºÂπ∂Ê∏ÖÁêÜÂèØËÉΩÁöÑÁâπÊÆäÂ≠óÁ¨¶
                let inputValue = commandsInput.value.trim();
                
                // Â∞ùËØïËß£ÊûêJSON
                let batchData;
                try {
                    batchData = JSON.parse(inputValue);
                } catch (parseError) {
                    // JSONËß£ÊûêÂ§±Ë¥•ÔºåÊòæÁ§∫ËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ
                    const errorPos = parseError.message.match(/position (\d+)/);
                    if (errorPos) {
                        const pos = parseInt(errorPos[1]);
                        const context = inputValue.substring(Math.max(0, pos - 20), Math.min(inputValue.length, pos + 20));
                        addLog(`JSONËß£ÊûêÈîôËØØÂú®‰ΩçÁΩÆ ${pos}: "${context}"`, 'error');
                    }
                    addLog('JSONÊ†ºÂºèÈîôËØØ: ' + parseError.message, 'error');
                    addLog('ÊèêÁ§∫: ËØ∑Ê£ÄÊü•JSONÊ†ºÂºèÊòØÂê¶Ê≠£Á°ÆÔºåÂèØ‰ª•‰ΩøÁî®"üìù Â°´ÂÖÖÁ§∫‰æã"ÊåâÈíÆÊü•ÁúãÊ≠£Á°ÆÊ†ºÂºè', 'info');
                    return;
                }
                
                // È™åËØÅÊòØÂê¶‰∏∫Êï∞ÁªÑ
                if (!Array.isArray(batchData)) {
                    addLog('ÊâπÈáèÊéßÂà∂ÂëΩ‰ª§ÂøÖÈ°ªÊòØJSONÊï∞ÁªÑÊ†ºÂºè', 'error');
                    return;
                }
                
                // È™åËØÅÊï∞ÁªÑ‰∏ç‰∏∫Á©∫
                if (batchData.length === 0) {
                    addLog('ÊâπÈáèÊéßÂà∂ÂëΩ‰ª§Êï∞ÁªÑ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
                
                // È™åËØÅÊØè‰∏™ÂëΩ‰ª§ÁöÑÂøÖÂ°´Â≠óÊÆµ
                for (let i = 0; i < batchData.length; i++) {
                    const cmd = batchData[i];
                    if (!cmd.entity_id) {
                        addLog(`ÂëΩ‰ª§ ${i + 1} Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ entity_id`, 'error');
                        return;
                    }
                    if (!cmd.service) {
                        addLog(`ÂëΩ‰ª§ ${i + 1} Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ service`, 'error');
                        return;
                    }
                }
                
                addLog(`ÂáÜÂ§áÊâßË°å ${batchData.length} ‰∏™ÊâπÈáèÊéßÂà∂ÂëΩ‰ª§`, 'info');
                
                // ÊâßË°åÊµãËØï
                executeAPITest('testBatchControl', 'POST', '/api/home_assistant/home_assistant/batch-control', batchData);
            } catch (error) {
                addLog('ÊâßË°åÈîôËØØ: ' + error.message, 'error');
                console.error('Batch control error:', error);
            }
        }

        // Format batch control JSON
        function formatBatchControlJSON() {
            try {
                const commandsInput = document.getElementById('testBatchControl-commands');
                if (!commandsInput || !commandsInput.value.trim()) {
                    addLog('ËØ∑ÂÖàËæìÂÖ•JSONÊï∞ÊçÆ', 'error');
                    return;
                }
                
                // Ëß£ÊûêÂπ∂Ê†ºÂºèÂåñJSON
                const parsed = JSON.parse(commandsInput.value.trim());
                const formatted = JSON.stringify(parsed, null, 2);
                commandsInput.value = formatted;
                addLog('JSONÊ†ºÂºèÂåñÊàêÂäü', 'success');
            } catch (error) {
                addLog('JSONÊ†ºÂºèÂåñÂ§±Ë¥•: ' + error.message, 'error');
                addLog('ÊèêÁ§∫: ËØ∑ÂÖàÁ°Æ‰øùËæìÂÖ•ÁöÑÊòØÊúâÊïàÁöÑJSONÊ†ºÂºè', 'info');
            }
        }

        // Fill example data
        function fillExampleData(testFunction) {
            const examples = {
                testSpaces: {
                    op: "floors"
                },
                testBatchControl: {
                    commands: JSON.stringify([
                        {
                            "entity_id": "climate.text_ac_01",
                            "service": "climate.set_temperature",
                            "service_data": {
                                "temperature": 20
                            }
                        },
                        {
                            "entity_id": "climate.ac_01",
                            "service": "climate.set_temperature",
                            "service_data": {
                                "temperature": 20
                            }
                        },
                        {
                            "entity_id": "light.light_test_001",
                            "service": "light.turn_on",
                            "service_data": {
                                "color_name": "blue",
                                "brightness": 255
                            }
                        }
                    ], null, 2)
                },
                testBatchStates: {
                    entities: JSON.stringify([
                        {
                            "entity_id": "climate.text_ac_01"
                        },
                        {
                            "entity_id": "light.light_test_001"
                        },
                        {
                            "entity_id": "sensor.temp_01"
                        }
                    ], null, 2)
                }
            };

            const example = examples[testFunction];
            if (example) {
                Object.keys(example).forEach(key => {
                    const element = document.getElementById(`${testFunction}-${key}`);
                    if (element) {
                        element.value = example[key];
                    }
                });
                addLog(`Â∑≤Â°´ÂÖÖ ${testFunction} ÁöÑÁ§∫‰æãÊï∞ÊçÆ`, 'info');
            }
        }

        // Copy response
        function copyResponse(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                navigator.clipboard.writeText(element.textContent);
                addLog('ÂìçÂ∫îÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'info');
            }
        }

        function copyQuickResponse() {
            copyResponse('quick-response-body');
        }

        function closeQuickResponse() {
            document.getElementById('quick-response').classList.add('hidden');
        }

        // Log management
        function addLog(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logs.unshift({ timestamp, message, level });

            // Keep only last 100 logs
            if (logs.length > 100) {
                logs = logs.slice(0, 100);
            }

            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logContent = document.getElementById('log-content');
            logContent.innerHTML = logs.map(log => `
                <div class="log-entry">
                    <span class="log-timestamp">${log.timestamp}</span>
                    <span class="log-level-${log.level}">${log.message}</span>
                </div>
            `).join('');
        }

        function clearLogs() {
            logs = [];
            updateLogDisplay();
        }

        function toggleLogPanel() {
            const panel = document.getElementById('log-panel');
            panel.classList.toggle('hidden');
        }

        // Initialize with first log
        addLog('Home Assistant API ÊñáÊ°£Â∑≤Âä†ËΩΩÂÆåÊàê', 'success');
    </script>
</body>
</html>
