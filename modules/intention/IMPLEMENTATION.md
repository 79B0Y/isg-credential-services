# Intention Module - å®ç°æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæ¨¡å—å®ç° (`IntentionModule.js`)

#### ä¸»è¦åŠŸèƒ½ï¼š
- âœ… **processIntention()** - å¤„ç†ç”¨æˆ·æ„å›¾
  - æ¥æ”¶JSONæ ¼å¼æ„å›¾æ•°æ®
  - ä¸ç³»ç»Ÿæç¤ºè¯åˆå¹¶
  - è°ƒç”¨AIæ¨¡å—å¤„ç†
  - è¿”å›ç»“æ„åŒ–JSONç»“æœ
  
- âœ… **autoSelectAI()** - è‡ªåŠ¨é€‰æ‹©AIæä¾›å•†
  - æ”¯æŒï¼šClaude, OpenAI, Gemini, DeepSeek
  - ä¼˜å…ˆçº§ï¼šç”¨æˆ·æŒ‡å®š > Gemini > OpenAI > DeepSeek > Claude
  - è‡ªåŠ¨æ£€æµ‹å‡­æ®å¯ç”¨æ€§
  
- âœ… **getSystemPrompt()** - è·å–ç³»ç»Ÿæç¤ºè¯
  - æ”¯æŒè‡ªå®šä¹‰æç¤ºè¯
  - å›é€€åˆ°é»˜è®¤æç¤ºè¯
  - åŒ…å«å®Œæ•´çš„æ„å›¾è§£æè§„åˆ™
  
- âœ… **saveSystemPrompt()** - ä¿å­˜è‡ªå®šä¹‰æç¤ºè¯
  
- âœ… **deleteSystemPrompt()** - åˆ é™¤è‡ªå®šä¹‰æç¤ºè¯
  
- âœ… **getHistory()** - è·å–å†å²è®°å½•
  - ä¿å­˜æœ€è¿‘100æ¡è®°å½•
  - æ”¯æŒé™åˆ¶è¿”å›æ•°é‡
  
- âœ… **getAIProviderConfig()** - è·å–AIé…ç½®
  - æ˜¾ç¤ºå½“å‰é€‰æ‹©
  - åˆ—å‡ºæ‰€æœ‰å¯ç”¨æä¾›å•†
  
- âœ… **setAIProvider()** - è®¾ç½®AIæä¾›å•†

### 2. APIè·¯ç”±å®ç° (`server.js`)

å·²æ·»åŠ ä»¥ä¸‹APIç«¯ç‚¹ï¼š

```javascript
POST   /api/intention/:module/process          // å¤„ç†æ„å›¾
GET    /api/intention/:module/history          // è·å–å†å²
GET    /api/intention/:module/prompt           // è·å–æç¤ºè¯
PUT    /api/intention/:module/prompt           // ä¿å­˜æç¤ºè¯
DELETE /api/intention/:module/prompt           // åˆ é™¤æç¤ºè¯
GET    /api/intention/:module/ai-provider      // è·å–AIé…ç½®
POST   /api/intention/:module/ai-provider      // è®¾ç½®AIæä¾›å•†
```

#### Handlerå®ç°ï¼š
- âœ… `handleProcessIntention()`
- âœ… `handleGetIntentionHistory()`
- âœ… `handleGetIntentionPrompt()`
- âœ… `handleSaveIntentionPrompt()`
- âœ… `handleDeleteIntentionPrompt()`
- âœ… `handleGetIntentionAIProvider()`
- âœ… `handleSetIntentionAIProvider()`

### 3. Webç•Œé¢ (`intention-api-docs.html`)

#### åŠŸèƒ½æ ‡ç­¾é¡µï¼š
- âœ… **å¤„ç†æ„å›¾** - å®æ—¶æµ‹è¯•æ„å›¾å¤„ç†
  - æ„å›¾ç±»å‹é€‰æ‹©
  - ç”¨æˆ·å†…å®¹è¾“å…¥
  - å®æ—¶ç»“æœæ˜¾ç¤º
  
- âœ… **ç³»ç»Ÿæç¤ºè¯** - æç¤ºè¯ç®¡ç†
  - æŸ¥çœ‹å½“å‰æç¤ºè¯
  - è‡ªå®šä¹‰æç¤ºè¯ç¼–è¾‘
  - ä¿å­˜/æ¢å¤é»˜è®¤
  
- âœ… **AIæä¾›å•†** - AIé…ç½®
  - å¯è§†åŒ–æä¾›å•†é€‰æ‹©
  - æ˜¾ç¤ºå¯ç”¨æ€§çŠ¶æ€
  - ä¸€é”®åˆ‡æ¢
  
- âœ… **å†å²è®°å½•** - å¤„ç†å†å²
  - æ˜¾ç¤ºæœ€è¿‘20æ¡
  - åŒ…å«è¾“å…¥/è¾“å‡ºè¯¦æƒ…
  - æ—¶é—´æˆ³å’ŒAIæä¾›å•†ä¿¡æ¯
  
- âœ… **APIæ–‡æ¡£** - å®Œæ•´æ–‡æ¡£
  - æ‰€æœ‰APIç«¯ç‚¹è¯´æ˜
  - è¯·æ±‚/å“åº”ç¤ºä¾‹
  - ä½¿ç”¨è¯´æ˜

#### UIç‰¹æ€§ï¼š
- âœ… å“åº”å¼è®¾è®¡
- âœ… å®æ—¶ç»Ÿè®¡æ˜¾ç¤º
- âœ… ç¾è§‚çš„æ¸å˜èƒŒæ™¯
- âœ… ä»£ç é«˜äº®æ˜¾ç¤º
- âœ… çŠ¶æ€å¾½ç« 
- âœ… åŠ è½½åŠ¨ç”»

### 4. é…ç½®æ–‡ä»¶

- âœ… `config.json` - æ¨¡å—é…ç½®
- âœ… `schema.json` - JSON Schema
- âœ… `flows.json` - Node-REDå·¥ä½œæµå‚è€ƒ

### 5. æ–‡æ¡£

- âœ… `README.md` - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
  - APIæ–‡æ¡£
  - ä½¿ç”¨ç¤ºä¾‹
  - é…ç½®è¯´æ˜
  - æ•…éšœæ’æŸ¥
  
- âœ… `quickstart.sh` - å¿«é€Ÿå¯åŠ¨è„šæœ¬

## ğŸ“‹ æ•°æ®æ ¼å¼

### è¾“å…¥æ ¼å¼
```json
{
  "type": "message",
  "content": "æ‰“å¼€æ‰€æœ‰ç¯",
  "metadata": {},
  "timestamp": "2025-10-25T15:28:01.491Z"
}
```

### è¾“å‡ºæ ¼å¼
```json
{
  "user_input": "æ‰“å¼€æ‰€æœ‰ç¯",
  "intent": "Control Device",
  "devices": [{
    "floor_name": "",
    "floor_name_en": "",
    "floor_type": "",
    "room_type": "",
    "room_name": "",
    "room_name_en": "",
    "device_type": "light",
    "device_name": "",
    "device_name_en": "",
    "service": "light.turn_on",
    "service_data": {}
  }],
  "confidence": 0.95,
  "user_responds": "å¥½çš„ï¼Œå³å°†ä¸ºæ‚¨æ‰“å¼€æ‰€æœ‰ç¯å…‰"
}
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### æ„å›¾åˆ†ç±»
æ”¯æŒ6ç§æ„å›¾ç±»å‹ï¼š
1. Query Device Status - æŸ¥è¯¢è®¾å¤‡çŠ¶æ€
2. Control Device - æ§åˆ¶è®¾å¤‡
3. Control Scene - åœºæ™¯æ§åˆ¶
4. Set Scene - è®¾å®šåœºæ™¯
5. Set Automation - è®¾å®šè‡ªåŠ¨åŒ–
6. Other - å…¶ä»–

### è®¾å¤‡æ˜ å°„
- âœ… æˆ¿é—´ç±»å‹æ˜ å°„ï¼ˆä¸­è‹±æ–‡ï¼‰
- âœ… è®¾å¤‡ç±»å‹æ˜ å°„
- âœ… Home AssistantæœåŠ¡è°ƒç”¨è§„åˆ™
- âœ… å‚æ•°æå–è§„åˆ™ï¼ˆé¢œè‰²ã€äº®åº¦ã€æ¸©åº¦ç­‰ï¼‰

### AIé›†æˆ
- âœ… è‡ªåŠ¨é€‰æ‹©å¯ç”¨AI
- âœ… æ”¯æŒå¤šä¸ªAIæä¾›å•†
- âœ… å¤±è´¥è‡ªåŠ¨åˆ‡æ¢
- âœ… æä¾›å•†é…ç½®ç®¡ç†

## ğŸ“ æ–‡ä»¶ç»“æ„

```
modules/intention/
â”œâ”€â”€ IntentionModule.js     # ä¸»æ¨¡å— (460è¡Œ)
â”œâ”€â”€ config.json            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ schema.json            # Schemaå®šä¹‰
â”œâ”€â”€ flows.json             # Node-REDå‚è€ƒ
â”œâ”€â”€ README.md              # ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ quickstart.sh          # å¿«é€Ÿå¯åŠ¨è„šæœ¬

data/intention/
â”œâ”€â”€ intentions.json        # å†å²è®°å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â””â”€â”€ custom_prompt.txt      # è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¯é€‰ï¼‰

public/
â””â”€â”€ intention-api-docs.html  # Webç•Œé¢ (1028è¡Œ)

server.js                   # æ·»åŠ äº†7ä¸ªAPI handler
```

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
node server.js
```

### 2. è®¿é—®Webç•Œé¢
```
http://localhost:3000/intention-api-docs.html
```

### 3. APIè°ƒç”¨ç¤ºä¾‹
```bash
curl -X POST http://localhost:3000/api/intention/intention/process \
  -H "Content-Type: application/json" \
  -d '{
    "type": "message",
    "content": "æ‰“å¼€å®¢å…çš„ç¯",
    "metadata": {},
    "timestamp": "2025-10-25T15:28:01.491Z"
  }'
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### é¦–æ¬¡ä½¿ç”¨å‰ï¼š
1. **é‡å¯æœåŠ¡å™¨** - æ–°æ¨¡å—éœ€è¦é‡å¯æ‰èƒ½åŠ è½½
2. **é…ç½®AI** - è‡³å°‘é…ç½®ä¸€ä¸ªAIæä¾›å•†ï¼ˆclaude/openai/gemini/deepseekï¼‰
3. **æµ‹è¯•è¿æ¥** - é€šè¿‡Webç•Œé¢æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œ

### ä¾èµ–è¦æ±‚ï¼š
- âœ… Node.jsç¯å¢ƒ
- âœ… è‡³å°‘ä¸€ä¸ªå·²é…ç½®çš„AIæ¨¡å—
- âœ… BaseCredentialModuleåŸºç±»
- âœ… ModuleManagerï¼ˆglobal.moduleManagerï¼‰

## ğŸ”§ æ‰©å±•æ€§

æ¨¡å—è®¾è®¡æ”¯æŒï¼š
- âœ… è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯
- âœ… æ·»åŠ æ–°çš„æ„å›¾ç±»å‹
- âœ… æ‰©å±•è®¾å¤‡ç±»å‹æ˜ å°„
- âœ… ä¿®æ”¹è¾“å‡ºæ ¼å¼
- âœ… è°ƒæ•´AIé€‰æ‹©ç­–ç•¥

## ğŸ“Š ä¸ai_enhanced_entitieså¯¹æ¯”

| ç‰¹æ€§ | ai_enhanced_entities | intention |
|------|---------------------|-----------|
| ä¸»è¦ç”¨é€” | å¢å¼ºHome Assistantå®ä½“æ•°æ® | è§£æç”¨æˆ·æ„å›¾ |
| è§¦å‘æ–¹å¼ | å®šæ—¶ç›‘æ§/æ‰‹åŠ¨è§¦å‘ | HTTPè¯·æ±‚è§¦å‘ |
| AIç”¨é€” | ç¿»è¯‘å’Œæ ‡å‡†åŒ–åç§° | ç†è§£è‡ªç„¶è¯­è¨€ |
| è¾“å‡º | å¢å¼ºçš„å®ä½“åˆ—è¡¨ | ç»“æ„åŒ–æŒ‡ä»¤ |
| æŒä¹…åŒ– | ai_enhanced_entities.json | intentions.json |
| äº¤äº’æ–¹å¼ | è‡ªåŠ¨åŒ– | å®æ—¶API |

## âœ¨ äº®ç‚¹åŠŸèƒ½

1. **å®Œå…¨å‚ç…§ai_enhanced_entitiesæ¨¡å—** - ä¿æŒä»£ç é£æ ¼ä¸€è‡´
2. **ç¾è§‚çš„Webç•Œé¢** - ä¸ai_enhanced_entitiesç›¸åŒçš„è®¾è®¡é£æ ¼
3. **å®Œæ•´çš„APIæ–‡æ¡£** - åŒ…å«æ‰€æœ‰ç«¯ç‚¹å’Œç¤ºä¾‹
4. **è‡ªåŠ¨AIé€‰æ‹©** - æ™ºèƒ½é€‰æ‹©å¯ç”¨çš„AIæä¾›å•†
5. **å†å²è®°å½•ç®¡ç†** - è‡ªåŠ¨ä¿å­˜å’Œé™åˆ¶æ•°é‡
6. **çµæ´»çš„æç¤ºè¯** - æ”¯æŒè‡ªå®šä¹‰å’Œæ¢å¤é»˜è®¤
7. **å®æ—¶æµ‹è¯•** - Webç•Œé¢å¯ç›´æ¥æµ‹è¯•åŠŸèƒ½

## ğŸ‰ æ€»ç»“

Intentionæ¨¡å—å·²å®Œå…¨å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®Œæ•´çš„åç«¯åŠŸèƒ½
- âœ… æ‰€æœ‰APIç«¯ç‚¹
- âœ… ç¾è§‚çš„Webç•Œé¢
- âœ… å®Œæ•´çš„æ–‡æ¡£
- âœ… æµ‹è¯•è„šæœ¬

**çŠ¶æ€ï¼šç”Ÿäº§å°±ç»ª** âœ…

éœ€è¦é‡å¯æœåŠ¡å™¨åå³å¯ä½¿ç”¨ï¼

