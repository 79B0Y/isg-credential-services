<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Best Match API æµ‹è¯•æ–‡æ¡£</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --light: #f5f5f5;
            --dark: #1f2937;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .panel {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-success {
            background: var(--success);
            color: white;
        }

        .status-error {
            background: var(--danger);
            color: white;
        }

        .status-warning {
            background: var(--warning);
            color: white;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #2563eb;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        .info-box {
            background: #eff6ff;
            border-left: 4px solid var(--info);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .success-box {
            background: #f0fdf4;
            border-left: 4px solid var(--success);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .warning-box {
            background: #fffbeb;
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .error-box {
            background: #fef2f2;
            border-left: 4px solid var(--danger);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .code-block {
            background: #1f2937;
            color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            margin: 1rem 0;
            line-height: 1.6;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .api-endpoint {
            background: var(--light);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .api-method {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-weight: bold;
            font-size: 0.875rem;
            margin-right: 0.5rem;
        }

        .method-get {
            background: #3b82f6;
            color: white;
        }

        .method-post {
            background: #10b981;
            color: white;
        }

        .method-put {
            background: #f59e0b;
            color: white;
        }

        .method-delete {
            background: #ef4444;
            color: white;
        }

        .api-path {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--dark);
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--light);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #6b7280;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .feature-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .feature-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .feature-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .example-card {
            background: var(--light);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .example-card:hover {
            background: #e5e7eb;
            transform: translateX(4px);
        }

        .example-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .example-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¯ Best Match API</h1>
            <p>æ™ºèƒ½è®¾å¤‡åŒ¹é…ç³»ç»Ÿ - TF-IDF + ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•</p>

            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number" id="totalMatches">-</span>
                    <span class="stat-label">æ€»åŒ¹é…æ¬¡æ•°</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="successRate">-</span>
                    <span class="stat-label">æˆåŠŸç‡</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avgScore">-</span>
                    <span class="stat-label">å¹³å‡å¾—åˆ†</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">6</span>
                    <span class="stat-label">åŒ¹é…åœºæ™¯</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('test')">ğŸ§ª æµ‹è¯•åŒ¹é…</button>
            <button class="tab" onclick="switchTab('api')">ğŸ“š API æ–‡æ¡£</button>
            <button class="tab" onclick="switchTab('examples')">ğŸ’¡ ç¤ºä¾‹åœºæ™¯</button>
            <button class="tab" onclick="switchTab('aliases')">ğŸ”– åˆ«åç®¡ç†</button>
            <button class="tab" onclick="switchTab('history')">ğŸ“Š å†å²è®°å½•</button>
        </div>

        <!-- Tab: Test -->
        <div id="tab-test" class="tab-content active">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ğŸ§ª æµ‹è¯•æ™ºèƒ½åŒ¹é…</div>
                    <span class="status-badge status-success">Ready</span>
                </div>

                <div class="info-box">
                    <strong>ğŸ’¡ æç¤ºï¼š</strong> è¾“å…¥æ ¼å¼ä¸ PDF ç¤ºä¾‹ä¸€è‡´ã€‚å·¦ä¾§è¾“å…¥æ„å›¾æ•°æ®å’Œå®ä½“æ•°æ®ï¼Œå³ä¾§æ˜¾ç¤ºåŒ¹é…ç»“æœã€‚
                </div>

                <div class="grid-2">
                    <!-- Left Side: Input -->
                    <div>
                        <div class="form-group">
                            <label class="form-label">ğŸ“¥ è¾“å…¥æ•°æ®å¯¹è±¡ 1ï¼šæ„å›¾æ•°æ® (Intention Data)</label>
                            <textarea id="intentionData" class="form-control" style="min-height: 250px;">{
  "success": true,
  "data": {
    "user_input": "æ‰“å¼€ä¸€æ¥¼ç¯å’ŒäºŒæ¥¼ç©ºè°ƒ",
    "intent": "Control Device",
    "devices": [{
      "floor_name": "ä¸€æ¥¼",
      "floor_name_en": "First Floor",
      "floor_type": "first_floor",
      "room_type": "",
      "room_name": "",
      "device_type": "light",
      "device_name": "",
      "service": "light.turn_on"
    }, {
      "floor_name": "äºŒæ¥¼",
      "floor_name_en": "Second Floor",
      "floor_type": "second_floor",
      "room_type": "",
      "room_name": "",
      "device_type": "climate",
      "device_name": "",
      "service": "climate.turn_on"
    }]
  }
}</textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ğŸ“¥ è¾“å…¥æ•°æ®å¯¹è±¡ 2ï¼šå®ä½“æ•°æ® (Entities Data)</label>
                            <textarea id="entitiesData" class="form-control" style="min-height: 250px;">{
  "success": true,
  "data": {
    "count": 5,
    "floors": ["first floor", "äºŒæ¥¼"],
    "rooms": ["å®¢å…", "å¨æˆ¿", "ä¹¦æˆ¿"],
    "entities": [{
      "entity_id": "light.color_light_1",
      "friendly_name": "å¸é¡¶ç¯",
      "device_type": "light",
      "room_name": "living_room",
      "floor_name": "first_floor",
      "level": 1
    }, {
      "entity_id": "climate.auto_ac_001",
      "friendly_name": "HA VT å§å®¤ç©ºè°ƒ",
      "device_type": "climate",
      "room_name": "ä¸»å§",
      "floor_name": "äºŒæ¥¼",
      "level": 2
    }]
  }
}</textarea>
                        </div>
                    </div>

                    <!-- Right Side: Output -->
                    <div>
                        <div class="form-group">
                            <label class="form-label">ğŸ“¤ åŒ¹é…ç»“æœ (Matched Entities)</label>
                            <div id="matchResults" style="min-height: 520px; border: 2px solid var(--light); border-radius: 0.5rem; padding: 1rem; background: #f9fafb;">
                                <p style="color: #6b7280; text-align: center; padding: 2rem;">ç‚¹å‡»"æ‰§è¡ŒåŒ¹é…"æŸ¥çœ‹ç»“æœ...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="testMatch()">
                        <span>ğŸš€ æ‰§è¡ŒåŒ¹é…</span>
                    </button>
                    <button class="btn btn-secondary" onclick="loadExampleData()">
                        <span>ğŸ“‹ åŠ è½½ç¤ºä¾‹</span>
                    </button>
                    <button class="btn btn-success" onclick="loadPDFExample()">
                        <span>ğŸ“„ PDF ç¤ºä¾‹</span>
                    </button>
                    <button class="btn btn-warning" onclick="autoFetchEntities()">
                        <span>ğŸ”„ è‡ªåŠ¨è·å–å®ä½“</span>
                    </button>
                    <button class="btn btn-danger" onclick="clearResults()">
                        <span>ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab: API -->
        <div id="tab-api" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ğŸ“š API ç«¯ç‚¹æ–‡æ¡£</div>
                </div>

                <div class="api-endpoint">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="api-method method-post">POST</span>
                        <span class="api-path">/api/bestMatch/bestMatch/match</span>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.75rem;">æ‰§è¡Œæ™ºèƒ½è®¾å¤‡åŒ¹é…</p>
                    
                    <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 1rem;">
                        <strong style="color: #1e40af;">â­ æ–°æ ¼å¼ï¼ˆæ¨èï¼‰</strong>
                        <p style="color: #1e3a8a; font-size: 0.875rem; margin-top: 0.5rem; margin-bottom: 0;">
                            ç›´æ¥ä¼ å…¥ Intention æ¨¡å—è¿”å›çš„å®Œæ•´å¯¹è±¡ï¼ŒEntities æ•°æ®å°†è‡ªåŠ¨ä» AI Enhanced Entities æ¨¡å—è·å–ã€‚
                        </p>
                    </div>
                    
                    <div class="code-block">// â­ æ–°æ ¼å¼è¯·æ±‚ç¤ºä¾‹ï¼ˆæ¨èï¼‰
{
  "success": true,
  "data": {
    "user_input": "æ‰“å¼€äºŒæ¥¼ç¯ï¼Œå…³é—­ä¸€æ¥¼ç©ºè°ƒ",
    "intent": "Control Device",
    "devices": [{
      "floor_name": "äºŒæ¥¼",
      "floor_name_en": "Second Floor",
      "floor_type": "second_floor",
      "room_type": "",
      "room_name": "",
      "room_name_en": "",
      "device_type": "light",
      "device_name": "",
      "device_name_en": "",
      "service": "light.turn_on",
      "service_data": {}
    }],
    "confidence": 0.95,
    "user_responds": "å¥½çš„ï¼Œå³å°†ä¸ºæ‚¨æ‰“å¼€äºŒæ¥¼ç¯å…‰",
    "ai_provider": "deepseek",
    "processed_at": "2025-10-26T01:45:34.329Z"
  }
}

// æ—§æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
{
  "intent_devices": [{
    "floor_name": "ä¸€æ¥¼",
    "room_name": "å®¢å…",
    "device_type": "light"
  }],
  "entities": [{
    "entity_id": "light.living_room_light",
    "friendly_name": "å®¢å…ç¯",
    ...
  }],
  "user_query": "æ‰“å¼€ä¸€æ¥¼å®¢å…ç¯"
}</div>
                </div>

                <div class="api-endpoint">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/modules/bestMatch/history?limit=50</span>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem;">è·å–åŒ¹é…å†å²è®°å½•</p>
                </div>

                <div class="api-endpoint">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/modules/bestMatch/stats</span>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem;">è·å–ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ¬¡æ•°ã€æˆåŠŸç‡ã€å¹³å‡å¾—åˆ†ï¼‰</p>
                </div>

                <div class="api-endpoint">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/modules/bestMatch/aliases</span>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem;">è·å–åˆ«åå­—å…¸ï¼ˆæ¥¼å±‚ã€æˆ¿é—´ã€è®¾å¤‡ç±»å‹ï¼‰</p>
                </div>

                <div class="api-endpoint">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="api-method method-post">POST</span>
                        <span class="api-path">/api/modules/bestMatch/aliases</span>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem;">æ›´æ–°åˆ«åå­—å…¸</p>
                </div>

                <div class="api-endpoint">
                    <div style="margin-bottom: 0.5rem;">
                        <span class="api-method method-delete">DELETE</span>
                        <span class="api-path">/api/modules/bestMatch/history</span>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem;">æ¸…é™¤æ‰€æœ‰å†å²è®°å½•</p>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ğŸ¯ åŒ¹é…ç®—æ³•è¯¦è§£</div>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”</div>
                        <div class="feature-title">TF-IDF ç®—æ³•</div>
                        <div class="feature-desc">ä½¿ç”¨æ–‡æœ¬å‘é‡åŒ–æŠ€æœ¯è®¡ç®—ç›¸ä¼¼åº¦</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">âš–ï¸</div>
                        <div class="feature-title">åŠ æƒè¯„åˆ†</div>
                        <div class="feature-desc">æ¥¼å±‚15% + æˆ¿é—´40% + è®¾å¤‡å30% + ç±»å‹15%</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸŒ</div>
                        <div class="feature-title">å¤šè¯­è¨€æ”¯æŒ</div>
                        <div class="feature-desc">ä¸­æ–‡ã€è‹±æ–‡ã€æ‹¼éŸ³å…¨é¢æ”¯æŒ</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”„</div>
                        <div class="feature-title">æ¨¡ç³ŠåŒ¹é…</div>
                        <div class="feature-desc">å¿½ç•¥ç©ºæ ¼ã€ä¸‹åˆ’çº¿ã€å¤§å°å†™</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ“</div>
                        <div class="feature-title">ä½ç½®æå–</div>
                        <div class="feature-desc">æ™ºèƒ½ä»è®¾å¤‡åæå–ä½ç½®ä¿¡æ¯</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ¤–</div>
                        <div class="feature-title">AI å»ºè®®</div>
                        <div class="feature-desc">åŒ¹é…å¤±è´¥æ—¶è°ƒç”¨ LLM æä¾›å»ºè®®</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Examples -->
        <div id="tab-examples" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ğŸ’¡ åŒ¹é…åœºæ™¯ç¤ºä¾‹</div>
                </div>

                <div class="example-card" onclick="loadExample('all')">
                    <div class="example-title">åœºæ™¯1ï¼šæ‰€æœ‰è®¾å¤‡æ¨¡å¼</div>
                    <div class="example-desc">æŸ¥è¯¢ï¼š"æ‰“å¼€æ‰€æœ‰ç¯" - è¿”å›æ‰€æœ‰ç¯å…‰è®¾å¤‡</div>
                </div>

                <div class="example-card" onclick="loadExample('floor')">
                    <div class="example-title">åœºæ™¯2ï¼šæ¥¼å±‚æ¨¡å¼</div>
                    <div class="example-desc">æŸ¥è¯¢ï¼š"æ‰“å¼€ä¸€æ¥¼ç©ºè°ƒ" - è¿”å›ä¸€æ¥¼æ‰€æœ‰ç©ºè°ƒè®¾å¤‡</div>
                </div>

                <div class="example-card" onclick="loadExample('room-generic')">
                    <div class="example-title">åœºæ™¯3ï¼šæˆ¿é—´ + æ³›æŒ‡è®¾å¤‡</div>
                    <div class="example-desc">æŸ¥è¯¢ï¼š"æ‰“å¼€å®¢å…ç¯" - è¿”å›å®¢å…æ‰€æœ‰ç¯å…‰è®¾å¤‡</div>
                </div>

                <div class="example-card" onclick="loadExample('room-specific')">
                    <div class="example-title">åœºæ™¯4ï¼šæˆ¿é—´ + å…·ä½“è®¾å¤‡å</div>
                    <div class="example-desc">æŸ¥è¯¢ï¼š"æ‰“å¼€å§å®¤å¸é¡¶ç¯" - ç²¾ç¡®åŒ¹é…å§å®¤å¸é¡¶ç¯</div>
                </div>

                <div class="example-card" onclick="loadExample('complete')">
                    <div class="example-title">åœºæ™¯5ï¼šå®Œæ•´åŒ¹é…</div>
                    <div class="example-desc">æŸ¥è¯¢ï¼š"æ‰“å¼€ä¸€æ¥¼å®¢å…å¸é¡¶ç¯" - æœ€ç²¾ç¡®çš„åŒ¹é…</div>
                </div>

                <div class="example-card" onclick="loadExample('location')">
                    <div class="example-title">åœºæ™¯6ï¼šæ™ºèƒ½ä½ç½®æå–</div>
                    <div class="example-desc">æŸ¥è¯¢ï¼š"æ‰“å¼€backyardå¼€å…³" - ä»è®¾å¤‡åæå–ä½ç½®</div>
                </div>
            </div>
        </div>

        <!-- Tab: Aliases -->
        <div id="tab-aliases" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ğŸ”– åˆ«åç®¡ç†</div>
                    <button class="btn btn-success" onclick="loadAliases()">
                        <span>ğŸ”„ åˆ·æ–°åˆ«å</span>
                    </button>
                </div>

                <div id="aliasesContent">
                    <p style="color: #6b7280;">ç‚¹å‡»"åˆ·æ–°åˆ«å"åŠ è½½å½“å‰åˆ«åå­—å…¸...</p>
                </div>
            </div>
        </div>

        <!-- Tab: History -->
        <div id="tab-history" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ğŸ“Š åŒ¹é…å†å²</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="loadHistory()">
                            <span>ğŸ”„ åˆ·æ–°</span>
                        </button>
                        <button class="btn btn-danger" onclick="clearHistory()">
                            <span>ğŸ—‘ï¸ æ¸…ç©º</span>
                        </button>
                    </div>
                </div>

                <div id="historyContent">
                    <p style="color: #6b7280;">ç‚¹å‡»"åˆ·æ–°"åŠ è½½å†å²è®°å½•...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('tab-' + tabName).classList.add('active');

            // Load data for certain tabs
            if (tabName === 'history') {
                loadHistory();
            } else if (tabName === 'aliases') {
                loadAliases();
            }
        }

        // Load Statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/bestMatch/bestMatch/stats');
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    document.getElementById('totalMatches').textContent = data.requests || 0;
                    document.getElementById('successRate').textContent =
                        data.requests > 0
                            ? Math.round((data.actions_matched / data.requests) * 100) + '%'
                            : '-';
                    document.getElementById('avgScore').textContent =
                        data.avg_score ? data.avg_score.toFixed(2) : '-';
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Test Match
        async function testMatch() {
            const resultDiv = document.getElementById('matchResults');
            resultDiv.innerHTML = '<div class="info-box">â³ æ­£åœ¨æ‰§è¡ŒåŒ¹é…...</div>';

            try {
                // Parse intention object
                const intentionObj = JSON.parse(document.getElementById('intentionData').value);

                // â­ æ–°æ ¼å¼ï¼šç›´æ¥ä¼ å…¥ intention å¯¹è±¡ï¼Œentities è‡ªåŠ¨è·å–
                const response = await fetch('/api/bestMatch/bestMatch/match', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(intentionObj)
                });

                const result = await response.json();

                if (result.success) {
                    const userQuery = intentionObj.data?.user_input || '';
                    displayMatchResult(result.data, userQuery);
                    loadStats(); // Refresh stats
                } else {
                    resultDiv.innerHTML = `<div class="error-box"><strong>âŒ é”™è¯¯ï¼š</strong> ${result.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-box"><strong>âŒ è§£æé”™è¯¯ï¼š</strong> ${error.message}<br><small>è¯·æ£€æŸ¥è¾“å…¥æ ¼å¼æ˜¯å¦æ­£ç¡®</small></div>`;
            }
        }

        // Display Match Result
        function displayMatchResult(data, userQuery) {
            const resultDiv = document.getElementById('matchResults');
            let html = '';

            // Header
            html += `
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <strong>âœ… åŒ¹é…æˆåŠŸ</strong>
                    ${userQuery ? `<br><small>æŸ¥è¯¢: ${userQuery}</small>` : ''}
                </div>`;

            if (data.actions && data.actions.length > 0) {
                let totalMatched = 0;
                data.actions.forEach((action, index) => {
                    totalMatched += action.targets.length;

                    html += `
                        <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <strong style="color: #047857;">åŠ¨ä½œ #${index + 1}</strong>
                                <span style="background: ${action.targets.length > 0 ? '#10b981' : '#f59e0b'}; color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem;">
                                    ${action.targets.length} ä¸ªè®¾å¤‡
                                </span>
                            </div>`;

                    // Display request info
                    const req = action.request;
                    html += `<div style="font-size: 0.875rem; color: #065f46; margin-bottom: 0.5rem;">`;
                    if (req.floor) html += `<span style="background: #d1fae5; padding: 0.125rem 0.5rem; border-radius: 0.25rem; margin-right: 0.25rem;">ğŸ¢ ${req.floor}</span>`;
                    if (req.room) html += `<span style="background: #d1fae5; padding: 0.125rem 0.5rem; border-radius: 0.25rem; margin-right: 0.25rem;">ğŸšª ${req.room}</span>`;
                    if (req.device_type) html += `<span style="background: #d1fae5; padding: 0.125rem 0.5rem; border-radius: 0.25rem; margin-right: 0.25rem;">ğŸ’¡ ${req.device_type}</span>`;
                    if (req.device_name) html += `<span style="background: #d1fae5; padding: 0.125rem 0.5rem; border-radius: 0.25rem;">ğŸ“› ${req.device_name}</span>`;
                    html += `</div>`;

                    // Display matched entities
                    if (action.targets.length > 0) {
                        html += '<div style="margin-top: 0.75rem;">';
                        action.targets.forEach((target, i) => {
                            const scoreColor = target.score >= 0.9 ? '#10b981' : target.score >= 0.7 ? '#f59e0b' : '#ef4444';
                            html += `
                                <div style="background: white; border: 1px solid #e5e7eb; padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                                                ${target.device_name || target.entity_id}
                                            </div>
                                            <div style="font-size: 0.75rem; color: #6b7280; font-family: monospace;">
                                                ${target.entity_id}
                                            </div>
                                        </div>
                                        <div style="background: ${scoreColor}; color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600;">
                                            ${(target.score * 100).toFixed(1)}%
                                        </div>
                                    </div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">
                                        <span>ğŸ“ ${target.floor || '-'} / ${target.room || '-'}</span>
                                    </div>
                                </div>`;
                        });
                        html += '</div>';
                    } else if (action.suggestions_if_empty && action.suggestions_if_empty.length > 0) {
                        html += '<div style="background: #fffbeb; border: 1px solid #fcd34d; padding: 0.75rem; border-radius: 0.375rem; margin-top: 0.75rem;">';
                        html += '<strong style="color: #d97706;">âš ï¸ æœªæ‰¾åˆ°åŒ¹é…ï¼ŒAI å»ºè®®ï¼š</strong><br><br>';
                        action.suggestions_if_empty.forEach((suggestion, i) => {
                            html += `
                                <div style="font-size: 0.875rem; margin-bottom: 0.5rem;">
                                    <strong>${i + 1}. ${suggestion.entity_id}</strong><br>
                                    <span style="color: #92400e;">${suggestion.device_name} (${suggestion.room}, ${suggestion.floor})</span>
                                </div>`;
                        });
                        html += '</div>';
                    } else {
                        html += '<div style="background: #fee2e2; border: 1px solid #fca5a5; padding: 0.75rem; border-radius: 0.375rem; margin-top: 0.75rem; color: #991b1b;">âš ï¸ æœªæ‰¾åˆ°åŒ¹é…è®¾å¤‡</div>';
                    }

                    html += '</div>';
                });

                // Summary
                html += `
                    <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                        <strong style="color: #1e40af;">ğŸ“Š åŒ¹é…æ‘˜è¦</strong><br>
                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #1e40af;">
                            æ€»å…±åŒ¹é…åˆ° <strong>${totalMatched}</strong> ä¸ªè®¾å¤‡ï¼Œæ¥è‡ª <strong>${data.actions.length}</strong> ä¸ªåŠ¨ä½œ
                        </div>
                    </div>`;
            } else {
                html = '<div style="background: #fee2e2; border-left: 4px solid #ef4444; padding: 1rem; border-radius: 0.5rem; color: #991b1b;">âŒ æ²¡æœ‰åŒ¹é…ç»“æœ</div>';
            }

            resultDiv.innerHTML = html;
        }

        // Load Example Data
        function loadExampleData() {
            // â­ æ–°æ ¼å¼ï¼šåªéœ€è¦ intention å¯¹è±¡ï¼Œentities è‡ªåŠ¨è·å–
            const exampleIntention = {
                "success": true,
                "data": {
                    "user_input": "æ‰“å¼€ä¸€æ¥¼å®¢å…ç¯",
                    "intent": "Control Device",
                    "devices": [{
                        "floor_name": "ä¸€æ¥¼",
                        "floor_name_en": "First Floor",
                        "floor_type": "first_floor",
                        "room_name": "å®¢å…",
                        "room_name_en": "Living Room",
                        "room_type": "living_room",
                        "device_type": "light",
                        "device_name": "",
                        "device_name_en": "",
                        "service": "light.turn_on",
                        "service_data": {}
                    }],
                    "confidence": 0.95,
                    "user_responds": "å¥½çš„ï¼Œå³å°†ä¸ºæ‚¨æ‰“å¼€ä¸€æ¥¼å®¢å…çš„ç¯å…‰",
                    "ai_provider": "deepseek",
                    "processed_at": new Date().toISOString()
                }
            };

            document.getElementById('intentionData').value = JSON.stringify(exampleIntention, null, 2);
            
            // è‡ªåŠ¨è·å– entitiesï¼ˆé™é»˜æ¨¡å¼ï¼‰
            autoFetchEntities(true);

            alert('âœ… ç¤ºä¾‹æ•°æ®å·²åŠ è½½ï¼Entities æ•°æ®è‡ªåŠ¨è·å–ä¸­...');
        }

        // Load PDF Example
        // Auto Fetch Entities from AI Enhanced Entities Module
        async function autoFetchEntities(silent = false) {
            const content = document.getElementById('entitiesData');
            
            try {
                content.value = 'â³ æ­£åœ¨ä» ai_enhanced_entities æ¨¡å—è·å–å®ä½“æ•°æ®...';
                
                const response = await fetch('/api/ai_enhanced_entities/ai_enhanced_entities/saved');
                const result = await response.json();
                
                if (result.success) {
                    content.value = JSON.stringify(result, null, 2);
                    if (!silent) {
                        alert(`âœ… æˆåŠŸè·å– ${result.data?.entities?.length || 0} ä¸ªå®ä½“ï¼`);
                    } else {
                        console.log(`âœ… é¡µé¢åŠ è½½ï¼šæˆåŠŸè·å– ${result.data?.entities?.length || 0} ä¸ªæœ€æ–°å®ä½“`);
                    }
                } else {
                    content.value = JSON.stringify(result, null, 2);
                    if (!silent) {
                        alert('âš ï¸ è·å–å®ä½“å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                    } else {
                        console.warn('âš ï¸ é¡µé¢åŠ è½½ï¼šè·å–å®ä½“å¤±è´¥', result.error);
                    }
                }
            } catch (error) {
                content.value = `// é”™è¯¯: ${error.message}`;
                if (!silent) {
                    alert('âŒ è·å–å®ä½“æ—¶å‡ºé”™: ' + error.message);
                } else {
                    console.error('âŒ é¡µé¢åŠ è½½ï¼šè·å–å®ä½“æ—¶å‡ºé”™', error.message);
                }
            }
        }

        function loadPDFExample() {
            // â­ ä½¿ç”¨æ‚¨æä¾›çš„æ–°æ ¼å¼ç¤ºä¾‹
            const pdfIntention = {
                "success": true,
                "data": {
                    "user_input": "æ‰“å¼€äºŒæ¥¼ç¯ï¼Œå…³é—­ä¸€æ¥¼ç©ºè°ƒ",
                    "intent": "Control Device",
                    "devices": [{
                        "floor_name": "äºŒæ¥¼",
                        "floor_name_en": "Second Floor",
                        "floor_type": "second_floor",
                        "room_type": "",
                        "room_name": "",
                        "room_name_en": "",
                        "device_type": "light",
                        "device_name": "",
                        "device_name_en": "",
                        "service": "light.turn_on",
                        "service_data": {}
                    }, {
                        "floor_name": "ä¸€æ¥¼",
                        "floor_name_en": "First Floor",
                        "floor_type": "first_floor",
                        "room_type": "",
                        "room_name": "",
                        "room_name_en": "",
                        "device_type": "climate",
                        "device_name": "",
                        "device_name_en": "",
                        "service": "climate.turn_off",
                        "service_data": {}
                    }],
                    "confidence": 0.95,
                    "user_responds": "å¥½çš„ï¼Œå³å°†ä¸ºæ‚¨æ‰“å¼€äºŒæ¥¼ç¯å…‰å¹¶å…³é—­ä¸€æ¥¼ç©ºè°ƒ",
                    "ai_provider": "deepseek",
                    "processed_at": "2025-10-26T01:45:34.329Z"
                }
            };

            document.getElementById('intentionData').value = JSON.stringify(pdfIntention, null, 2);
            
            // è‡ªåŠ¨è·å– entitiesï¼ˆé™é»˜æ¨¡å¼ï¼‰
            autoFetchEntities(true);

            alert('ğŸ“„ PDF ç¤ºä¾‹æ•°æ®å·²åŠ è½½ï¼Entities æ•°æ®è‡ªåŠ¨è·å–ä¸­...');
        }

        // Clear Results
        function clearResults() {
            document.getElementById('matchResults').innerHTML = '<p style="color: #6b7280; text-align: center; padding: 2rem;">ç‚¹å‡»"æ‰§è¡ŒåŒ¹é…"æŸ¥çœ‹ç»“æœ...</p>';
        }

        // Load Example Scenarios
        function loadExample(scenario) {
            // Switch to test tab
            switchTab('test');

            // TODO: Load specific example based on scenario
            alert(`æ­£åœ¨åŠ è½½åœºæ™¯: ${scenario}`);
        }

        // Load Aliases
        async function loadAliases() {
            const content = document.getElementById('aliasesContent');
            content.innerHTML = '<div class="info-box">â³ åŠ è½½ä¸­...</div>';

            try {
                const response = await fetch('/api/bestMatch/bestMatch/aliases');
                const result = await response.json();

                if (result.success) {
                    content.innerHTML = '<div class="code-block">' + JSON.stringify(result.data, null, 2) + '</div>';
                } else {
                    content.innerHTML = '<div class="error-box">âŒ åŠ è½½å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                content.innerHTML = '<div class="error-box">âŒ åŠ è½½å¤±è´¥: ' + error.message + '</div>';
            }
        }

        // Load History
        async function loadHistory() {
            const content = document.getElementById('historyContent');
            content.innerHTML = '<div class="info-box">â³ åŠ è½½ä¸­...</div>';

            try {
                const response = await fetch('/api/bestMatch/bestMatch/history?limit=20');
                const result = await response.json();

                if (result.success && result.data.history.length > 0) {
                    let html = '';
                    result.data.history.forEach((item, index) => {
                        html += `
                            <div class="api-endpoint">
                                <strong>#${index + 1}</strong> - ${new Date(item.timestamp).toLocaleString()}<br>
                                <small style="color: #6b7280;">æŸ¥è¯¢: ${item.input.userQuery || 'æ— '}</small>
                            </div>`;
                    });
                    content.innerHTML = html;
                } else {
                    content.innerHTML = '<div class="warning-box">ğŸ“­ æš‚æ— å†å²è®°å½•</div>';
                }
            } catch (error) {
                content.innerHTML = '<div class="error-box">âŒ åŠ è½½å¤±è´¥: ' + error.message + '</div>';
            }
        }

        // Clear History
        async function clearHistory() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) return;

            try {
                const response = await fetch('/api/bestMatch/bestMatch/history', {
                    method: 'DELETE'
                });
                const result = await response.json();

                if (result.success) {
                    alert('âœ… å†å²è®°å½•å·²æ¸…ç©º');
                    loadHistory();
                    loadStats();
                } else {
                    alert('âŒ æ¸…ç©ºå¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('âŒ æ¸…ç©ºå¤±è´¥: ' + error.message);
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadStats();
            // â­ é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–å¹¶å±•ç¤ºæœ€æ–°çš„ entities æ•°æ®ï¼ˆé™é»˜æ¨¡å¼ï¼‰
            autoFetchEntities(true);
        });
    </script>
</body>
</html>


