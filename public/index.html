<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credential Service Manager</title>
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .api-key-section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .api-key-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gray-700);
        }

        .input-group {
            display: flex;
            gap: 1rem;
            align-items: end;
        }

        .input-group label {
            flex: 1;
            font-weight: 500;
            color: var(--gray-600);
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            font-size: 1rem;
            margin-top: 0.5rem;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-connected {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-disconnected {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .module-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .module-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            border-bottom: 1px solid var(--gray-200);
        }

        .module-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .module-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .module-status {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
        }

        .status-enabled { background-color: var(--success-color); }
        .status-disabled { background-color: var(--gray-400); }

        .module-content {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-group input[type="password"] {
            font-family: 'Courier New', monospace;
        }

        .module-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .module-actions .btn {
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
        }

        .validation-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }

        .validation-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .validation-error {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .collapsible-details {
            margin-top: 0.5rem;
        }

        .collapsible-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.875rem;
            text-decoration: underline;
        }

        .collapsible-content {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--gray-200);
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success { background-color: var(--success-color); }
        .toast-error { background-color: var(--danger-color); }
        .toast-warning { background-color: var(--warning-color); }

        .statistics {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .stat-card {
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
            background: var(--gray-50);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .modules-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .module-actions {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Telegram Messaging Styles */
        .telegram-messaging {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .messaging-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .messaging-header h2 {
            font-size: 1.5rem;
            color: var(--gray-700);
        }

        .messaging-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .messaging-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            color: var(--gray-600);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .messages-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .message-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            background: var(--gray-50);
            border-left: 4px solid var(--primary-color);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .message-from {
            font-weight: 600;
            color: var(--gray-700);
        }

        .message-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .message-time {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .message-media {
            margin-top: 0.5rem;
        }

        .media-item {
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            overflow: hidden;
            background: var(--gray-100);
        }

        .media-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: transform 0.2s ease;
        }

        .media-image:hover {
            transform: scale(1.02);
        }

        .media-video {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 0.5rem;
        }

        .media-audio {
            width: 100%;
            max-width: 300px;
        }

        .media-document {
            padding: 1rem;
            background: var(--primary-color);
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s ease;
        }

        .media-document:hover {
            background: var(--primary-dark);
        }

        .media-info {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
            text-align: center;
        }

        /* åª’ä½“æ¨¡æ€æ¡†æ ·å¼ */
        .media-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            z-index: 1001;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .modal-image {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        .photo-selector {
            position: absolute;
            top: 60px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1002;
        }

        .photo-selector label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .photo-selector select {
            background: white;
            color: black;
            border: none;
            padding: 5px;
            border-radius: 3px;
            font-size: 0.9rem;
        }

        .image-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 1002;
        }

        /* APIæ–‡æ¡£æ ·å¼ */
        .api-documentation {
            padding: 1rem;
        }

        .api-section {
            margin-bottom: 2rem;
        }

        .api-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        .api-section h4 {
            color: var(--gray-700);
            margin-bottom: 1rem;
            margin-top: 1.5rem;
        }

        .api-endpoint {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--gray-100);
            border-bottom: 1px solid var(--gray-200);
        }

        .method {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: bold;
            font-size: 0.8rem;
            min-width: 60px;
            text-align: center;
        }

        .method.get {
            background: var(--success-color);
            color: white;
        }

        .method.post {
            background: var(--warning-color);
            color: white;
        }

        .method.delete {
            background: var(--danger-color);
            color: white;
        }

        .method.put {
            background: var(--info-color);
            color: white;
        }

        .url {
            font-family: 'Courier New', monospace;
            background: var(--gray-200);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            flex: 1;
        }

        .endpoint-description {
            padding: 1rem;
            color: var(--gray-600);
            font-style: italic;
        }

        .endpoint-example {
            padding: 1rem;
            background: var(--gray-900);
            color: var(--gray-100);
        }

        .endpoint-example pre {
            margin: 0;
            overflow-x: auto;
        }

        .endpoint-example code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .api-test-results {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
            min-height: 100px;
        }

        .test-result {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.25rem;
            border-left: 4px solid;
        }

        .test-result.success {
            background: #f0f9ff;
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .test-result.error {
            background: #fef2f2;
            border-left-color: var(--danger-color);
            color: var(--danger-color);
        }

        .test-result.info {
            background: #f0f9ff;
            border-left-color: var(--info-color);
            color: var(--info-color);
        }

        .test-result pre {
            background: var(--gray-100);
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin-top: 0.5rem;
            overflow-x: auto;
            font-size: 0.8rem;
        }

        .message-content {
            margin-bottom: 0.5rem;
        }

        .message-type {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--primary-color);
            color: white;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }

        .message-text {
            color: var(--gray-800);
        }

        .message-media {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: white;
            border-radius: 0.25rem;
            border: 1px solid var(--gray-200);
        }

        .media-info {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .send-message-form {
            max-width: 600px;
        }

        .webhook-settings {
            max-width: 600px;
        }

        .webhook-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .webhook-status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }

        .webhook-status.success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .webhook-status.error {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .webhook-status.info {
            background-color: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .polling-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            margin-left: 1rem;
        }

        .polling-active {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .polling-inactive {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .messaging-stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            border: 1px solid var(--gray-200);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-item .stat-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }

        .stat-item .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .messaging-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .messaging-controls {
                justify-content: center;
            }

            .messaging-tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 120px;
            }

            .webhook-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ” Credential Service Manager</h1>
            <p>ç»Ÿä¸€ç®¡ç†å’ŒéªŒè¯æ‚¨çš„APIå‡­æ®</p>
            <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 1rem;">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span>æ£€æŸ¥è¿æ¥ä¸­...</span>
                </div>
                <button class="btn btn-primary" onclick="showApiDocumentation()" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3);">
                    ğŸ“š API æ–‡æ¡£
                </button>
            </div>
        </div>

        <!-- APIå¯†é’¥é…ç½® -->
        <div class="api-key-section">
            <h2>ğŸ”‘ APIå¯†é’¥é…ç½®</h2>
            <div class="input-group">
                <label>
                    æœåŠ¡APIå¯†é’¥
                    <input type="password" id="apiKey" placeholder="è¾“å…¥æœåŠ¡APIå¯†é’¥ä»¥å¯ç”¨ç®¡ç†åŠŸèƒ½">
                </label>
                <button class="btn btn-primary" onclick="setApiKey()">è¿æ¥</button>
            </div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="statistics hidden" id="statistics">
            <h2>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h2>
            <div class="stats-grid" id="statsGrid">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- APIæ–‡æ¡£é“¾æ¥ -->
        <div class="api-documentation hidden" id="apiDocumentation">
            <div class="messaging-header">
                <h2>ğŸ“š API æ–‡æ¡£</h2>
                <p>è®¿é—®å„æœåŠ¡çš„è¯¦ç»†APIæ–‡æ¡£å’Œæµ‹è¯•å·¥å…·</p>
            </div>
            
            <div class="api-section">
                <h3>ğŸ”— æœåŠ¡APIæ–‡æ¡£</h3>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®¿é—®å„æœåŠ¡çš„å®Œæ•´APIæ–‡æ¡£ï¼ŒåŒ…å«è¯¦ç»†çš„ç«¯ç‚¹è¯´æ˜ã€curlç¤ºä¾‹å’Œå®æ—¶æµ‹è¯•åŠŸèƒ½ã€‚</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                    <a href="/api-docs.html" target="_blank" class="btn btn-primary" style="text-decoration: none; text-align: center; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 2rem;">ğŸ“±</span>
                        <span style="font-weight: 600;">Telegram API æ–‡æ¡£</span>
                        <span style="font-size: 0.9rem; opacity: 0.8;">æ¶ˆæ¯ç®¡ç†ã€æ–‡ä»¶å¤„ç†ã€Webhook</span>
                    </a>
                    
                    <a href="/home-assistant-api-docs.html" target="_blank" class="btn btn-warning" style="text-decoration: none; text-align: center; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 2rem;">ğŸ </span>
                        <span style="font-weight: 600;">Home Assistant API æ–‡æ¡£</span>
                        <span style="font-size: 0.9rem; opacity: 0.8;">å®ä½“ç®¡ç†ã€æœåŠ¡è°ƒç”¨ã€çŠ¶æ€æ§åˆ¶</span>
                    </a>
                    
                    <a href="/openai-api-docs.html" target="_blank" class="btn btn-success" style="text-decoration: none; text-align: center; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 2rem;">ğŸ¤–</span>
                        <span style="font-weight: 600;">OpenAI API æ–‡æ¡£</span>
                        <span style="font-size: 0.9rem; opacity: 0.8;">AIèŠå¤©ã€æ¨¡å‹ç®¡ç†ã€æ™ºèƒ½å¯¹è¯</span>
                    </a>
                    
                    <a href="/gemini-api-docs.html" target="_blank" class="btn btn-info" style="text-decoration: none; text-align: center; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 2rem;">ğŸ’</span>
                        <span style="font-weight: 600;">Google Gemini API æ–‡æ¡£</span>
                        <span style="font-size: 0.9rem; opacity: 0.8;">å¤šæ¨¡æ€AIã€å®‰å…¨å¯¹è¯ã€æ™ºèƒ½åŠ©æ‰‹</span>
                    </a>
                </div>
            </div>
            
            <div class="api-section">
                <h3>ğŸ”§ åŸºç¡€APIä¿¡æ¯</h3>
                <p>Credential Service æä¾›çš„åŸºç¡€APIç«¯ç‚¹ï¼š</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: var(--gray-50); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--gray-200);">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="background: var(--success-color); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; font-weight: bold;">GET</span>
                            <span style="font-family: 'Courier New', monospace; font-size: 0.9rem;">/api/health</span>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--gray-600);">æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€</div>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--gray-200);">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="background: var(--success-color); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; font-weight: bold;">GET</span>
                            <span style="font-family: 'Courier New', monospace; font-size: 0.9rem;">/api/modules</span>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--gray-600);">è·å–æ‰€æœ‰æ¨¡å—åˆ—è¡¨</div>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--gray-200);">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="background: var(--success-color); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; font-weight: bold;">GET</span>
                            <span style="font-family: 'Courier New', monospace; font-size: 0.9rem;">/api/statistics</span>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--gray-600);">è·å–ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Telegram æ¶ˆæ¯ç®¡ç† -->
        <div class="telegram-messaging hidden" id="telegramMessaging">
            <div class="messaging-header">
                <h2>ğŸ“± Telegram æ¶ˆæ¯ç®¡ç†</h2>
                <div class="messaging-controls">
                    <button class="btn btn-success" onclick="startTelegramPolling()">å¼€å§‹è½®è¯¢</button>
                    <button class="btn btn-warning" onclick="stopTelegramPolling()">åœæ­¢è½®è¯¢</button>
                    <button class="btn btn-primary" onclick="refreshMessages()">åˆ·æ–°æ¶ˆæ¯</button>
                    <button class="btn btn-danger" onclick="clearMessages()">æ¸…é™¤å†å²</button>
                </div>
            </div>
            
            <div class="messaging-stats" id="messagingStats">
                <div class="stat-item">
                    <span class="stat-label">æ¶ˆæ¯æ€»æ•°:</span>
                    <span class="stat-value" id="totalMessages">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æœ€åæ›´æ–°:</span>
                    <span class="stat-value" id="lastUpdate">-</span>
                </div>
            </div>
            
            <div class="messaging-tabs">
                <button class="tab-btn active" onclick="switchTab('messages')">æ¶ˆæ¯å†å²</button>
                <button class="tab-btn" onclick="switchTab('send')">å‘é€æ¶ˆæ¯</button>
                <button class="tab-btn" onclick="switchTab('webhook')">Webhookè®¾ç½®</button>
                <button class="tab-btn" onclick="switchTab('api')">APIæ–‡æ¡£</button>
            </div>
            
            <!-- æ¶ˆæ¯å†å²æ ‡ç­¾é¡µ -->
            <div class="tab-content active" id="tab-messages">
                <div class="messages-container">
                    <div class="messages-list" id="messagesList">
                        <!-- æ¶ˆæ¯åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å‘é€æ¶ˆæ¯æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="tab-send">
                <div class="send-message-form">
                    <div class="form-group">
                        <label for="sendChatId">èŠå¤©ID</label>
                        <input type="text" id="sendChatId" placeholder="è¾“å…¥èŠå¤©IDæˆ–ç”¨æˆ·åï¼ˆå¦‚ï¼š@username æˆ– 123456789ï¼‰">
                        <small style="color: var(--gray-500); font-size: 0.8rem;">
                            ğŸ’¡ æç¤ºï¼šå¯ä»¥ç›´æ¥ç‚¹å‡»æ¶ˆæ¯å†å²ä¸­çš„"å›å¤"æŒ‰é’®è‡ªåŠ¨å¡«å……èŠå¤©IDï¼Œæˆ–æ‰‹åŠ¨è¾“å…¥@usernameã€ç”¨æˆ·IDæˆ–ç¾¤ç»„ID
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="sendMessageType">æ¶ˆæ¯ç±»å‹</label>
                        <select id="sendMessageType" onchange="updateSendForm()">
                            <option value="text">æ–‡æœ¬æ¶ˆæ¯</option>
                            <option value="photo">å›¾ç‰‡</option>
                            <option value="video">è§†é¢‘</option>
                            <option value="voice">è¯­éŸ³</option>
                            <option value="document">æ–‡æ¡£</option>
                        </select>
                    </div>
                    <div class="form-group" id="textMessageGroup">
                        <label for="sendText">æ¶ˆæ¯å†…å®¹</label>
                        <textarea id="sendText" rows="4" placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹"></textarea>
                    </div>
                    <div class="form-group hidden" id="mediaMessageGroup">
                        <label for="sendMedia">åª’ä½“æ–‡ä»¶</label>
                        <input type="text" id="sendMedia" placeholder="è¾“å…¥æ–‡ä»¶IDæˆ–URL">
                    </div>
                    <div class="form-group">
                        <label for="sendCaption">è¯´æ˜æ–‡å­—ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="sendCaption" placeholder="è¾“å…¥è¯´æ˜æ–‡å­—">
                    </div>
                    <button class="btn btn-primary" onclick="sendTelegramMessage()">å‘é€æ¶ˆæ¯</button>
                </div>
            </div>
            
            <!-- Webhookè®¾ç½®æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="tab-webhook">
                <div class="webhook-settings">
                    <div class="form-group">
                        <label for="webhookUrl">Webhook URL</label>
                        <input type="url" id="webhookUrl" placeholder="https://your-domain.com/webhook">
                    </div>
                    <div class="form-group">
                        <label for="webhookSecret">å¯†é’¥ä»¤ç‰Œï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="webhookSecret" placeholder="è¾“å…¥å¯†é’¥ä»¤ç‰Œ">
                    </div>
                    <div class="webhook-actions">
                        <button class="btn btn-success" onclick="setWebhook()">è®¾ç½®Webhook</button>
                        <button class="btn btn-warning" onclick="removeWebhook()">ç§»é™¤Webhook</button>
                        <button class="btn btn-primary" onclick="getWebhookInfo()">è·å–ä¿¡æ¯</button>
                    </div>
                    <div id="webhookStatus"></div>
                </div>
            </div>
            
            <!-- APIæ–‡æ¡£æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="tab-api">
                <div class="api-documentation">
                    <div class="api-section">
                        <h3>ğŸ“š API æ–‡æ¡£</h3>
                        <p>ä»¥ä¸‹æ˜¯æ‰€æœ‰å¯ç”¨çš„APIç«¯ç‚¹ï¼Œæ‚¨å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨æˆ–åœ¨å‰ç«¯åº”ç”¨ä¸­è°ƒç”¨ã€‚</p>
                    </div>
                    
                    <div class="api-section">
                        <h4>ğŸ”§ åŸºç¡€ä¿¡æ¯</h4>
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/health</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/health')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/health</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/modules</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/modules')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–æ‰€æœ‰æ¨¡å—åˆ—è¡¨</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/modules</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-section">
                        <h4>ğŸ“± Telegram æ¶ˆæ¯ç®¡ç†</h4>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/telegram/telegram/messages</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/telegram/telegram/messages')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–æ¶ˆæ¯å†å²</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/telegram/telegram/messages</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/telegram/telegram/polling/start</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/telegram/telegram/polling/start')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">å¼€å§‹æ¶ˆæ¯è½®è¯¢</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/telegram/telegram/polling/start</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/telegram/telegram/polling/stop</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/telegram/telegram/polling/stop')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">åœæ­¢æ¶ˆæ¯è½®è¯¢</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/telegram/telegram/polling/stop</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/telegram/telegram/send/message</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/telegram/telegram/send/message', {chat_id: '123456789', text: 'Hello World'})">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">å‘é€æ–‡æœ¬æ¶ˆæ¯</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/telegram/telegram/send/message \\
  -H "Content-Type: application/json" \\
  -d '{"chat_id": "123456789", "text": "Hello World"}'</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/telegram/telegram/send/photo</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/telegram/telegram/send/photo', {chat_id: '123456789', photo: 'https://example.com/image.jpg', caption: 'Photo caption'})">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">å‘é€å›¾ç‰‡æ¶ˆæ¯</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/telegram/telegram/send/photo \\
  -H "Content-Type: application/json" \\
  -d '{"chat_id": "123456789", "photo": "https://example.com/image.jpg", "caption": "Photo caption"}'</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-section">
                        <h4>ğŸ“ æ–‡ä»¶æ“ä½œ</h4>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/telegram/telegram/file-url/:fileId</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/telegram/telegram/file-url/BAADBAADrwADBREAAYag8mS4AAH0Ag')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–æ–‡ä»¶ç›´æ¥URL</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/telegram/telegram/file-url/BAADBAADrwADBREAAYag8mS4AAH0Ag</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/telegram/telegram/file/:fileId</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/telegram/telegram/file/BAADBAADrwADBREAAYag8mS4AAH0Ag')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–æ–‡ä»¶ä¿¡æ¯</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/telegram/telegram/file/BAADBAADrwADBREAAYag8mS4AAH0Ag</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-section">
                        <h4>ğŸ”— Webhook ç®¡ç†</h4>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/telegram/telegram/webhook/set</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/telegram/telegram/webhook/set', {url: 'https://your-domain.com/webhook'})">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è®¾ç½®Webhook URL</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/telegram/telegram/webhook/set \\
  -H "Content-Type: application/json" \\
  -d '{"url": "https://your-domain.com/webhook"}'</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method delete">DELETE</span>
                                <span class="url">/api/telegram/telegram/webhook</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('DELETE', '/api/telegram/telegram/webhook')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">åˆ é™¤Webhook</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X DELETE http://localhost:3000/api/telegram/telegram/webhook</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/telegram/telegram/webhook</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/telegram/telegram/webhook')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–Webhookä¿¡æ¯</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/telegram/telegram/webhook</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-section">
                        <h4>ğŸ  Home Assistant API</h4>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/home_assistant/home_assistant/states</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/home_assistant/home_assistant/states')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–æ‰€æœ‰å®ä½“çŠ¶æ€</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/home_assistant/home_assistant/states</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/home_assistant/home_assistant/config</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/home_assistant/home_assistant/config')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–Home Assistanté…ç½®ä¿¡æ¯</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/home_assistant/home_assistant/config</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/home_assistant/home_assistant/test-connection</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/home_assistant/home_assistant/test-connection')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">æµ‹è¯•Home Assistantè¿æ¥</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/home_assistant/home_assistant/test-connection</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/home_assistant/home_assistant/entities</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/home_assistant/home_assistant/entities')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–æ‰€æœ‰å®ä½“åˆ—è¡¨</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/home_assistant/home_assistant/entities</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method get">GET</span>
                                <span class="url">/api/home_assistant/home_assistant/entity/:entityId</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('GET', '/api/home_assistant/home_assistant/entity/light.living_room')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è·å–ç‰¹å®šå®ä½“ä¿¡æ¯</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X GET http://localhost:3000/api/home_assistant/home_assistant/entity/light.living_room</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/home_assistant/home_assistant/call-service</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/home_assistant/home_assistant/call-service', {domain: 'light', service: 'turn_on', entity_id: 'light.living_room'})">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è°ƒç”¨Home AssistantæœåŠ¡</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/home_assistant/home_assistant/call-service \\
  -H "Content-Type: application/json" \\
  -d '{"domain": "light", "service": "turn_on", "entity_id": "light.living_room"}'</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/home_assistant/home_assistant/entity/:entityId/turn_on</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/home_assistant/home_assistant/entity/light.living_room/turn_on')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">æ‰“å¼€å®ä½“</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/home_assistant/home_assistant/entity/light.living_room/turn_on</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/home_assistant/home_assistant/entity/:entityId/turn_off</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/home_assistant/home_assistant/entity/light.living_room/turn_off')">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">å…³é—­å®ä½“</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/home_assistant/home_assistant/entity/light.living_room/turn_off</code></pre>
                            </div>
                        </div>
                        
                        <div class="api-endpoint">
                            <div class="endpoint-header">
                                <span class="method post">POST</span>
                                <span class="url">/api/home_assistant/home_assistant/entity/:entityId/set_state</span>
                                <button class="btn btn-sm btn-primary" onclick="testApi('POST', '/api/home_assistant/home_assistant/entity/light.living_room/set_state', {state: 'on', attributes: {brightness: 255}})"">æµ‹è¯•</button>
                            </div>
                            <div class="endpoint-description">è®¾ç½®å®ä½“çŠ¶æ€</div>
                            <div class="endpoint-example">
                                <pre><code>curl -X POST http://localhost:3000/api/home_assistant/home_assistant/entity/light.living_room/set_state \\
  -H "Content-Type: application/json" \\
  -d '{"state": "on", "attributes": {"brightness": 255}}'</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-section">
                        <h4>ğŸ§ª API æµ‹è¯•ç»“æœ</h4>
                        <div id="apiTestResults" class="api-test-results">
                            <p>ç‚¹å‡»ä¸Šæ–¹çš„"æµ‹è¯•"æŒ‰é’®æ¥æµ‹è¯•APIç«¯ç‚¹</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡å—ç®¡ç† -->
        <div class="modules-grid" id="modulesGrid">
            <!-- åŠ¨æ€ç”Ÿæˆæ¨¡å—å¡ç‰‡ -->
        </div>
    </div>

    <!-- Toasté€šçŸ¥ -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let apiKey = '';
        let modules = {};
        let isConnected = false;
        let telegramPollingStatus = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkConnection();
            loadModules();
            setInterval(refreshData, 30000); // æ¯30ç§’åˆ·æ–°æ•°æ®
            
            // å¦‚æœTelegramæ¨¡å—å¯ç”¨ï¼Œè®¾ç½®æ¶ˆæ¯è‡ªåŠ¨åˆ·æ–°
            setInterval(() => {
                if (modules.telegram && modules.telegram.data && modules.telegram.data.messaging && modules.telegram.data.messaging.isPolling) {
                    refreshMessages();
                }
            }, 5000); // æ¯5ç§’åˆ·æ–°æ¶ˆæ¯
        });

        // è®¾ç½®APIå¯†é’¥
        function setApiKey() {
            const keyInput = document.getElementById('apiKey');
            apiKey = keyInput.value.trim();
            
            if (!apiKey) {
                showToast('è¯·è¾“å…¥APIå¯†é’¥', 'error');
                return;
            }
            
            checkConnection();
        }

        // æ£€æŸ¥è¿æ¥çŠ¶æ€
        async function checkConnection() {
            try {
                const response = await fetch('/api/health', {
                    headers: apiKey ? { 'X-API-Key': apiKey } : {}
                });
                
                const data = await response.json();
                isConnected = response.ok;
                
                updateConnectionStatus(isConnected);
                
                if (isConnected) {
                    document.getElementById('statistics').classList.remove('hidden');
                    loadModules();
                    loadStatistics();
                } else {
                    document.getElementById('statistics').classList.add('hidden');
                    document.getElementById('telegramMessaging').classList.add('hidden');
                }
            } catch (error) {
                console.error('Connection check failed:', error);
                updateConnectionStatus(false);
            }
        }

        // æ›´æ–°è¿æ¥çŠ¶æ€æ˜¾ç¤º
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            const dot = statusEl.querySelector('.status-dot');
            const text = statusEl.querySelector('span:last-child');
            
            if (connected) {
                statusEl.className = 'connection-status status-connected';
                dot.className = 'status-dot status-enabled';
                text.textContent = 'å·²è¿æ¥';
            } else {
                statusEl.className = 'connection-status status-disconnected';
                dot.className = 'status-dot status-disabled';
                text.textContent = 'æœªè¿æ¥';
            }
        }

        // åŠ è½½æ¨¡å—åˆ—è¡¨
        async function loadModules() {
            if (!isConnected) return;
            
            try {
                const response = await fetch('/api/modules', {
                    headers: { 'X-API-Key': apiKey }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    modules = data.data;
                    renderModules();
                } else {
                    showToast('åŠ è½½æ¨¡å—å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('Failed to load modules:', error);
                showToast('åŠ è½½æ¨¡å—å¤±è´¥', 'error');
            }
        }

        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStatistics() {
            if (!isConnected) return;
            
            try {
                const response = await fetch('/api/statistics', {
                    headers: { 'X-API-Key': apiKey }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    renderStatistics(data.data);
                }
            } catch (error) {
                console.error('Failed to load statistics:', error);
            }
        }

        // æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯
        function renderStatistics(stats) {
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.totalModules}</div>
                    <div class="stat-label">æ€»æ¨¡å—æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.enabledModules}</div>
                    <div class="stat-label">å·²å¯ç”¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.initializedModules}</div>
                    <div class="stat-label">å·²åˆå§‹åŒ–</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.disabledModules}</div>
                    <div class="stat-label">å·²ç¦ç”¨</div>
                </div>
            `;
        }

        // æ¸²æŸ“æ¨¡å—å¡ç‰‡
        function renderModules() {
            const grid = document.getElementById('modulesGrid');
            grid.innerHTML = '';
            
            Object.entries(modules).forEach(([name, moduleData]) => {
                const data = moduleData.data || {};
                const card = createModuleCard(name, data);
                grid.appendChild(card);
            });
            
            // æ¸²æŸ“å®Œæˆåæ£€æŸ¥Telegramæ¨¡å—
            setTimeout(() => {
                checkTelegramModule();
            }, 100);
        }

        // åˆ›å»ºæ¨¡å—å¡ç‰‡
        function createModuleCard(name, data) {
            const card = document.createElement('div');
            card.className = 'module-card fade-in';
            card.id = `module-${name}`;
            
            const iconLetter = name.charAt(0).toUpperCase();
            const isEnabled = data.enabled || false;
            const isInitialized = data.initialized || false;
            
            card.innerHTML = `
                <div class="module-header">
                    <div class="module-title">
                        <div class="module-icon">${iconLetter}</div>
                        ${capitalizeFirst(name)}
                    </div>
                    <div class="module-status">
                        <div class="status-indicator">
                            <span class="status-dot ${isEnabled ? 'status-enabled' : 'status-disabled'}"></span>
                            <span>${isEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}</span>
                        </div>
                        <div class="status-indicator">
                            <span>åˆå§‹åŒ–: ${isInitialized ? 'âœ“' : 'âœ—'}</span>
                        </div>
                    </div>
                </div>
                <div class="module-content">
                    <div id="credentials-${name}">
                        <!-- å‡­æ®è¡¨å•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="module-actions">
                        <button class="btn ${isEnabled ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleModule('${name}', ${!isEnabled})">
                            ${isEnabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
                        </button>
                        <button class="btn btn-primary" onclick="validateModule('${name}')">éªŒè¯</button>
                        <button class="btn btn-primary" onclick="testConnection('${name}')">æµ‹è¯•è¿æ¥</button>
                        <button class="btn btn-warning" onclick="reloadModule('${name}')">é‡è½½</button>
                        <button class="btn btn-danger" onclick="clearCache('${name}')">æ¸…é™¤ç¼“å­˜</button>
                        ${name === 'telegram' ? '<button class="btn btn-success" onclick="showTelegramMessaging()">æ¶ˆæ¯ç®¡ç†</button>' : ''}
                    </div>
                    <div id="result-${name}"></div>
                </div>
            `;
            
            // åŠ è½½å‡­æ®è¡¨å•
            loadCredentialForm(name);
            
            return card;
        }

        // åŠ è½½å‡­æ®è¡¨å•
        async function loadCredentialForm(moduleName) {
            try {
                // è·å–schema
                const schemaResponse = await fetch(`/api/schema/${moduleName}`, {
                    headers: { 'X-API-Key': apiKey }
                });
                
                if (!schemaResponse.ok) return;
                
                const schemaData = await schemaResponse.json();
                const schema = schemaData.data;
                
                // è·å–ç°æœ‰å‡­æ®
                const credsResponse = await fetch(`/api/credentials/${moduleName}`, {
                    headers: { 'X-API-Key': apiKey }
                });
                
                const existingCreds = credsResponse.ok ? (await credsResponse.json()).data : {};
                
                // ç”Ÿæˆè¡¨å•
                const formContainer = document.getElementById(`credentials-${moduleName}`);
                formContainer.innerHTML = generateCredentialForm(moduleName, schema, existingCreds);
                
            } catch (error) {
                console.error(`Failed to load credential form for ${moduleName}:`, error);
            }
        }

        // ç”Ÿæˆå‡­æ®è¡¨å•
        function generateCredentialForm(moduleName, schema, existingCreds) {
            if (!schema.properties) return '<p>æ— å‡­æ®é…ç½®</p>';
            
            let formHTML = '';
            
            Object.entries(schema.properties).forEach(([field, definition]) => {
                const value = existingCreds[field] || '';
                const inputType = definition.sensitive ? 'password' : 
                                 definition.ui?.widget === 'url' ? 'url' : 'text';
                const placeholder = definition.ui?.placeholder || definition.example || '';
                const help = definition.ui?.help || definition.description || '';
                
                formHTML += `
                    <div class="form-group">
                        <label for="${moduleName}-${field}">
                            ${definition.title || capitalizeFirst(field)}
                            ${definition.required ? '*' : ''}
                        </label>
                        <input type="${inputType}" 
                               id="${moduleName}-${field}" 
                               name="${field}"
                               value="${value}" 
                               placeholder="${placeholder}"
                               ${definition.required ? 'required' : ''}
                               title="${help}">
                        ${help ? `<small style="color: var(--gray-500); font-size: 0.8rem;">${help}</small>` : ''}
                    </div>
                `;
            });
            
            formHTML += `
                <button type="button" class="btn btn-primary" onclick="saveCredentials('${moduleName}')">
                    ä¿å­˜å‡­æ®
                </button>
            `;
            
            return formHTML;
        }

        // ä¿å­˜å‡­æ®
        async function saveCredentials(moduleName) {
            const formContainer = document.getElementById(`credentials-${moduleName}`);
            const inputs = formContainer.querySelectorAll('input[name]');
            const credentials = {};
            
            inputs.forEach(input => {
                credentials[input.name] = input.value;
            });
            
            try {
                const response = await fetch(`/api/credentials/${moduleName}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify(credentials)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`${capitalizeFirst(moduleName)} å‡­æ®å·²ä¿å­˜`, 'success');
                } else {
                    showToast(`ä¿å­˜å¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to save credentials:', error);
                showToast('ä¿å­˜å¤±è´¥', 'error');
            }
        }

        // åˆ‡æ¢æ¨¡å—çŠ¶æ€
        async function toggleModule(moduleName, enabled) {
            try {
                const response = await fetch(`/api/modules/${moduleName}/enabled`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    },
                    body: JSON.stringify({ enabled })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`${capitalizeFirst(moduleName)} å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                    loadModules(); // åˆ·æ–°æ¨¡å—çŠ¶æ€
                } else {
                    showToast(`æ“ä½œå¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to toggle module:', error);
                showToast('æ“ä½œå¤±è´¥', 'error');
            }
        }

        // éªŒè¯æ¨¡å—
        async function validateModule(moduleName) {
            const resultContainer = document.getElementById(`result-${moduleName}`);
            resultContainer.innerHTML = '<div class="loading"><div class="spinner"></div>éªŒè¯ä¸­...</div>';
            
            try {
                const response = await fetch(`/api/validate/${moduleName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    }
                });
                
                const data = await response.json();
                displayValidationResult(moduleName, data);
                
            } catch (error) {
                console.error('Validation failed:', error);
                displayValidationResult(moduleName, { success: false, error: 'éªŒè¯å¤±è´¥' });
            }
        }

        // æµ‹è¯•è¿æ¥
        async function testConnection(moduleName) {
            const resultContainer = document.getElementById(`result-${moduleName}`);
            resultContainer.innerHTML = '<div class="loading"><div class="spinner"></div>æµ‹è¯•è¿æ¥ä¸­...</div>';
            
            try {
                const response = await fetch(`/api/test-connection/${moduleName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiKey
                    }
                });
                
                const data = await response.json();
                displayValidationResult(moduleName, data);
                
            } catch (error) {
                console.error('Connection test failed:', error);
                displayValidationResult(moduleName, { success: false, error: 'è¿æ¥æµ‹è¯•å¤±è´¥' });
            }
        }

        // é‡è½½æ¨¡å—
        async function reloadModule(moduleName) {
            try {
                const response = await fetch(`/api/modules/${moduleName}/reload`, {
                    method: 'POST',
                    headers: { 'X-API-Key': apiKey }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`${capitalizeFirst(moduleName)} æ¨¡å—å·²é‡è½½`, 'success');
                    loadModules();
                } else {
                    showToast(`é‡è½½å¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to reload module:', error);
                showToast('é‡è½½å¤±è´¥', 'error');
            }
        }

        // æ¸…é™¤ç¼“å­˜
        async function clearCache(moduleName) {
            try {
                const response = await fetch(`/api/cache/${moduleName}`, {
                    method: 'DELETE',
                    headers: { 'X-API-Key': apiKey }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`${capitalizeFirst(moduleName)} ç¼“å­˜å·²æ¸…é™¤`, 'success');
                } else {
                    showToast(`æ¸…é™¤å¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to clear cache:', error);
                showToast('æ¸…é™¤å¤±è´¥', 'error');
            }
        }

        // æ˜¾ç¤ºéªŒè¯ç»“æœ
        function displayValidationResult(moduleName, result) {
            const resultContainer = document.getElementById(`result-${moduleName}`);
            const isSuccess = result.success;
            const className = isSuccess ? 'validation-success' : 'validation-error';
            
            let content = `
                <div class="validation-result ${className}">
                    <strong>${isSuccess ? 'âœ“ éªŒè¯æˆåŠŸ' : 'âœ— éªŒè¯å¤±è´¥'}</strong>
                    <div>${result.message || result.error || ''}</div>
            `;
            
            // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            if (result.data && Object.keys(result.data).length > 0) {
                content += `
                    <div class="collapsible-details">
                        <button class="collapsible-toggle" onclick="toggleDetails('${moduleName}')">
                            æ˜¾ç¤ºè¯¦æƒ…
                        </button>
                        <div class="collapsible-content hidden" id="details-${moduleName}">
                            <pre>${JSON.stringify(result.data, null, 2)}</pre>
                        </div>
                    </div>
                `;
            }
            
            content += '</div>';
            resultContainer.innerHTML = content;
        }

        // åˆ‡æ¢è¯¦æƒ…æ˜¾ç¤º
        function toggleDetails(moduleName) {
            const details = document.getElementById(`details-${moduleName}`);
            const toggle = details.previousElementSibling;
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                toggle.textContent = 'éšè—è¯¦æƒ…';
            } else {
                details.classList.add('hidden');
                toggle.textContent = 'æ˜¾ç¤ºè¯¦æƒ…';
            }
        }

        // æ˜¾ç¤ºToasté€šçŸ¥
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            
            toast.className = `toast toast-${type}`;
            messageEl.textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            if (isConnected) {
                loadModules();
                loadStatistics();
            }
        }

        // é¦–å­—æ¯å¤§å†™
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // =================
        // Telegram Messaging Functions
        // =================

        // æ‰‹åŠ¨æ˜¾ç¤ºTelegramæ¶ˆæ¯ç®¡ç†ç•Œé¢
        function showTelegramMessaging() {
            console.log('Manually showing Telegram messaging interface');
            
            // å¼ºåˆ¶æ˜¾ç¤ºæ¶ˆæ¯ç®¡ç†ç•Œé¢
            document.getElementById('telegramMessaging').classList.remove('hidden');
            
            // æ»šåŠ¨åˆ°æ¶ˆæ¯ç®¡ç†ç•Œé¢
            document.getElementById('telegramMessaging').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            // æ›´æ–°çŠ¶æ€å’Œæ¶ˆæ¯
            setTimeout(() => {
                updatePollingStatus();
                refreshMessages();
            }, 300);
            
            showToast('Telegramæ¶ˆæ¯ç®¡ç†ç•Œé¢å·²æ˜¾ç¤º', 'success');
        }

        // æ£€æŸ¥Telegramæ¨¡å—æ˜¯å¦å¯ç”¨
        function checkTelegramModule() {
            console.log('Checking Telegram module...', modules.telegram);
            
            // åªè¦Telegramæ¨¡å—å­˜åœ¨ä¸”å·²åˆå§‹åŒ–å°±æ˜¾ç¤ºç•Œé¢
            if (modules.telegram && modules.telegram.data && modules.telegram.data.initialized) {
                console.log('Telegram module found and initialized, showing messaging interface');
                document.getElementById('telegramMessaging').classList.remove('hidden');
                
                // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿DOMå·²æ›´æ–°
                setTimeout(() => {
                    updatePollingStatus();
                    refreshMessages();
                }, 200);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰å‡­æ®
                const hasCredentials = modules.telegram.data.hasCredentials && 
                                      Object.keys(modules.telegram.data.hasCredentials).length > 0;
                
                if (hasCredentials || modules.telegram.data.enabled) {
                    console.log('Telegram module is ready for messaging');
                } else {
                    console.log('Telegram module found but may need credentials or enabling');
                }
            } else {
                console.log('Telegram module not available or not initialized:', {
                    exists: !!modules.telegram,
                    hasData: !!(modules.telegram && modules.telegram.data),
                    initialized: !!(modules.telegram && modules.telegram.data && modules.telegram.data.initialized)
                });
                document.getElementById('telegramMessaging').classList.add('hidden');
            }
        }

        // æ›´æ–°è½®è¯¢çŠ¶æ€æ˜¾ç¤º
        function updatePollingStatus() {
            const header = document.querySelector('.messaging-header h2');
            if (!header) {
                console.log('Messaging header not found, skipping polling status update');
                return;
            }
            
            const existingStatus = header.querySelector('.polling-status');
            
            if (existingStatus) {
                existingStatus.remove();
            }
            
            // ä»æ¨¡å—æ•°æ®è·å–å®é™…è½®è¯¢çŠ¶æ€
            const actualPollingStatus = modules.telegram && 
                                       modules.telegram.data && 
                                       modules.telegram.data.messaging && 
                                       modules.telegram.data.messaging.isPolling;
            
            console.log('Updating polling status:', actualPollingStatus);
            
            const statusEl = document.createElement('div');
            statusEl.className = `polling-status ${actualPollingStatus ? 'polling-active' : 'polling-inactive'}`;
            statusEl.innerHTML = `
                <span class="status-dot ${actualPollingStatus ? 'status-enabled' : 'status-disabled'}"></span>
                <span>è½®è¯¢: ${actualPollingStatus ? 'æ´»è·ƒ' : 'åœæ­¢'}</span>
            `;
            
            header.appendChild(statusEl);
            
            // æ›´æ–°å…¨å±€çŠ¶æ€
            telegramPollingStatus = actualPollingStatus;
        }

        // å¼€å§‹Telegramè½®è¯¢
        async function startTelegramPolling() {
            try {
                const response = await fetch('/api/telegram/telegram/polling/start', {
                    method: 'POST',
                    headers: apiKey ? { 'X-API-Key': apiKey } : {}
                });
                
                const data = await response.json();
                
                if (data.success) {
                    telegramPollingStatus = true;
                    showToast('Telegramè½®è¯¢å·²å¼€å§‹', 'success');
                    // åˆ·æ–°æ¨¡å—çŠ¶æ€ä»¥è·å–æœ€æ–°è½®è¯¢çŠ¶æ€
                    loadModules();
                    setTimeout(() => {
                        updatePollingStatus();
                        refreshMessages();
                    }, 500);
                } else {
                    showToast(`å¯åŠ¨è½®è¯¢å¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to start polling:', error);
                showToast('å¯åŠ¨è½®è¯¢å¤±è´¥', 'error');
            }
        }

        // åœæ­¢Telegramè½®è¯¢
        async function stopTelegramPolling() {
            try {
                const response = await fetch('/api/telegram/telegram/polling/stop', {
                    method: 'POST',
                    headers: apiKey ? { 'X-API-Key': apiKey } : {}
                });
                
                const data = await response.json();
                
                if (data.success) {
                    telegramPollingStatus = false;
                    showToast('Telegramè½®è¯¢å·²åœæ­¢', 'success');
                    // åˆ·æ–°æ¨¡å—çŠ¶æ€ä»¥è·å–æœ€æ–°è½®è¯¢çŠ¶æ€
                    loadModules();
                    setTimeout(() => {
                        updatePollingStatus();
                    }, 500);
                } else {
                    showToast(`åœæ­¢è½®è¯¢å¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to stop polling:', error);
                showToast('åœæ­¢è½®è¯¢å¤±è´¥', 'error');
            }
        }

        // åˆ·æ–°æ¶ˆæ¯åˆ—è¡¨
        async function refreshMessages() {
            try {
                const response = await fetch('/api/telegram/telegram/messages?limit=50', {
                    headers: apiKey ? { 'X-API-Key': apiKey } : {}
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Messages loaded:', data.data);
                    renderMessages(data.data.messages || []);
                } else {
                    console.error('Failed to load messages, status:', response.status);
                    // å¦‚æœæ²¡æœ‰APIå¯†é’¥ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    if (response.status === 401) {
                        renderMessages([], 'è¯·å…ˆé…ç½®APIå¯†é’¥');
                    }
                }
            } catch (error) {
                console.error('Failed to refresh messages:', error);
                renderMessages([], 'åŠ è½½æ¶ˆæ¯å¤±è´¥');
            }
        }

        // æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨
        function renderMessages(messages, errorMsg = null) {
            const messagesList = document.getElementById('messagesList');
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateMessageStats(messages, errorMsg);
            
            if (errorMsg) {
                messagesList.innerHTML = `<p style="text-align: center; color: var(--danger-color); padding: 2rem;">${errorMsg}</p>`;
                return;
            }
            
            if (messages.length === 0) {
                messagesList.innerHTML = '<p style="text-align: center; color: var(--gray-500); padding: 2rem;">æš‚æ— æ¶ˆæ¯ - è¯·å…ˆå¯åŠ¨è½®è¯¢ä»¥æ¥æ”¶æ¶ˆæ¯</p>';
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—æ¶ˆæ¯
            const sortedMessages = messages.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            messagesList.innerHTML = sortedMessages.map(message => `
                <div class="message-item">
                    <div class="message-header">
                        <div class="message-from">
                            ${message.from?.username ? `@${message.from.username}` : message.from?.first_name || 'Unknown'}
                            ${message.chat_type && message.chat_type !== 'private' ? ` (${message.chat_type})` : ''}
                        </div>
                        <div class="message-actions">
                            <button class="btn btn-sm btn-primary" onclick="replyToMessage('${message.chat_id}', '${message.from?.username ? `@${message.from.username}` : message.from?.first_name || 'Unknown'}')">
                                å›å¤
                            </button>
                            <div class="message-time">
                                ${new Date(message.date).toLocaleString()}
                            </div>
                        </div>
                    </div>
                    <div class="message-content">
                        <span class="message-type">${message.message_type}</span>
                        ${message.text ? `<div class="message-text">${message.text}</div>` : ''}
                        ${message.caption ? `<div class="message-text"><em>${message.caption}</em></div>` : ''}
                        ${message.media ? `
                            <div class="message-media">
                                ${Object.keys(message.media).map(type => {
                                    const mediaData = message.media[type];
                                    const fileId = mediaData.file_id || mediaData[0]?.file_id;
                                    if (!fileId) return '';
                                    
                                    switch(type) {
                                        case 'photo':
                                            // è·å–æœ€é«˜è´¨é‡çš„å›¾ç‰‡
                                            const photos = Array.isArray(mediaData) ? mediaData : [mediaData];
                                            const bestPhoto = photos.reduce((best, current) => {
                                                const bestSize = (best.width || 0) * (best.height || 0);
                                                const currentSize = (current.width || 0) * (current.height || 0);
                                                return currentSize > bestSize ? current : best;
                                            });
                                            
                                            return `<div class="media-item">
                                                <img src="/api/telegram/telegram/file-url/${bestPhoto.file_id}" 
                                                     alt="å›¾ç‰‡" 
                                                     class="media-image"
                                                     onclick="openMediaModal('/api/telegram/telegram/file-url/${bestPhoto.file_id}', 'image', ${JSON.stringify(photos).replace(/"/g, '&quot;')})"
                                                     loading="lazy"
                                                     data-photos='${JSON.stringify(photos).replace(/"/g, '&quot;')}'>
                                                <div class="media-info">
                                                    ğŸ“· å›¾ç‰‡ ${bestPhoto.width ? `${bestPhoto.width}Ã—${bestPhoto.height}` : ''}
                                                    ${photos.length > 1 ? ` (${photos.length}ä¸ªå°ºå¯¸)` : ''}
                                                </div>
                                            </div>`;
                                        case 'video':
                                            return `<div class="media-item">
                                                <video controls class="media-video" preload="metadata">
                                                    <source src="/api/telegram/telegram/file-url/${fileId}" type="video/mp4">
                                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                                                </video>
                                                <div class="media-info">ğŸ¥ è§†é¢‘</div>
                                            </div>`;
                                        case 'voice':
                                            return `<div class="media-item">
                                                <audio controls class="media-audio">
                                                    <source src="/api/telegram/telegram/file-url/${fileId}" type="audio/ogg">
                                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                                                </audio>
                                                <div class="media-info">ğŸµ è¯­éŸ³æ¶ˆæ¯</div>
                                            </div>`;
                                        case 'document':
                                            return `<div class="media-item">
                                                <div class="media-document" onclick="downloadFile('${fileId}')">
                                                    ğŸ“„ æ–‡æ¡£æ–‡ä»¶
                                                </div>
                                                <div class="media-info">ç‚¹å‡»ä¸‹è½½</div>
                                            </div>`;
                                        default:
                                            return `<div class="media-item">
                                                <div class="media-info">${type}: ${fileId}</div>
                                            </div>`;
                                    }
                                }).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // å›å¤æ¶ˆæ¯
        function replyToMessage(chatId, fromName) {
            // è‡ªåŠ¨å¡«å……èŠå¤©ID
            document.getElementById('sendChatId').value = chatId;
            
            // åˆ‡æ¢åˆ°å‘é€æ¶ˆæ¯æ ‡ç­¾é¡µ
            switchTab('send');
            
            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            showToast(`å·²é€‰æ‹©å›å¤ç»™: ${fromName} (${chatId})`, 'success');
            
            // æ»šåŠ¨åˆ°å‘é€è¡¨å•
            document.getElementById('tab-send').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        // æ‰“å¼€åª’ä½“æ¨¡æ€æ¡†
        function openMediaModal(src, type, photos = null) {
            if (type === 'image') {
                // åˆ›å»ºå›¾ç‰‡æ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'media-modal';
                
                let photoSelector = '';
                if (photos && photos.length > 1) {
                    photoSelector = `
                        <div class="photo-selector">
                            <label>é€‰æ‹©å°ºå¯¸:</label>
                            <select id="photoSizeSelect" onchange="changePhotoSize(this.value)">
                                ${photos.map((photo, index) => `
                                    <option value="${photo.file_id}" ${photo.file_id === src.split('/').pop() ? 'selected' : ''}>
                                        ${photo.width}Ã—${photo.height} ${photo.file_size ? `(${Math.round(photo.file_size/1024)}KB)` : ''}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                    `;
                }
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <span class="modal-close" onclick="closeMediaModal()">&times;</span>
                        ${photoSelector}
                        <img src="${src}" alt="å›¾ç‰‡" class="modal-image" id="modalImage">
                        <div class="image-info" id="imageInfo"></div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // æ›´æ–°å›¾ç‰‡ä¿¡æ¯
                updateImageInfo(src, photos);
                
                // ç‚¹å‡»èƒŒæ™¯å…³é—­
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        closeMediaModal();
                    }
                };
            }
        }

        // åˆ‡æ¢å›¾ç‰‡å°ºå¯¸
        function changePhotoSize(fileId) {
            const modalImage = document.getElementById('modalImage');
            const newSrc = `/api/telegram/telegram/file-url/${fileId}`;
            modalImage.src = newSrc;
            
            // æ›´æ–°å›¾ç‰‡ä¿¡æ¯
            const select = document.getElementById('photoSizeSelect');
            const selectedOption = select.options[select.selectedIndex];
            const dimensions = selectedOption.text.split(' ')[0];
            document.getElementById('imageInfo').textContent = `å°ºå¯¸: ${dimensions}`;
        }

        // æ›´æ–°å›¾ç‰‡ä¿¡æ¯
        function updateImageInfo(src, photos) {
            if (photos && photos.length > 0) {
                const currentFileId = src.split('/').pop();
                const currentPhoto = photos.find(p => p.file_id === currentFileId);
                if (currentPhoto) {
                    const info = `å°ºå¯¸: ${currentPhoto.width}Ã—${currentPhoto.height}`;
                    if (currentPhoto.file_size) {
                        info += ` | å¤§å°: ${Math.round(currentPhoto.file_size/1024)}KB`;
                    }
                    document.getElementById('imageInfo').textContent = info;
                }
            }
        }

        // å…³é—­åª’ä½“æ¨¡æ€æ¡†
        function closeMediaModal() {
            const modal = document.querySelector('.media-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ä¸‹è½½æ–‡ä»¶
        async function downloadFile(fileId) {
            try {
                showToast('æ­£åœ¨è·å–æ–‡ä»¶...', 'info');
                
                const response = await fetch(`/api/telegram/telegram/file-url/${fileId}`, {
                    headers: { 'X-API-Key': apiKey }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.href = result.data.file_url;
                    link.download = `telegram_file_${fileId}`;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showToast('æ–‡ä»¶ä¸‹è½½å·²å¼€å§‹', 'success');
                } else {
                    showToast(`ä¸‹è½½å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Download error:', error);
                showToast('ä¸‹è½½å¤±è´¥: ç½‘ç»œé”™è¯¯', 'error');
            }
        }

        // æµ‹è¯•APIç«¯ç‚¹
        async function testApi(method, url, data = null) {
            const resultsContainer = document.getElementById('apiTestResults');
            const timestamp = new Date().toLocaleTimeString();
            
            // æ˜¾ç¤ºæµ‹è¯•å¼€å§‹ä¿¡æ¯
            const testId = `test-${Date.now()}`;
            resultsContainer.innerHTML = `
                <div class="test-result info" id="${testId}">
                    <strong>ğŸ§ª æµ‹è¯• ${method} ${url}</strong>
                    <div>æ—¶é—´: ${timestamp}</div>
                    <div>çŠ¶æ€: æ­£åœ¨æµ‹è¯•...</div>
                </div>
            `;
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                // æ·»åŠ APIå¯†é’¥ï¼ˆå¦‚æœæœ‰ï¼‰
                if (apiKey) {
                    options.headers['X-API-Key'] = apiKey;
                }
                
                // æ·»åŠ è¯·æ±‚ä½“ï¼ˆå¦‚æœæ˜¯POST/PUTè¯·æ±‚ï¼‰
                if (data && (method === 'POST' || method === 'PUT')) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(url, options);
                const responseData = await response.text();
                
                let parsedData;
                try {
                    parsedData = JSON.parse(responseData);
                } catch (e) {
                    parsedData = responseData;
                }
                
                const resultClass = response.ok ? 'success' : 'error';
                const statusText = response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
                
                document.getElementById(testId).innerHTML = `
                    <strong>ğŸ§ª æµ‹è¯• ${method} ${url}</strong>
                    <div>æ—¶é—´: ${timestamp}</div>
                    <div>çŠ¶æ€: ${statusText} (HTTP ${response.status})</div>
                    <div>å“åº”æ—¶é—´: ${Date.now() - parseInt(testId.split('-')[1])}ms</div>
                    <pre>${JSON.stringify(parsedData, null, 2)}</pre>
                `;
                document.getElementById(testId).className = `test-result ${resultClass}`;
                
            } catch (error) {
                document.getElementById(testId).innerHTML = `
                    <strong>ğŸ§ª æµ‹è¯• ${method} ${url}</strong>
                    <div>æ—¶é—´: ${timestamp}</div>
                    <div>çŠ¶æ€: âŒ ç½‘ç»œé”™è¯¯</div>
                    <div>é”™è¯¯: ${error.message}</div>
                `;
                document.getElementById(testId).className = 'test-result error';
            }
        }

        // æ›´æ–°æ¶ˆæ¯ç»Ÿè®¡ä¿¡æ¯
        function updateMessageStats(messages, errorMsg = null) {
            const totalMessagesEl = document.getElementById('totalMessages');
            const lastUpdateEl = document.getElementById('lastUpdate');
            
            if (errorMsg) {
                totalMessagesEl.textContent = '-';
                lastUpdateEl.textContent = 'é”™è¯¯';
                return;
            }
            
            totalMessagesEl.textContent = messages.length;
            
            if (messages.length > 0) {
                const latestMessage = messages.reduce((latest, current) => 
                    new Date(current.date) > new Date(latest.date) ? current : latest
                );
                lastUpdateEl.textContent = new Date(latestMessage.date).toLocaleTimeString();
            } else {
                lastUpdateEl.textContent = '-';
            }
        }

        // æ¸…é™¤æ¶ˆæ¯å†å²
        async function clearMessages() {
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯å†å²å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch('/api/telegram/telegram/messages', {
                    method: 'DELETE',
                    headers: { 'X-API-Key': apiKey }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('æ¶ˆæ¯å†å²å·²æ¸…é™¤', 'success');
                    refreshMessages();
                } else {
                    showToast(`æ¸…é™¤å¤±è´¥: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Failed to clear messages:', error);
                showToast('æ¸…é™¤å¤±è´¥', 'error');
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾æŒ‰é’®
            event.target.classList.add('active');
        }

        // æ›´æ–°å‘é€è¡¨å•
        function updateSendForm() {
            const messageType = document.getElementById('sendMessageType').value;
            const textGroup = document.getElementById('textMessageGroup');
            const mediaGroup = document.getElementById('mediaMessageGroup');
            
            if (messageType === 'text') {
                textGroup.classList.remove('hidden');
                mediaGroup.classList.add('hidden');
            } else {
                textGroup.classList.add('hidden');
                mediaGroup.classList.remove('hidden');
            }
        }

        // å‘é€Telegramæ¶ˆæ¯
        async function sendTelegramMessage() {
            const chatId = document.getElementById('sendChatId').value.trim();
            const messageType = document.getElementById('sendMessageType').value;
            const text = document.getElementById('sendText').value.trim();
            const media = document.getElementById('sendMedia').value.trim();
            const caption = document.getElementById('sendCaption').value.trim();
            
            if (!chatId) {
                showToast('è¯·è¾“å…¥èŠå¤©ID', 'error');
                return;
            }
            
            if (messageType === 'text' && !text) {
                showToast('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹', 'error');
                return;
            }
            
            if (messageType !== 'text' && !media) {
                showToast('è¯·è¾“å…¥åª’ä½“æ–‡ä»¶IDæˆ–URL', 'error');
                return;
            }
            
            // æ˜¾ç¤ºå‘é€çŠ¶æ€
            const sendButton = event.target;
            const originalText = sendButton.textContent;
            sendButton.textContent = 'å‘é€ä¸­...';
            sendButton.disabled = true;
            
            try {
                let endpoint = '';
                let payload = {
                    chat_id: chatId,
                    options: {}
                };
                
                if (caption) {
                    payload.options.caption = caption;
                }
                
                switch (messageType) {
                    case 'text':
                        endpoint = '/api/telegram/telegram/send/message';
                        payload.text = text;
                        break;
                    case 'photo':
                        endpoint = '/api/telegram/telegram/send/photo';
                        payload.photo = media;
                        break;
                    case 'video':
                        endpoint = '/api/telegram/telegram/send/video';
                        payload.video = media;
                        break;
                    case 'voice':
                        endpoint = '/api/telegram/telegram/send/voice';
                        payload.voice = media;
                        break;
                    case 'document':
                        endpoint = '/api/telegram/telegram/send/document';
                        payload.document = media;
                        break;
                }
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(apiKey ? { 'X-API-Key': apiKey } : {})
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('æ¶ˆæ¯å‘é€æˆåŠŸ', 'success');
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('sendChatId').value = '';
                    document.getElementById('sendText').value = '';
                    document.getElementById('sendMedia').value = '';
                    document.getElementById('sendCaption').value = '';
                } else {
                    showToast(`å‘é€å¤±è´¥: ${data.error}`, 'error');
                    console.error('Send message error:', data);
                }
            } catch (error) {
                console.error('Failed to send message:', error);
                showToast('å‘é€å¤±è´¥: ç½‘ç»œé”™è¯¯', 'error');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                sendButton.textContent = originalText;
                sendButton.disabled = false;
            }
        }

        // è®¾ç½®Webhook
        async function setWebhook() {
            const webhookUrl = document.getElementById('webhookUrl').value.trim();
            const webhookSecret = document.getElementById('webhookSecret').value.trim();
            
            if (!webhookUrl) {
                showToast('è¯·è¾“å…¥Webhook URL', 'error');
                return;
            }
            
            // éªŒè¯URLæ ¼å¼
            try {
                new URL(webhookUrl);
            } catch (e) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„URL', 'error');
                return;
            }
            
            const setButton = event.target;
            const originalText = setButton.textContent;
            setButton.textContent = 'è®¾ç½®ä¸­...';
            setButton.disabled = true;
            
            try {
                const payload = {
                    webhook_url: webhookUrl,
                    options: {}
                };
                
                if (webhookSecret) {
                    payload.options.secret_token = webhookSecret;
                }
                
                const response = await fetch('/api/telegram/telegram/webhook/set', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(apiKey ? { 'X-API-Key': apiKey } : {})
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                displayWebhookStatus(data, data.success ? 'success' : 'error');
                
                if (data.success) {
                    showToast('Webhookè®¾ç½®æˆåŠŸ', 'success');
                }
            } catch (error) {
                console.error('Failed to set webhook:', error);
                displayWebhookStatus({ success: false, error: 'è®¾ç½®å¤±è´¥: ç½‘ç»œé”™è¯¯' }, 'error');
            } finally {
                setButton.textContent = originalText;
                setButton.disabled = false;
            }
        }

        // ç§»é™¤Webhook
        async function removeWebhook() {
            if (!confirm('ç¡®å®šè¦ç§»é™¤å½“å‰çš„Webhookè®¾ç½®å—ï¼Ÿ')) {
                return;
            }
            
            const removeButton = event.target;
            const originalText = removeButton.textContent;
            removeButton.textContent = 'ç§»é™¤ä¸­...';
            removeButton.disabled = true;
            
            try {
                const response = await fetch('/api/telegram/telegram/webhook', {
                    method: 'DELETE',
                    headers: apiKey ? { 'X-API-Key': apiKey } : {}
                });
                
                const data = await response.json();
                displayWebhookStatus(data, data.success ? 'success' : 'error');
                
                if (data.success) {
                    showToast('Webhookå·²ç§»é™¤', 'success');
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('webhookUrl').value = '';
                    document.getElementById('webhookSecret').value = '';
                }
            } catch (error) {
                console.error('Failed to remove webhook:', error);
                displayWebhookStatus({ success: false, error: 'ç§»é™¤å¤±è´¥: ç½‘ç»œé”™è¯¯' }, 'error');
            } finally {
                removeButton.textContent = originalText;
                removeButton.disabled = false;
            }
        }

        // è·å–Webhookä¿¡æ¯
        async function getWebhookInfo() {
            const infoButton = event.target;
            const originalText = infoButton.textContent;
            infoButton.textContent = 'è·å–ä¸­...';
            infoButton.disabled = true;
            
            try {
                const response = await fetch('/api/telegram/telegram/webhook', {
                    headers: apiKey ? { 'X-API-Key': apiKey } : {}
                });
                
                const data = await response.json();
                displayWebhookStatus(data, 'info');
                
                if (data.success && data.data) {
                    // å¦‚æœwebhookå·²è®¾ç½®ï¼Œå¡«å……è¡¨å•
                    if (data.data.url) {
                        document.getElementById('webhookUrl').value = data.data.url;
                    }
                }
            } catch (error) {
                console.error('Failed to get webhook info:', error);
                displayWebhookStatus({ success: false, error: 'è·å–ä¿¡æ¯å¤±è´¥: ç½‘ç»œé”™è¯¯' }, 'error');
            } finally {
                infoButton.textContent = originalText;
                infoButton.disabled = false;
            }
        }

        // æ˜¾ç¤ºWebhookçŠ¶æ€
        function displayWebhookStatus(data, type) {
            const statusEl = document.getElementById('webhookStatus');
            const className = `webhook-status ${type}`;
            
            let content = '';
            if (data.success) {
                content = `<strong>âœ“ ${data.message || 'æ“ä½œæˆåŠŸ'}</strong>`;
                if (data.data) {
                    content += `<pre style="margin-top: 0.5rem; font-size: 0.8rem;">${JSON.stringify(data.data, null, 2)}</pre>`;
                }
            } else {
                content = `<strong>âœ— ${data.error || 'æ“ä½œå¤±è´¥'}</strong>`;
            }
            
            statusEl.innerHTML = `<div class="${className}">${content}</div>`;
        }

        // =================
        // APIæ–‡æ¡£ç®¡ç†å‡½æ•°
        // =================

        // æ˜¾ç¤ºAPIæ–‡æ¡£
        function showApiDocumentation() {
            document.getElementById('apiDocumentation').classList.remove('hidden');
            document.getElementById('apiDocumentation').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            showToast('APIæ–‡æ¡£å·²æ˜¾ç¤º', 'success');
        }

        // æ˜¾ç¤ºæ‰€æœ‰APIæ–‡æ¡£
        function showAllApiDocs() {
            showApiDocumentation();
            switchApiTab('overview');
        }

        // æ˜¾ç¤ºTelegram APIæ–‡æ¡£
        function showTelegramApiDocs() {
            showApiDocumentation();
            switchApiTab('telegram');
        }

        // æ˜¾ç¤ºHome Assistant APIæ–‡æ¡£
        function showHomeAssistantApiDocs() {
            showApiDocumentation();
            switchApiTab('home_assistant');
        }

        // åˆ‡æ¢APIæ ‡ç­¾é¡µ
        function switchApiTab(tabName) {
            // éšè—æ‰€æœ‰APIæ ‡ç­¾å†…å®¹
            document.querySelectorAll('#apiDocumentation .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰APIæ ‡ç­¾æŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('#apiDocumentation .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(`api-tab-${tabName}`).classList.add('active');
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾æŒ‰é’®
            event.target.classList.add('active');
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + R åˆ·æ–°æ•°æ®
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                refreshData();
                showToast('æ•°æ®å·²åˆ·æ–°', 'success');
            }
            
            // Escape é”®å…³é—­è¯¦æƒ…
            if (e.key === 'Escape') {
                document.querySelectorAll('.collapsible-content:not(.hidden)').forEach(el => {
                    el.classList.add('hidden');
                    el.previousElementSibling.textContent = 'æ˜¾ç¤ºè¯¦æƒ…';
                });
            }
        });
    </script>
</body>
</html>