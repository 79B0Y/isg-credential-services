<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– AI Enhanced Automation API æµ‹è¯•æ–‡æ¡£</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --light: #f5f5f5;
            --dark: #1f2937;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .panel {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-success {
            background: var(--success);
            color: white;
        }

        .status-error {
            background: var(--danger);
            color: white;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #0891b2;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #2563eb;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            min-height: 200px;
            resize: vertical;
        }

        .result-box {
            background: var(--dark);
            color: #00ff00;
            padding: 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 600px;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--light);
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
            opacity: 0.6;
            transition: all 0.3s;
        }

        .tab:hover {
            opacity: 0.8;
        }

        .tab.active {
            opacity: 1;
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .info-box {
            background: #f0f9ff;
            border-left: 4px solid var(--info);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .warning-box {
            background: #fffbeb;
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .example-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .example-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        code {
            background: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .panel {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI Enhanced Automation API</h1>
            <p>æ™ºèƒ½è‡ªåŠ¨åŒ–ç®¡ç† - ä½¿ç”¨AIåˆ›å»ºå’Œç®¡ç†Home Assistantè‡ªåŠ¨åŒ–</p>
        </div>

        <!-- API Tester -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>ğŸ§ª</span>
                    <span>API æµ‹è¯•å·¥å…·</span>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('create')">åˆ›å»ºè‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('list')">åˆ—å‡ºè‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('available')">æŸ¥çœ‹å¯ç”¨è‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('get')">è·å–è‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('delete')">åˆ é™¤è‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('enable')">å¯ç”¨è‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('disable')">ç¦ç”¨è‡ªåŠ¨åŒ–</button>
                <button class="tab" onclick="switchTab('prompts')">æç¤ºè¯ç®¡ç†</button>
            </div>

            <!-- Create Automation -->
            <div id="tab-create" class="tab-content active">
                <div class="info-box">
                    <strong>ğŸ¯ åˆ›å»ºè‡ªåŠ¨åŒ–</strong><br>
                    ä½¿ç”¨AIæ™ºèƒ½åˆ†æç”¨æˆ·è¾“å…¥å’Œè®¾å¤‡åŒ¹é…ç»“æœï¼Œè‡ªåŠ¨ç”ŸæˆHome Assistantè‡ªåŠ¨åŒ–é…ç½®ã€‚
                </div>

                <div class="example-box">
                    <div class="example-title">ğŸ“ è¾“å…¥æ•°æ®ç¤ºä¾‹ï¼ˆæ¥è‡ªç”¨æˆ·æä¾›ï¼‰</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">
{
  "intent": "Set Automation",
  "user_input": "ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™æŠŠç¯å…³äº†",
  "matched_devices": [
    {
      "entity_id": "binary_sensor.motion_sensor_1",
      "service": "binary_sensor.state",
      "service_data": {"state": "off"},
      "automation": "trigger"
    },
    {
      "entity_id": "light.color_light_3",
      "service": "light.turn_off",
      "service_data": {},
      "automation": "action"
    }
  ],
  "automation": {
    "automation_name": "ç”µè§†æˆ¿æ— äººå…³ç¯",
    "automation_name_en": "tv_room_no_one_turn_off_lights",
    "operation": "add",
    "description": "å½“ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™è‡ªåŠ¨å…³ç¯"
  }
}</pre>
                </div>

                <div class="form-group">
                    <label class="form-label">è¾“å…¥æ•°æ® (JSON)</label>
                    <textarea id="createInput" class="form-control" placeholder='ç²˜è´´æˆ–è¾“å…¥JSONæ•°æ®...'>{
  "intent": "Set Automation",
  "user_input": "ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™æŠŠç¯å…³äº†",
  "matched_devices": [
    {
      "entity_id": "binary_sensor.motion_sensor_1",
      "service": "binary_sensor.state",
      "service_data": {"state": "off"},
      "automation": "trigger"
    },
    {
      "entity_id": "light.color_light_3",
      "service": "light.turn_off",
      "service_data": {},
      "automation": "action"
    }
  ],
  "automation": {
    "automation_name": "ç”µè§†æˆ¿æ— äººå…³ç¯",
    "automation_name_en": "tv_room_no_one_turn_off_lights",
    "operation": "add",
    "description": "å½“ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™è‡ªåŠ¨å…³ç¯"
  }
}</textarea>
                </div>

                <button class="btn btn-primary" onclick="createAutomation()">
                    <span>âœ¨</span>
                    <span>åˆ›å»ºè‡ªåŠ¨åŒ–</span>
                </button>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="createResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>
            </div>

            <!-- List Automations -->
            <div id="tab-list" class="tab-content">
                <div class="info-box">
                    <strong>ğŸ“‹ åˆ—å‡ºæ‰€æœ‰è‡ªåŠ¨åŒ–</strong><br>
                    è·å–Home Assistantä¸­æ‰€æœ‰è‡ªåŠ¨åŒ–çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€è§¦å‘å™¨ã€æ¡ä»¶å’ŒåŠ¨ä½œä¿¡æ¯ã€‚
                </div>

                <button class="btn btn-info" onclick="listAutomations()">
                    <span>ğŸ“‹</span>
                    <span>è·å–è‡ªåŠ¨åŒ–åˆ—è¡¨</span>
                </button>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="listResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>
            </div>

            <!-- Available Automations -->
            <div id="tab-available" class="tab-content">
                <div class="info-box">
                    <strong>ğŸ” æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è‡ªåŠ¨åŒ–</strong><br>
                    æ™ºèƒ½æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨åŒ–ï¼Œæ”¯æŒä¸­è‹±æ–‡è¾“å‡ºï¼Œè¿”å›æ ¼å¼åŒ–çš„æ¶ˆæ¯å†…å®¹ã€‚è¾“å‡ºè¯­è¨€ä¼šè‡ªåŠ¨æ ¹æ®ç”¨æˆ·è¾“å…¥è¯†åˆ«ã€‚
                </div>

                <div class="example-box">
                    <div class="example-title">ğŸ“ è¾“å…¥æ•°æ®ç¤ºä¾‹</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">
// ç®€å•æ ¼å¼ï¼ˆSimple Formatï¼‰
{
  "user_input": "æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨åŒ–"
}

// åŒ…è£…æ ¼å¼ï¼ˆWrapped Format - æ¥è‡ª BestMatchï¼‰
{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "æœ‰å“ªäº›è‡ªåŠ¨åŒ–",
    "actions": [],
    "matched_devices": [],
    "scene": {},
    "automation": {
      "automation_name": "",
      "automation_name_en": "",
      "operation": "list",
      "operation_type": "query",
      "description": "æŸ¥è¯¢å½“å‰å·²é…ç½®çš„è‡ªåŠ¨åŒ–è§„åˆ™"
    }
  }
}

// è‹±æ–‡è¾“å…¥ï¼ˆEnglish Inputï¼‰
{
  "user_input": "show all automations"
}</pre>
                </div>

                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·è¾“å…¥ (JSON)</label>
                    <textarea id="availableInput" class="form-control" style="min-height: 100px;" placeholder='è¾“å…¥JSONæ•°æ®...'>
{
  "user_input": "æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨åŒ–"
}</textarea>
                </div>

                <button class="btn btn-success" onclick="getAvailableAutomations()">
                    <span>ğŸ”</span>
                    <span>æŸ¥çœ‹å¯ç”¨è‡ªåŠ¨åŒ–</span>
                </button>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="availableResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>

                <div class="example-box" style="margin-top: 1rem;">
                    <div class="example-title">ğŸ’¡ è¾“å‡ºæ¶ˆæ¯æ ¼å¼</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">
{
  "success": true,
  "data": {
    "automations": [...],
    "count": 10,
    "message": {
      "type": "notification",
      "content": "æ‰¾åˆ°10ä¸ªè‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–1ã€è‡ªåŠ¨åŒ–2ã€è‡ªåŠ¨åŒ–3...",
      "source": "external_system"
    }
  }
}</pre>
                </div>
            </div>

            <!-- Get Automation -->
            <div id="tab-get" class="tab-content">
                <div class="info-box">
                    <strong>ğŸ” è·å–è‡ªåŠ¨åŒ–è¯¦æƒ…</strong><br>
                    æ ¹æ®è‡ªåŠ¨åŒ–IDè·å–è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚
                </div>

                <div class="form-group">
                    <label class="form-label">è‡ªåŠ¨åŒ–ID</label>
                    <input type="text" id="getAutomationId" class="form-control" placeholder="ä¾‹å¦‚: tv_room_no_one_turn_off_lights">
                </div>

                <button class="btn btn-secondary" onclick="getAutomation()">
                    <span>ğŸ”</span>
                    <span>è·å–è‡ªåŠ¨åŒ–</span>
                </button>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="getResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>
            </div>

            <!-- Delete Automation -->
            <div id="tab-delete" class="tab-content">
                <div class="warning-box">
                    <strong>âš ï¸ åˆ é™¤è‡ªåŠ¨åŒ–</strong><br>
                    æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è‡ªåŠ¨åŒ–é…ç½®ï¼Œè¯·è°¨æ…æ“ä½œï¼æ”¯æŒä¸¤ç§æ–¹å¼ï¼šé€šè¿‡IDåˆ é™¤æˆ–é€šè¿‡åç§°åˆ é™¤ï¼ˆå¸¦æ¶ˆæ¯æ ¼å¼ï¼‰ã€‚
                </div>

                <div class="tabs" style="border-bottom: 1px solid #e5e7eb; margin-bottom: 1rem;">
                    <button class="tab active" onclick="switchDeleteMode('id')" style="font-size: 0.9rem;">é€šè¿‡IDåˆ é™¤</button>
                    <button class="tab" onclick="switchDeleteMode('message')" style="font-size: 0.9rem;">é€šè¿‡åç§°åˆ é™¤ï¼ˆå¸¦æ¶ˆæ¯ï¼‰</button>
                </div>

                <!-- Delete by ID -->
                <div id="delete-id-mode">
                    <div class="form-group">
                        <label class="form-label">è‡ªåŠ¨åŒ–ID</label>
                        <input type="text" id="deleteAutomationId" class="form-control" placeholder="ä¾‹å¦‚: automation.tv_room_no_one_turn_off_lights">
                    </div>

                    <button class="btn btn-danger" onclick="deleteAutomation()">
                        <span>ğŸ—‘ï¸</span>
                        <span>åˆ é™¤è‡ªåŠ¨åŒ–</span>
                    </button>
                </div>

                <!-- Delete with Message -->
                <div id="delete-message-mode" style="display: none;">
                    <div class="example-box">
                        <div class="example-title">ğŸ“ è¾“å…¥æ•°æ®ç¤ºä¾‹</div>
                        <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "åˆ é™¤ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–",
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶",
      "automation_name_en": "tv_room_temperature_control",
      "operation": "delete",
      "operation_type": "setup",
      "description": "åˆ é™¤ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–"
    }
  }
}</pre>
                    </div>

                    <div class="form-group">
                        <label class="form-label">è¾“å…¥æ•°æ® (JSON)</label>
                        <textarea id="deleteInput" class="form-control" placeholder='ç²˜è´´æˆ–è¾“å…¥JSONæ•°æ®...' rows="8">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "åˆ é™¤ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–",
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶",
      "automation_name_en": "tv_room_temperature_control",
      "operation": "delete"
    }
  }
}</textarea>
                    </div>

                    <button class="btn btn-danger" onclick="deleteAutomationWithMessage()">
                        <span>ğŸ—‘ï¸</span>
                        <span>åˆ é™¤è‡ªåŠ¨åŒ–ï¼ˆå¸¦æ¶ˆæ¯ï¼‰</span>
                    </button>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="deleteResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>
            </div>

            <!-- Enable Automation -->
            <div id="tab-enable" class="tab-content">
                <div class="info-box">
                    <strong>âœ… å¯ç”¨è‡ªåŠ¨åŒ–</strong><br>
                    å¯ç”¨å·²ç¦ç”¨çš„è‡ªåŠ¨åŒ–ï¼Œä½¿å…¶å¼€å§‹å·¥ä½œã€‚æ”¯æŒä¸¤ç§æ–¹å¼ï¼šé€šè¿‡IDå¯ç”¨æˆ–é€šè¿‡åç§°å¯ç”¨ï¼ˆå¸¦æ¶ˆæ¯æ ¼å¼ï¼‰ã€‚
                </div>

                <div class="tabs" style="border-bottom: 1px solid #e5e7eb; margin-bottom: 1rem;">
                    <button class="tab active" onclick="switchEnableMode('id')" style="font-size: 0.9rem;">é€šè¿‡IDå¯ç”¨</button>
                    <button class="tab" onclick="switchEnableMode('message')" style="font-size: 0.9rem;">é€šè¿‡åç§°å¯ç”¨ï¼ˆå¸¦æ¶ˆæ¯ï¼‰</button>
                </div>

                <!-- Enable by ID -->
                <div id="enable-id-mode">
                    <div class="form-group">
                        <label class="form-label">è‡ªåŠ¨åŒ–ID</label>
                        <input type="text" id="enableAutomationId" class="form-control" placeholder="ä¾‹å¦‚: automation.tv_room_no_one_turn_off_lights">
                    </div>

                    <button class="btn btn-success" onclick="enableAutomation()">
                        <span>âœ…</span>
                        <span>å¯ç”¨è‡ªåŠ¨åŒ–</span>
                    </button>
                </div>

                <!-- Enable with Message -->
                <div id="enable-message-mode" style="display: none;">
                    <div class="example-box">
                        <div class="example-title">ğŸ“ è¾“å…¥æ•°æ®ç¤ºä¾‹</div>
                        <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "å¯ç”¨ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–",
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶",
      "automation_name_en": "tv_room_temperature_control",
      "operation": "enable",
      "operation_type": "setup",
      "description": "å¯ç”¨ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–"
    }
  }
}</pre>
                    </div>

                    <div class="form-group">
                        <label class="form-label">è¾“å…¥æ•°æ® (JSON)</label>
                        <textarea id="enableInput" class="form-control" placeholder='ç²˜è´´æˆ–è¾“å…¥JSONæ•°æ®...' rows="8">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "å¯ç”¨ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–",
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶",
      "automation_name_en": "tv_room_temperature_control",
      "operation": "enable"
    }
  }
}</textarea>
                    </div>

                    <button class="btn btn-success" onclick="enableAutomationWithMessage()">
                        <span>âœ…</span>
                        <span>å¯ç”¨è‡ªåŠ¨åŒ–ï¼ˆå¸¦æ¶ˆæ¯ï¼‰</span>
                    </button>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="enableResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>
            </div>

            <!-- Disable Automation -->
            <div id="tab-disable" class="tab-content">
                <div class="info-box">
                    <strong>â¸ï¸ ç¦ç”¨è‡ªåŠ¨åŒ–</strong><br>
                    æš‚æ—¶ç¦ç”¨è‡ªåŠ¨åŒ–ï¼Œä½†ä¸åˆ é™¤é…ç½®ã€‚æ”¯æŒä¸¤ç§æ–¹å¼ï¼šé€šè¿‡IDç¦ç”¨æˆ–é€šè¿‡åç§°ç¦ç”¨ï¼ˆå¸¦æ¶ˆæ¯æ ¼å¼ï¼‰ã€‚
                </div>

                <div class="tabs" style="border-bottom: 1px solid #e5e7eb; margin-bottom: 1rem;">
                    <button class="tab active" onclick="switchDisableMode('id')" style="font-size: 0.9rem;">é€šè¿‡IDç¦ç”¨</button>
                    <button class="tab" onclick="switchDisableMode('message')" style="font-size: 0.9rem;">é€šè¿‡åç§°ç¦ç”¨ï¼ˆå¸¦æ¶ˆæ¯ï¼‰</button>
                </div>

                <!-- Disable by ID -->
                <div id="disable-id-mode">
                    <div class="form-group">
                        <label class="form-label">è‡ªåŠ¨åŒ–ID</label>
                        <input type="text" id="disableAutomationId" class="form-control" placeholder="ä¾‹å¦‚: automation.tv_room_no_one_turn_off_lights">
                    </div>

                    <button class="btn btn-warning" onclick="disableAutomation()">
                        <span>â¸ï¸</span>
                        <span>ç¦ç”¨è‡ªåŠ¨åŒ–</span>
                    </button>
                </div>

                <!-- Disable with Message -->
                <div id="disable-message-mode" style="display: none;">
                    <div class="example-box">
                        <div class="example-title">ğŸ“ è¾“å…¥æ•°æ®ç¤ºä¾‹</div>
                        <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "ç¦ç”¨ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–",
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶",
      "automation_name_en": "tv_room_temperature_control",
      "operation": "disable",
      "operation_type": "setup",
      "description": "ç¦ç”¨ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–"
    }
  }
}</pre>
                    </div>

                    <div class="form-group">
                        <label class="form-label">è¾“å…¥æ•°æ® (JSON)</label>
                        <textarea id="disableInput" class="form-control" placeholder='ç²˜è´´æˆ–è¾“å…¥JSONæ•°æ®...' rows="8">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "ç¦ç”¨ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶è‡ªåŠ¨åŒ–",
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ¸©åº¦æ§åˆ¶",
      "automation_name_en": "tv_room_temperature_control",
      "operation": "disable"
    }
  }
}</textarea>
                    </div>

                    <button class="btn btn-warning" onclick="disableAutomationWithMessage()">
                        <span>â¸ï¸</span>
                        <span>ç¦ç”¨è‡ªåŠ¨åŒ–ï¼ˆå¸¦æ¶ˆæ¯ï¼‰</span>
                    </button>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">å“åº”ç»“æœ</label>
                    <div id="disableResult" class="result-box">ç­‰å¾…APIè°ƒç”¨...</div>
                </div>
            </div>

            <!-- Prompt Management -->
            <div id="tab-prompts" class="tab-content">
                <div class="info-box">
                    <strong>ğŸ“ æç¤ºè¯ç®¡ç†</strong><br>
                    æŸ¥çœ‹å’Œç¼–è¾‘AIæç¤ºè¯ï¼Œè‡ªå®šä¹‰è‡ªåŠ¨åŒ–ç”Ÿæˆçš„é€»è¾‘å’Œè¡Œä¸ºã€‚
                </div>

                <div class="warning-box">
                    <strong>âš ï¸ æ³¨æ„äº‹é¡¹</strong><br>
                    ä¿®æ”¹æç¤ºè¯ä¼šå½±å“AIç”Ÿæˆè‡ªåŠ¨åŒ–é…ç½®çš„æ–¹å¼ã€‚å»ºè®®å…ˆå¤‡ä»½åŸå§‹æç¤ºè¯ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯ä¿®æ”¹åçš„æ•ˆæœã€‚
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <button class="btn btn-info" onclick="loadPrompts()">
                        <span>ğŸ”„</span>
                        <span>åŠ è½½æç¤ºè¯</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetPrompts()" style="margin-left: 0.5rem;">
                        <span>â†©ï¸</span>
                        <span>é‡ç½®ä¸ºé»˜è®¤</span>
                    </button>
                </div>

                <!-- Create Automation Prompt -->
                <div class="form-group">
                    <label class="form-label">
                        åˆ›å»ºè‡ªåŠ¨åŒ–æç¤ºè¯ (create_automation)
                        <button class="btn btn-success" onclick="savePrompt('create_automation')" style="float: right; padding: 0.5rem 1rem; font-size: 0.9rem;">
                            <span>ğŸ’¾</span>
                            <span>ä¿å­˜</span>
                        </button>
                    </label>
                    <textarea id="createAutomationPrompt" class="form-control" style="min-height: 300px;" placeholder="åŠ è½½ä¸­..."></textarea>
                    <div id="createPromptStatus" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
                </div>

                <!-- Update Automation Prompt -->
                <div class="form-group">
                    <label class="form-label">
                        æ›´æ–°è‡ªåŠ¨åŒ–æç¤ºè¯ (update_automation)
                        <button class="btn btn-success" onclick="savePrompt('update_automation')" style="float: right; padding: 0.5rem 1rem; font-size: 0.9rem;">
                            <span>ğŸ’¾</span>
                            <span>ä¿å­˜</span>
                        </button>
                    </label>
                    <textarea id="updateAutomationPrompt" class="form-control" style="min-height: 300px;" placeholder="åŠ è½½ä¸­..."></textarea>
                    <div id="updatePromptStatus" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
                </div>

                <div class="example-box">
                    <div class="example-title">ğŸ’¡ æç¤ºè¯ç¼–å†™æŠ€å·§</div>
                    <ul style="margin-left: 1.5rem; line-height: 1.8;">
                        <li>æ¸…æ™°å®šä¹‰AIçš„è§’è‰²å’Œä»»åŠ¡</li>
                        <li>æä¾›ä¸°å¯Œçš„ç¤ºä¾‹ï¼ˆtriggerã€conditionã€actionï¼‰</li>
                        <li>è¯´æ˜è¾“å…¥å’Œè¾“å‡ºçš„æ ¼å¼è¦æ±‚</li>
                        <li>åŒ…å«è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†çš„æŒ‡å¯¼</li>
                        <li>ä½¿ç”¨ç»“æ„åŒ–çš„è¯´æ˜ï¼Œä¾¿äºAIç†è§£</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- API Documentation -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>ğŸ“š</span>
                    <span>API æ–‡æ¡£</span>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">åŸºç¡€ä¿¡æ¯</h3>
                <p><strong>Base URL:</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation</code></p>
                <p><strong>æ¨¡å—åç§°:</strong> <code>ai_enhanced_automation</code></p>
                <p><strong>Content-Type:</strong> <code>application/json</code></p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">1ï¸âƒ£ åˆ›å»ºè‡ªåŠ¨åŒ–</h3>
                <p><strong>POST</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/create</code></p>
                <p style="margin-top: 0.5rem;">ä½¿ç”¨AIæ™ºèƒ½åˆ†æå¹¶åˆ›å»ºè‡ªåŠ¨åŒ–ã€‚</p>
                
                <div class="example-box">
                    <div class="example-title">è¯·æ±‚ä½“ç¤ºä¾‹:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "intent": "Set Automation",
  "user_input": "ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™æŠŠç¯å…³äº†",
  "matched_devices": [
    {
      "entity_id": "binary_sensor.motion_sensor_1",
      "service": "binary_sensor.state",
      "service_data": {"state": "off"},
      "automation": "trigger"
    },
    {
      "entity_id": "light.color_light_3",
      "service": "light.turn_off",
      "service_data": {},
      "automation": "action"
    }
  ],
  "automation": {
    "automation_name": "ç”µè§†æˆ¿æ— äººå…³ç¯",
    "automation_name_en": "tv_room_no_one_turn_off_lights",
    "operation": "add",
    "description": "å½“ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™è‡ªåŠ¨å…³ç¯"
  }
}</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">å“åº”ç¤ºä¾‹:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "automation_id": "tv_room_no_one_turn_off_lights",
    "entity_id": "automation.tv_room_no_one_turn_off_lights",
    "alias": "ç”µè§†æˆ¿æ— äººå…³ç¯",
    "created_at": "2025-10-28T12:00:00.000Z",
    "ai_analysis": {
      "analysis": "åˆ›å»ºäº†ä¸€ä¸ªåŸºäºè¿åŠ¨ä¼ æ„Ÿå™¨çš„è‡ªåŠ¨åŒ–...",
      "warnings": []
    }
  }
}</pre>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">2ï¸âƒ£ åˆ—å‡ºæ‰€æœ‰è‡ªåŠ¨åŒ–</h3>
                <p><strong>GET</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/list</code></p>
                <p style="margin-top: 0.5rem;">è·å–æ‰€æœ‰è‡ªåŠ¨åŒ–åˆ—è¡¨ã€‚</p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">3ï¸âƒ£ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è‡ªåŠ¨åŒ– (æ™ºèƒ½)</h3>
                <p><strong>POST</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/available</code></p>
                <p style="margin-top: 0.5rem;">æ™ºèƒ½æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è‡ªåŠ¨åŒ–ï¼Œæ”¯æŒä¸­è‹±æ–‡è¾“å‡ºï¼Œè¿”å›æ ¼å¼åŒ–çš„æ¶ˆæ¯å†…å®¹ã€‚è¾“å‡ºè¯­è¨€ä¼šè‡ªåŠ¨æ ¹æ®ç”¨æˆ·è¾“å…¥è¯†åˆ«ã€‚</p>
                
                <div class="example-box">
                    <div class="example-title">è¯·æ±‚ä½“ç¤ºä¾‹ï¼ˆç®€å•æ ¼å¼ - ä¸­æ–‡ï¼‰:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "user_input": "æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨åŒ–"
}</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">è¯·æ±‚ä½“ç¤ºä¾‹ï¼ˆåŒ…è£…æ ¼å¼ - æ¥è‡ª BestMatchï¼‰:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "intent": "Set Automation",
    "user_input": "æœ‰å“ªäº›è‡ªåŠ¨åŒ–",
    "actions": [],
    "matched_devices": [],
    "scene": {},
    "automation": {
      "automation_name": "",
      "automation_name_en": "",
      "operation": "list",
      "operation_type": "query",
      "description": "æŸ¥è¯¢å½“å‰å·²é…ç½®çš„è‡ªåŠ¨åŒ–è§„åˆ™"
    }
  }
}</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">è¯·æ±‚ä½“ç¤ºä¾‹ï¼ˆè‹±æ–‡ï¼‰:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "user_input": "show all automations"
}</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">å“åº”ç¤ºä¾‹ï¼ˆä¸­æ–‡ï¼‰:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "automations": [
      {
        "entity_id": "automation.tv_room_no_one_turn_off_lights",
        "state": "on",
        "attributes": {
          "friendly_name": "ç”µè§†æˆ¿æ— äººå…³ç¯",
          "last_triggered": "2025-10-28T10:30:00.000Z"
        }
      }
    ],
    "count": 10,
    "message": {
      "type": "notification",
      "content": "æ‰¾åˆ°10ä¸ªè‡ªåŠ¨åŒ–ï¼šç”µè§†æˆ¿æ— äººå…³ç¯ã€å®¢å…ç¯å…‰æ§åˆ¶ã€å§å®¤æ¸©åº¦è°ƒèŠ‚ç­‰",
      "source": "external_system"
    }
  }
}</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">å“åº”ç¤ºä¾‹ï¼ˆè‹±æ–‡ï¼‰:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "automations": [...],
    "count": 10,
    "message": {
      "type": "notification",
      "content": "Found 10 automations: TV room no one turn off lights, Living room light control, Bedroom temperature control, etc.",
      "source": "external_system"
    }
  }
}</pre>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">4ï¸âƒ£ è·å–è‡ªåŠ¨åŒ–è¯¦æƒ…</h3>
                <p><strong>GET</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/get/:id</code></p>
                <p style="margin-top: 0.5rem;">è·å–æŒ‡å®šè‡ªåŠ¨åŒ–çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">5ï¸âƒ£ åˆ é™¤è‡ªåŠ¨åŒ–</h3>
                <p><strong>DELETE</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/delete/:id</code></p>
                <p style="margin-top: 0.5rem;">åˆ é™¤æŒ‡å®šçš„è‡ªåŠ¨åŒ–ã€‚</p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">6ï¸âƒ£ å¯ç”¨è‡ªåŠ¨åŒ–</h3>
                <p><strong>POST</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/enable/:id</code></p>
                <p style="margin-top: 0.5rem;">å¯ç”¨æŒ‡å®šçš„è‡ªåŠ¨åŒ–ã€‚</p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">7ï¸âƒ£ ç¦ç”¨è‡ªåŠ¨åŒ–</h3>
                <p><strong>POST</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/disable/:id</code></p>
                <p style="margin-top: 0.5rem;">ç¦ç”¨æŒ‡å®šçš„è‡ªåŠ¨åŒ–ã€‚</p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">8ï¸âƒ£ è·å–æç¤ºè¯</h3>
                <p><strong>GET</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/prompts</code></p>
                <p style="margin-top: 0.5rem;">è·å–æ‰€æœ‰AIæç¤ºè¯å†…å®¹ã€‚</p>
                
                <div class="example-box">
                    <div class="example-title">å“åº”ç¤ºä¾‹:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "success": true,
  "data": {
    "create_automation": "æç¤ºè¯å†…å®¹...",
    "update_automation": "æç¤ºè¯å†…å®¹..."
  }
}</pre>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">9ï¸âƒ£ æ›´æ–°æç¤ºè¯</h3>
                <p><strong>PUT</strong> <code>/api/ai_enhanced_automation/ai_enhanced_automation/prompt/:type</code></p>
                <p style="margin-top: 0.5rem;">æ›´æ–°æŒ‡å®šç±»å‹çš„AIæç¤ºè¯ã€‚</p>
                <p style="margin-top: 0.5rem;"><strong>ç±»å‹å‚æ•°:</strong> <code>create_automation</code> æˆ– <code>update_automation</code></p>
                
                <div class="example-box">
                    <div class="example-title">è¯·æ±‚ä½“ç¤ºä¾‹:</div>
                    <pre style="font-size: 0.85rem; overflow-x: auto;">{
  "prompt": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½å®¶å±…è‡ªåŠ¨åŒ–åˆ›å»ºåŠ©æ‰‹..."
}</pre>
                </div>
            </div>
        </div>

        <!-- Curl Examples -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>ğŸ’»</span>
                    <span>Curl ç¤ºä¾‹</span>
                </div>
            </div>

            <div class="example-box">
                <div class="example-title">åˆ›å»ºè‡ªåŠ¨åŒ–</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X POST http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/create \
  -H "Content-Type: application/json" \
  -d '{
    "intent": "Set Automation",
    "user_input": "ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™æŠŠç¯å…³äº†",
    "matched_devices": [
      {
        "entity_id": "binary_sensor.motion_sensor_1",
        "service": "binary_sensor.state",
        "service_data": {"state": "off"},
        "automation": "trigger"
      },
      {
        "entity_id": "light.color_light_3",
        "service": "light.turn_off",
        "service_data": {},
        "automation": "action"
      }
    ],
    "automation": {
      "automation_name": "ç”µè§†æˆ¿æ— äººå…³ç¯",
      "automation_name_en": "tv_room_no_one_turn_off_lights",
      "operation": "add",
      "description": "å½“ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™è‡ªåŠ¨å…³ç¯"
    }
  }'</pre>
            </div>

            <div class="example-box">
                <div class="example-title">åˆ—å‡ºæ‰€æœ‰è‡ªåŠ¨åŒ–</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X GET http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/list</pre>
            </div>

            <div class="example-box">
                <div class="example-title">æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è‡ªåŠ¨åŒ–ï¼ˆä¸­æ–‡ï¼‰</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X POST http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/available \
  -H "Content-Type: application/json" \
  -d '{
    "user_input": "æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨åŒ–"
  }'</pre>
            </div>

            <div class="example-box">
                <div class="example-title">æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è‡ªåŠ¨åŒ–ï¼ˆè‹±æ–‡ï¼‰</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X POST http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/available \
  -H "Content-Type: application/json" \
  -d '{
    "user_input": "show all automations"
  }'</pre>
            </div>

            <div class="example-box">
                <div class="example-title">åˆ é™¤è‡ªåŠ¨åŒ–</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X DELETE http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/delete/tv_room_no_one_turn_off_lights</pre>
            </div>

            <div class="example-box">
                <div class="example-title">è·å–æç¤ºè¯</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X GET http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/prompts</pre>
            </div>

            <div class="example-box">
                <div class="example-title">æ›´æ–°æç¤ºè¯</div>
                <pre style="font-size: 0.85rem; overflow-x: auto;">curl -X PUT http://localhost:3000/api/ai_enhanced_automation/ai_enhanced_automation/prompt/create_automation \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½å®¶å±…è‡ªåŠ¨åŒ–åˆ›å»ºåŠ©æ‰‹..."
  }'</pre>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = '/api/ai_enhanced_automation/ai_enhanced_automation';

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Auto-load prompts when switching to prompts tab
            if (tabName === 'prompts') {
                loadPrompts();
            }
        }

        async function createAutomation() {
            const input = document.getElementById('createInput').value;
            const resultBox = document.getElementById('createResult');
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                const data = JSON.parse(input);
                
                const response = await fetch(`${BASE_URL}/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function listAutomations() {
            const resultBox = document.getElementById('listResult');
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                
                const response = await fetch(`${BASE_URL}/list`);
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function getAvailableAutomations() {
            const input = document.getElementById('availableInput').value;
            const resultBox = document.getElementById('availableResult');
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                const data = JSON.parse(input);
                
                const response = await fetch(`${BASE_URL}/available`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function getAutomation() {
            const id = document.getElementById('getAutomationId').value;
            const resultBox = document.getElementById('getResult');
            
            if (!id) {
                resultBox.textContent = 'Error: è¯·è¾“å…¥è‡ªåŠ¨åŒ–ID';
                return;
            }
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                
                const response = await fetch(`${BASE_URL}/get/${id}`);
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function deleteAutomation() {
            const id = document.getElementById('deleteAutomationId').value;
            const resultBox = document.getElementById('deleteResult');
            
            if (!id) {
                resultBox.textContent = 'Error: è¯·è¾“å…¥è‡ªåŠ¨åŒ–ID';
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤è‡ªåŠ¨åŒ– "${id}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                
                const response = await fetch(`${BASE_URL}/delete/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function deleteAutomationWithMessage() {
            const input = document.getElementById('deleteInput').value;
            const resultBox = document.getElementById('deleteResult');
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                const data = JSON.parse(input);
                
                const response = await fetch(`${BASE_URL}/delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function enableAutomation() {
            const id = document.getElementById('enableAutomationId').value;
            const resultBox = document.getElementById('enableResult');
            
            if (!id) {
                resultBox.textContent = 'Error: è¯·è¾“å…¥è‡ªåŠ¨åŒ–ID';
                return;
            }
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                
                const response = await fetch(`${BASE_URL}/enable/${id}`, {
                    method: 'POST'
                });
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function enableAutomationWithMessage() {
            const input = document.getElementById('enableInput').value;
            const resultBox = document.getElementById('enableResult');
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                const data = JSON.parse(input);
                
                const response = await fetch(`${BASE_URL}/enable`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function disableAutomation() {
            const id = document.getElementById('disableAutomationId').value;
            const resultBox = document.getElementById('disableResult');
            
            if (!id) {
                resultBox.textContent = 'Error: è¯·è¾“å…¥è‡ªåŠ¨åŒ–ID';
                return;
            }
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                
                const response = await fetch(`${BASE_URL}/disable/${id}`, {
                    method: 'POST'
                });
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        async function disableAutomationWithMessage() {
            const input = document.getElementById('disableInput').value;
            const resultBox = document.getElementById('disableResult');
            
            try {
                resultBox.textContent = 'æ­£åœ¨è°ƒç”¨API...';
                const data = JSON.parse(input);
                
                const response = await fetch(`${BASE_URL}/disable`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                resultBox.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
            }
        }

        // Mode Switch Functions
        function switchDeleteMode(mode) {
            const idMode = document.getElementById('delete-id-mode');
            const messageMode = document.getElementById('delete-message-mode');
            const tabs = document.querySelectorAll('#tab-delete .tabs .tab');
            
            if (mode === 'id') {
                idMode.style.display = 'block';
                messageMode.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                idMode.style.display = 'none';
                messageMode.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        function switchEnableMode(mode) {
            const idMode = document.getElementById('enable-id-mode');
            const messageMode = document.getElementById('enable-message-mode');
            const tabs = document.querySelectorAll('#tab-enable .tabs .tab');
            
            if (mode === 'id') {
                idMode.style.display = 'block';
                messageMode.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                idMode.style.display = 'none';
                messageMode.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        function switchDisableMode(mode) {
            const idMode = document.getElementById('disable-id-mode');
            const messageMode = document.getElementById('disable-message-mode');
            const tabs = document.querySelectorAll('#tab-disable .tabs .tab');
            
            if (mode === 'id') {
                idMode.style.display = 'block';
                messageMode.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                idMode.style.display = 'none';
                messageMode.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        // Prompt Management Functions
        async function loadPrompts() {
            try {
                const response = await fetch(`${BASE_URL}/prompts`);
                const result = await response.json();
                
                if (result.success) {
                    // Load create automation prompt
                    const createPromptTextarea = document.getElementById('createAutomationPrompt');
                    createPromptTextarea.value = result.data.create_automation || '';
                    document.getElementById('createPromptStatus').innerHTML = '<span style="color: var(--success);">âœ… å·²åŠ è½½</span>';
                    
                    // Load update automation prompt
                    const updatePromptTextarea = document.getElementById('updateAutomationPrompt');
                    updatePromptTextarea.value = result.data.update_automation || '';
                    document.getElementById('updatePromptStatus').innerHTML = '<span style="color: var(--success);">âœ… å·²åŠ è½½</span>';
                    
                    // Show success message
                    alert('âœ… æç¤ºè¯åŠ è½½æˆåŠŸï¼');
                } else {
                    alert('âŒ åŠ è½½å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('âŒ åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function savePrompt(type) {
            const promptTextarea = document.getElementById(type === 'create_automation' ? 'createAutomationPrompt' : 'updateAutomationPrompt');
            const statusDiv = document.getElementById(type === 'create_automation' ? 'createPromptStatus' : 'updatePromptStatus');
            const promptContent = promptTextarea.value;
            
            if (!promptContent.trim()) {
                alert('âŒ æç¤ºè¯å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }
            
            try {
                statusDiv.innerHTML = '<span style="color: var(--info);">â³ ä¿å­˜ä¸­...</span>';
                
                const response = await fetch(`${BASE_URL}/prompt/${type}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: promptContent })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '<span style="color: var(--success);">âœ… ä¿å­˜æˆåŠŸï¼</span>';
                    alert('âœ… æç¤ºè¯ä¿å­˜æˆåŠŸï¼');
                } else {
                    statusDiv.innerHTML = '<span style="color: var(--danger);">âŒ ä¿å­˜å¤±è´¥</span>';
                    alert('âŒ ä¿å­˜å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                statusDiv.innerHTML = '<span style="color: var(--danger);">âŒ ä¿å­˜å¤±è´¥</span>';
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        function resetPrompts() {
            if (!confirm('âš ï¸ ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿå½“å‰çš„ä¿®æ”¹å°†ä¼šä¸¢å¤±ï¼')) {
                return;
            }
            
            // Reset create automation prompt to default
            const createPromptDefault = `ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½å®¶å±…è‡ªåŠ¨åŒ–åˆ›å»ºåŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥å’Œè®¾å¤‡åŒ¹é…ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„Home Assistantè‡ªåŠ¨åŒ–é…ç½®ã€‚

è¾“å…¥ä¿¡æ¯ï¼š
1. user_input: ç”¨æˆ·çš„åŸå§‹è¾“å…¥ï¼ˆä¾‹å¦‚ï¼š"ç”µè§†æˆ¿æ²¡äººçš„æ—¶å€™æŠŠç¯å…³äº†"ï¼‰
2. automation: è‡ªåŠ¨åŒ–åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€è‹±æ–‡åç§°ã€æè¿°ç­‰ï¼‰
3. matched_devices: å·²åŒ¹é…çš„è®¾å¤‡åˆ—è¡¨ï¼ŒåŒ…å«triggerå’Œactionè®¾å¤‡

ä½ éœ€è¦ï¼š
1. åˆ†æmatched_devicesä¸­æ¯ä¸ªè®¾å¤‡çš„automationå­—æ®µï¼ˆtrigger/condition/actionï¼‰
2. å°†triggerè®¾å¤‡è½¬æ¢ä¸ºHome Assistantçš„triggeré…ç½®
3. å°†conditionè®¾å¤‡è½¬æ¢ä¸ºHome Assistantçš„conditioné…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. å°†actionè®¾å¤‡è½¬æ¢ä¸ºHome Assistantçš„actioné…ç½®
5. ç”Ÿæˆå®Œæ•´çš„è‡ªåŠ¨åŒ–é…ç½®

Triggerç±»å‹ç¤ºä¾‹ï¼š
- binary_sensorçŠ¶æ€å˜åŒ–: {"platform": "state", "entity_id": "binary_sensor.motion_sensor_1", "to": "off"}
- æ—¶é—´è§¦å‘: {"platform": "time", "at": "18:00:00"}
- è®¾å¤‡çŠ¶æ€æŒç»­: {"platform": "state", "entity_id": "binary_sensor.xxx", "to": "off", "for": {"minutes": 5}}

Conditionç±»å‹ç¤ºä¾‹ï¼š
- çŠ¶æ€æ¡ä»¶: {"condition": "state", "entity_id": "sun.sun", "state": "below_horizon"}
- æ—¶é—´æ¡ä»¶: {"condition": "time", "after": "18:00:00", "before": "23:00:00"}
- æ•°å€¼æ¡ä»¶: {"condition": "numeric_state", "entity_id": "sensor.temperature", "below": 20}

Actionç±»å‹ç¤ºä¾‹ï¼š
- æœåŠ¡è°ƒç”¨: {"service": "light.turn_off", "target": {"entity_id": "light.color_light_3"}}
- å»¶è¿Ÿ: {"delay": {"seconds": 5}}
- åœºæ™¯æ¿€æ´»: {"service": "scene.turn_on", "target": {"entity_id": "scene.xxx"}}

è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š
{
  "success": true,
  "automation_config": {
    "id": "è‡ªåŠ¨ç”Ÿæˆçš„ID",
    "alias": "è‡ªåŠ¨åŒ–åç§°",
    "description": "è‡ªåŠ¨åŒ–æè¿°",
    "trigger": [
      // triggeré…ç½®æ•°ç»„
    ],
    "condition": [
      // conditioné…ç½®æ•°ç»„ï¼ˆå¯é€‰ï¼‰
    ],
    "action": [
      // actioné…ç½®æ•°ç»„
    ],
    "mode": "single"  // single, restart, queued, parallel
  },
  "analysis": "å¯¹è‡ªåŠ¨åŒ–é€»è¾‘çš„åˆ†æè¯´æ˜",
  "warnings": []  // ä»»ä½•éœ€è¦æ³¨æ„çš„è­¦å‘Šä¿¡æ¯
}

æ³¨æ„ï¼š
1. triggerè‡³å°‘éœ€è¦ä¸€ä¸ª
2. actionè‡³å°‘éœ€è¦ä¸€ä¸ª
3. conditionæ˜¯å¯é€‰çš„
4. å¦‚æœè®¾å¤‡ä¿¡æ¯ä¸å®Œæ•´ï¼Œåœ¨warningsä¸­è¯´æ˜
5. æ‰€æœ‰serviceè°ƒç”¨å¿…é¡»ä½¿ç”¨æ­£ç¡®çš„domainï¼ˆå¦‚light.turn_offè€Œä¸æ˜¯turn_offï¼‰
6. entity_idå¿…é¡»å®Œæ•´ï¼ˆå¦‚binary_sensor.motion_sensor_1ï¼‰
7. å¯¹äºbinary_sensorçš„triggerï¼Œé€šå¸¸éœ€è¦æŒ‡å®štoçŠ¶æ€ï¼ˆon/offï¼‰
8. å¦‚æœç”¨æˆ·è¾“å…¥åŒ…å«"æ²¡äºº"ã€"æ— äºº"ç­‰è¯ï¼Œé€šå¸¸è¡¨ç¤ºbinary_sensorçŠ¶æ€ä¸ºoff
9. å¦‚æœç”¨æˆ·è¾“å…¥åŒ…å«"æœ‰äºº"ã€"æ£€æµ‹åˆ°"ç­‰è¯ï¼Œé€šå¸¸è¡¨ç¤ºbinary_sensorçŠ¶æ€ä¸ºon
10. è€ƒè™‘æ˜¯å¦éœ€è¦æ·»åŠ å»¶è¿Ÿæˆ–æŒç»­æ—¶é—´æ¡ä»¶ï¼Œé¿å…è¯¯è§¦å‘`;

            const updatePromptDefault = `ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½å®¶å±…è‡ªåŠ¨åŒ–æ›´æ–°åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥æ›´æ–°ç°æœ‰çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚

è¾“å…¥ä¿¡æ¯ï¼š
1. user_input: ç”¨æˆ·çš„åŸå§‹è¾“å…¥
2. current_automation: å½“å‰è‡ªåŠ¨åŒ–çš„å®Œæ•´é…ç½®
3. update_request: æ›´æ–°è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯

ä½ éœ€è¦ï¼š
1. åˆ†æç”¨æˆ·çš„æ›´æ–°éœ€æ±‚
2. ä¿ç•™ä¸éœ€è¦æ”¹å˜çš„é…ç½®
3. æ›´æ–°éœ€è¦æ”¹å˜çš„éƒ¨åˆ†
4. ç¡®ä¿æ›´æ–°åçš„é…ç½®ä»ç„¶æœ‰æ•ˆ

è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š
{
  "success": true,
  "automation_config": {
    // å®Œæ•´çš„æ›´æ–°åé…ç½®
  },
  "changes": "å¯¹ä¿®æ”¹å†…å®¹çš„è¯´æ˜",
  "warnings": []
}`;

            document.getElementById('createAutomationPrompt').value = createPromptDefault;
            document.getElementById('updateAutomationPrompt').value = updatePromptDefault;
            
            document.getElementById('createPromptStatus').innerHTML = '<span style="color: var(--warning);">âš ï¸ å·²é‡ç½®ä¸ºé»˜è®¤ï¼ˆæœªä¿å­˜ï¼‰</span>';
            document.getElementById('updatePromptStatus').innerHTML = '<span style="color: var(--warning);">âš ï¸ å·²é‡ç½®ä¸ºé»˜è®¤ï¼ˆæœªä¿å­˜ï¼‰</span>';
            
            alert('âœ… å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯ï¼è¯·ç‚¹å‡»"ä¿å­˜"æŒ‰é’®ä¿å­˜åˆ°æœåŠ¡å™¨ã€‚');
        }

        // Auto-format JSON on page load
        document.addEventListener('DOMContentLoaded', () => {
            const createInput = document.getElementById('createInput');
            try {
                const formatted = JSON.stringify(JSON.parse(createInput.value), null, 2);
                createInput.value = formatted;
            } catch (e) {
                // Keep original value if parsing fails
            }
        });
    </script>
</body>
</html>

